@model CommunityCar.Application.Features.Account.ViewModels.Authentication.ForgotPasswordVM
@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer
@using Microsoft.Extensions.Localization
@inject IStringLocalizer<SharedResource> SharedLocalizer
@inject IStringLocalizer<AccountResource> AccountLocalizer
@{
    ViewData["Title"] = AccountLocalizer["ForgotPassword"];
    Layout = "_AuthLayout";
}

<div class="container min-vh-100 d-flex flex-column justify-content-center py-5">
    <div class="text-center mb-5">
        <div class="position-relative d-inline-flex align-items-center justify-content-center mb-4">
            <div class="position-absolute inset-0 bg-primary opacity-25 rounded-circle blur-xl animate-pulse"></div>
            <div class="position-relative w-20 h-20 rounded-4 bg-card border border-border d-flex align-items-center justify-content-center text-primary shadow-lg" style="width: 80px; height: 80px;">
                <i data-lucide="key" class="w-10 h-10" style="width: 40px; height: 40px;"></i>
            </div>
        </div>
        <h1 class="display-5 fw-black text-gradient tracking-tight mb-2">@AccountLocalizer["ForgotPassword"]</h1>
        <p class="text-sm text-muted-foreground max-w-xs mx-auto">@AccountLocalizer["ForgotPasswordDescription"]</p>
    </div>

    <div class="card card-premium shadow-lg mx-auto" style="max-width: 450px;">
        <div class="card-body p-4 p-md-5">
            <form asp-action="ForgotPassword" method="post" class="d-grid gap-4">
                @Html.AntiForgeryToken()
                
                @if (!ViewData.ModelState.IsValid)
                {
                    <div class="alert alert-danger border-0 bg-danger-subtle text-danger py-3">
                        <div class="text-xs opacity-75">
                            @Html.ValidationSummary(false)
                        </div>
                    </div>
                }

                <div class="form-group">
                    <label asp-for="Email" class="text-xs fw-black text-uppercase tracking-widest text-primary-red opacity-75 mb-2 d-block">@AccountLocalizer["Email"]</label>
                    <div class="position-relative">
                        <i data-lucide="mail" class="position-absolute translate-middle-y top-50 start-0 ms-3 text-muted" style="width: 16px; height: 16px;"></i>
                        <input asp-for="Email" 
                               class="form-control ps-5 py-3 rounded-3 border-border bg-muted-subtle" 
                               placeholder="name@work-email.com" 
                               autocomplete="email" />
                    </div>
                    <span asp-validation-for="Email" class="text-danger text-xs mt-1 d-block"></span>
                </div>

                <button type="submit" class="btn btn-primary-red py-3 rounded-4 mt-2">
                    @AccountLocalizer["SendResetLink"]
                </button>
            </form>
        </div>
    </div>

    <div class="text-center mt-5">
        <p class="text-sm text-muted-foreground mb-0">
            <a asp-action="Login" class="text-primary-red fw-bold text-decoration-none hover-underline d-inline-flex align-items-center gap-2">
                <i data-lucide="arrow-left" class="w-4 h-4"></i>
                @AccountLocalizer["BackToSignIn"]
            </a>
        </p>
    </div>
</div>


    <div class="text-center mt-6">
        <p class="text-sm text-muted-foreground">
            <a asp-action="Login" class="text-primary hover:text-primary/80 font-medium inline-flex items-center gap-2 transition-all">
                <i data-lucide="arrow-left" class="w-4 h-4"></i>
                @AccountLocalizer["BackToSignIn"]
            </a>
        </p>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Lucide icons
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            
            // Theme toggle functionality
            const themeToggle = document.getElementById('theme-toggle');
            const lightIcon = themeToggle?.querySelector('.theme-icon-light');
            const darkIcon = themeToggle?.querySelector('.theme-icon-dark');
            
            // Get current theme from localStorage or default to light
            const currentTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', currentTheme);
            
            // Update icon visibility based on current theme
            if (currentTheme === 'dark' && lightIcon && darkIcon) {
                lightIcon.style.display = 'none';
                darkIcon.style.display = 'block';
            }
            
            themeToggle?.addEventListener('click', function() {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                
                // Toggle icon visibility
                if (newTheme === 'dark' && lightIcon && darkIcon) {
                    lightIcon.style.display = 'none';
                    darkIcon.style.display = 'block';
                } else if (lightIcon && darkIcon) {
                    lightIcon.style.display = 'block';
                    darkIcon.style.display = 'none';
                }
            });
            
            // Language toggle functionality
            const languageToggle = document.getElementById('language-toggle');
            const supportedLanguages = ['en-US', 'ar-EG'];
            
            languageToggle?.addEventListener('click', function() {
                const currentLang = document.documentElement.lang || 'en-US';
                const currentIndex = supportedLanguages.indexOf(currentLang);
                const nextIndex = (currentIndex + 1) % supportedLanguages.length;
                const newLang = supportedLanguages[nextIndex];
                
                // Store language preference
                localStorage.setItem('language', newLang);
                
                // Redirect to current page with new language
                const url = new URL(window.location);
                url.searchParams.set('culture', newLang);
                window.location.href = url.toString();
            });
        });
    </script>
}