@using CommunityCar.Application.Features.Account.ViewModels.Social
@model FollowSuggestionsVM
@{
    ViewData["Title"] = "People You May Know";
    ViewData["PageHeader"] = "Discover People";
    ViewData["PageDescription"] = "Find interesting people to follow";
}

<div class="space-y-8 animate-in fade-in duration-700">
    <!-- Header -->
    <div class="eng-card overflow-hidden">
        <div class="p-8 md:p-12">
            <div class="space-y-4">
                <h1 class="text-3xl md:text-4xl font-black text-foreground tracking-tighter">
                    People You May Know
                </h1>
                <p class="text-muted-foreground">
                    Discover interesting people based on your network and interests
                </p>
            </div>
        </div>
    </div>

    <!-- Suggestions Grid -->
    @if (Model.SuggestedUsers.Any())
    {
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            @foreach (var user in Model.SuggestedUsers)
            {
                <div class="eng-card p-6 hover:-translate-y-1 transition-all duration-300">
                    <div class="text-center space-y-4">
                        <!-- Profile Picture -->
                        <div class="relative inline-block">
                            <img src="@(user.ProfilePictureUrl ?? "/images/default-avatar.png")" 
                                 alt="@user.FullName" 
                                 class="w-20 h-20 rounded-2xl object-cover border-2 border-border/50 mx-auto" />
                        </div>

                        <!-- User Info -->
                        <div class="space-y-2">
                            <a href="@Url.Action("Index", "Profile", new { userId = user.UserId })" 
                               class="text-xl font-black text-foreground hover:text-primary transition-colors block">
                                @user.FullName
                            </a>
                            
                            @if (!string.IsNullOrEmpty(user.Bio))
                            {
                                <p class="text-sm text-muted-foreground line-clamp-2">@user.Bio</p>
                            }
                            
                            @if (!string.IsNullOrEmpty(user.City) || !string.IsNullOrEmpty(user.Country))
                            {
                                <p class="text-xs text-muted-foreground opacity-60">
                                    <i data-lucide="map-pin" class="w-3 h-3 inline mr-1"></i>
                                    @user.City@(!string.IsNullOrEmpty(user.City) && !string.IsNullOrEmpty(user.Country) ? ", " : "")@user.Country
                                </p>
                            }
                        </div>

                        <!-- Stats -->
                        <div class="flex justify-center gap-4 text-xs text-muted-foreground">
                            <span>@user.FollowersCount followers</span>
                            <span>@user.PostsCount posts</span>
                        </div>

                        <!-- Suggestion Reason -->
                        @if (!string.IsNullOrEmpty(user.SuggestionReason))
                        {
                            <div class="px-3 py-2 bg-blue-500/10 text-blue-600 text-xs font-black uppercase tracking-widest rounded-xl border border-blue-500/20">
                                @user.SuggestionReason
                            </div>
                        }

                        <!-- Mutual Followers -->
                        @if (user.MutualFollowerNames.Any())
                        {
                            <div class="text-xs text-muted-foreground">
                                <i data-lucide="users" class="w-3 h-3 inline mr-1"></i>
                                @user.MutualFollowersCount mutual connection@(user.MutualFollowersCount != 1 ? "s" : "")
                            </div>
                        }

                        <!-- Follow Button -->
                        <button onclick="toggleFollow('@user.UserId')" 
                                id="follow-btn-@user.UserId"
                                class="w-full px-4 py-3 bg-primary text-primary-foreground rounded-2xl text-sm font-black uppercase tracking-widest transition-all hover:bg-primary/90 hover:scale-105 active:scale-95">
                            Follow
                        </button>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="eng-card p-12 text-center">
            <div class="w-16 h-16 bg-muted/40 rounded-2xl flex items-center justify-center mx-auto mb-6">
                <i data-lucide="search" class="w-8 h-8 text-muted-foreground opacity-40"></i>
            </div>
            <h3 class="text-xl font-black text-foreground mb-3">
                No Suggestions Available
            </h3>
            <p class="text-muted-foreground mb-6">
                We couldn't find any suggestions for you right now. Try following some people first to get personalized recommendations.
            </p>
            <a href="@Url.Action("Index", "Home")" 
               class="px-6 py-3 bg-primary text-primary-foreground rounded-2xl font-black uppercase tracking-widest hover:bg-primary/90 transition-colors">
                Explore Community
            </a>
        </div>
    }
</div>

@section Scripts {
    <script>
        async function toggleFollow(userId) {
            const btn = document.getElementById(`follow-btn-${userId}`);
            const originalText = btn.textContent;
            
            btn.disabled = true;
            btn.textContent = 'Loading...';
            
            try {
                const response = await fetch(`/Profile/Follow/toggle/${userId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]')?.value
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    if (result.isFollowing) {
                        btn.textContent = 'Following';
                        btn.className = 'w-full px-4 py-3 bg-muted text-foreground rounded-2xl text-sm font-black uppercase tracking-widest transition-all hover:bg-muted/80 hover:scale-105 active:scale-95';
                    } else {
                        btn.textContent = 'Follow';
                        btn.className = 'w-full px-4 py-3 bg-primary text-primary-foreground rounded-2xl text-sm font-black uppercase tracking-widest transition-all hover:bg-primary/90 hover:scale-105 active:scale-95';
                    }
                } else {
                    btn.textContent = originalText;
                }
            } catch (error) {
                console.error('Error toggling follow:', error);
                btn.textContent = originalText;
            }
            
            btn.disabled = false;
        }
    </script>
}