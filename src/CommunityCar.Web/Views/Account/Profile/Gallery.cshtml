@model IEnumerable<CommunityCar.Application.Features.Account.ViewModels.Media.UserGalleryItemVM>
@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer
@{
    ViewData["Title"] = Localizer["Gallery"];
    ViewData["HideLeftSidebar"] = true;
    ViewData["HideRightSidebar"] = true;
    ViewData["HideMainContainer"] = true;
    ViewData["HideMainContentId"] = true;
    var hideLeftSidebar = false; // Always show profile sidebar
}

<div class="container-fluid py-4 animate-in fade-in">
    <!-- Grid Layout with Sidebar -->
    <div class="row g-4">
        <!-- Left Sidebar -->
        <div class="col-12 col-lg-3">
            <partial name="~/Views/Account/Profile/_ProfileSidebar.cshtml" />
        </div>
        
        <!-- Main Content Area -->
        <div class="col-12 col-lg-9 hstack align-items-start gap-4">
            <div class="flex-grow-1 vstack gap-4">
                <!-- Tab Navigation -->
                <partial name="~/Views/Account/Profile/_ProfileNavigation.cshtml" />

                <!-- Gallery Content Card -->
                <div class="card card-premium border-0 shadow-lg overflow-hidden rounded-4">
                    <div class="card-body p-4 p-md-5">
                        <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-4 mb-5 pb-4 border-bottom border-light">
                            <div>
                                <h1 class="h3 fw-black text-dark tracking-tighter mb-1 d-flex align-items-center gap-3">
                                    <i class="fas fa-images text-primary-red"></i>
                                    @Localizer["Gallery"]
                                    <span class="xx-small fw-black text-muted text-uppercase tracking-widest opacity-50 ms-2">(@ViewBag.ImageCount @Localizer["Images"])</span>
                                </h1>
                                <p class="small text-muted fw-bold mb-0">@Localizer["GallerySubtitle"]</p>
                            </div>
                            <button id="uploadBtn" class="btn btn-primary-red px-4 py-2 rounded-3 xx-small fw-black text-uppercase tracking-widest shadow-sm transition-all hover-translate-y">
                                <i class="fas fa-upload me-2 small"></i>
                                @Localizer["UploadImage"]
                            </button>
                        </div>

                        <!-- Upload Form (Hidden) -->
                        <div id="uploadForm" class="d-none mb-5 p-4 bg-light bg-opacity-50 rounded-4 border border-light border-2">
                            <form asp-controller="Gallery" asp-action="Upload" method="post" enctype="multipart/form-data" id="imageUploadForm">
                                @Html.AntiForgeryToken()
                                <div class="vstack gap-4">
                                    <div class="row g-4">
                                        <div class="col-12 col-md-6">
                                            <label class="xx-small fw-black text-uppercase tracking-widest text-muted mb-2 d-block">@Localizer["SelectImage"]</label>
                                            <input type="file" name="file" accept="image/jpeg,image/png,image/webp" required 
                                                   class="form-control form-control-lg border-2 border-light rounded-3 bg-white" />
                                            <p class="xx-small text-muted mt-2 fw-bold">@Localizer["SupportedFormats"]: JPEG, PNG, WebP (Max 5MB)</p>
                                        </div>
                                        <div class="col-12 col-md-6">
                                            <label class="xx-small fw-black text-uppercase tracking-widest text-muted mb-2 d-block">@Localizer["Caption"] (@Localizer["Optional"])</label>
                                            <input type="text" name="caption" placeholder="@Localizer["EnterCaption"]"
                                                   class="form-control form-control-lg border-2 border-light rounded-3 bg-white" />
                                        </div>
                                    </div>
                                    <div class="form-check form-switch d-flex align-items-center gap-3">
                                        <input type="checkbox" name="isPublic" value="true" checked id="isPublicCheck" class="form-check-input" style="width: 40px; height: 20px;" />
                                        <input type="hidden" name="isPublic" value="false" />
                                        <label for="isPublicCheck" class="small fw-black text-uppercase tracking-widest text-dark mt-1">@Localizer["MakePublic"]</label>
                                    </div>
                                    <div class="d-flex gap-3 pt-2">
                                        <button type="submit" class="btn btn-primary-red px-4 py-2 rounded-3 xx-small fw-black text-uppercase tracking-widest shadow-sm">
                                            @Localizer["Upload"]
                                        </button>
                                        <button type="button" id="cancelUpload" class="btn btn-outline-dark px-4 py-2 rounded-3 xx-small fw-black text-uppercase tracking-widest">
                                            @Localizer["Cancel"]
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>

                        <!-- Gallery Grid -->
                        @if (Model != null && Model.Any())
                        {
                            <div class="row g-3" id="galleryGrid">
                                @foreach (var item in Model)
                                {
                                    <div class="col-6 col-md-4 col-xl-3 gallery-item group animate-in zoom-in" data-image-id="@item.Id">
                                        <div class="card card-premium h-100 border-0 rounded-4 overflow-hidden shadow-sm hover-shadow-lg transition-all duration-300">
                                            <!-- Image -->
                                            <div class="position-relative overflow-hidden aspect-ratio-1x1">
                                                <img src="@item.ThumbnailUrl" alt="@item.Caption" 
                                                     class="w-100 h-100 object-fit-cover transition-all duration-300 hover-scale-110 cursor-pointer"
                                                     onclick="viewImage('@item.Id')" />
                                                
                                                <!-- Privacy Indicator -->
                                                <div class="position-absolute top-0 start-0 p-2">
                                                    @if (item.IsPublic)
                                                    {
                                                        <span class="badge rounded-pill bg-success bg-opacity-75 backdrop-blur xx-small fw-black text-uppercase tracking-widest px-2 py-1">
                                                            <i class="fas fa-globe small me-1"></i>@Localizer["Public"]
                                                        </span>
                                                    }
                                                    else
                                                    {
                                                        <span class="badge rounded-pill bg-warning bg-opacity-75 backdrop-blur text-dark xx-small fw-black text-uppercase tracking-widest px-2 py-1">
                                                            <i class="fas fa-lock small me-1"></i>@Localizer["Private"]
                                                        </span>
                                                    }
                                                </div>

                                                <!-- Action Buttons (Show on Hover) -->
                                                <div class="position-absolute top-0 end-0 p-2 opacity-0 group-hover-opacity-100 transition-all duration-300">
                                                    <div class="d-flex flex-column gap-2">
                                                        <button onclick="setAsProfilePicture('@item.Id')" 
                                                                class="btn btn-dark btn-sm rounded-circle p-0 d-flex align-items-center justify-content-center shadow-sm"
                                                                style="width: 32px; height: 32px;"
                                                                title="@Localizer["SetAsProfilePicture"]">
                                                            <i class="fas fa-user-circle small"></i>
                                                        </button>
                                                        <button onclick="toggleVisibility('@item.Id')" 
                                                                class="btn btn-dark btn-sm rounded-circle p-0 d-flex align-items-center justify-content-center shadow-sm"
                                                                style="width: 32px; height: 32px;"
                                                                title="@Localizer["ToggleVisibility"]">
                                                            <i class="fas @(item.IsPublic ? "fa-eye-slash" : "fa-eye") small"></i>
                                                        </button>
                                                        <button onclick="deleteImage('@item.Id')" 
                                                                class="btn btn-danger btn-sm rounded-circle p-0 d-flex align-items-center justify-content-center shadow-sm"
                                                                style="width: 32px; height: 32px;"
                                                                title="@Localizer["Delete"]">
                                                            <i class="fas fa-trash-alt small"></i>
                                                        </button>
                                                    </div>
                                                </div>

                                                <!-- View Count -->
                                                <div class="position-absolute bottom-0 start-0 p-2 opacity-0 group-hover-opacity-100 transition-all duration-300">
                                                    <span class="badge rounded-pill bg-dark bg-opacity-50 text-white xx-small fw-black tracking-widest px-2 py-1">
                                                        <i class="fas fa-eye small me-1"></i>@item.ViewCount
                                                    </span>
                                                </div>
                                            </div>

                                            <!-- Caption Area -->
                                            <div class="card-footer bg-white border-0 p-3 pt-0 mt-3">
                                                @if (!string.IsNullOrEmpty(item.Caption))
                                                {
                                                    <p class="small fw-black text-dark mb-1 text-truncate">@item.Caption</p>
                                                }
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <span class="xx-small fw-bold text-muted opacity-60">@item.TimeAgo</span>
                                                    <div class="dot bg-light" style="width: 4px; height: 4px; border-radius: 50%;"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        }
                        else
                        {
                            <!-- Empty State -->
                            <div class="text-center py-5">
                                <div class="rounded-circle bg-light d-flex align-items-center justify-content-center mx-auto mb-4 scale-up" style="width: 100px; height: 100px;">
                                    <i class="fas fa-images text-muted opacity-20 display-4"></i>
                                </div>
                                <h3 class="h4 fw-black text-dark mb-2">@Localizer["NoImagesYet"]</h3>
                                <p class="small text-muted fw-bold mb-4">@Localizer["StartBuildingGallery"]</p>
                                <button onclick="document.getElementById('uploadBtn').click()" 
                                        class="btn btn-primary-red px-5 py-3 rounded-pill xx-small fw-black text-uppercase tracking-widest shadow-lg transform active-scale-95 transition-all">
                                    <i class="fas fa-upload me-2 small"></i>
                                    @Localizer["UploadFirstImage"]
                                </button>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .xx-small { font-size: 0.6rem; }
    .aspect-ratio-1x1 { aspect-ratio: 1/1; }
    .hover-scale-110:hover { transform: scale(1.1); }
    .group-hover-opacity-100:hover .group-hover-opacity-100 { opacity: 1 !important; }
    .gallery-item:hover .group-hover-opacity-100 { opacity: 1 !important; transform: translateY(0); }
    .active-scale-95:active { transform: scale(0.95); }
    .hover-translate-y:hover { transform: translateY(-3px); }
    .shadow-premium { box-shadow: 0 10px 30px -5px rgba(251, 44, 54, 0.2) !important; }
</style>

<script src="~/js/services/gallery-service.js" asp-append-version="true"></script>
<script src="~/js/modules/gallery-module.js" asp-append-version="true"></script>
