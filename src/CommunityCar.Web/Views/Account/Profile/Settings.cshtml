@model CommunityCar.Application.Features.Account.ViewModels.Core.ProfileSettingsVM
@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer
@{
    ViewData["Title"] = Localizer["PageTitle"];
    ViewData["HideLeftSidebar"] = true;
    ViewData["HideRightSidebar"] = true;
    ViewData["HideMainContainer"] = true;
    ViewData["HideMainContentId"] = true;
    var hideLeftSidebar = false; // Keep profile sidebar visible
}

@section Styles {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
}

<div class="space-y-8 animate-in fade-in duration-700 pt-20">
    <div class="space-y-8">
        @if (hideLeftSidebar)
        {
            <!-- Single Column Layout - No Sidebar -->
            <div class="space-y-6">
                <!-- Tab Navigation & Content -->
                <div class="bg-card border border-border rounded-2xl shadow-lg overflow-hidden">
                    <partial name="~/Views/Account/Profile/_ProfileNavigation.cshtml" />

                    <div class="p-6 sm:p-8">
                        <div class="mb-8 border-b border-border pb-6 flex items-center justify-between">
                            <h1 class="text-2xl font-bold flex items-center mb-0 text-foreground">
                                <i data-lucide="settings" class="w-6 h-6 mr-3 text-primary"></i>@Localizer["AccountSettings"]
                            </h1>
                        </div>

                        <!-- Success/Error Messages -->
                        @if (TempData["SuccessMessage"] != null)
                        {
                            <div class="mb-6 p-4 bg-green-500/10 border border-green-500/20 rounded-lg">
                                <div class="flex items-center">
                                    <i data-lucide="check-circle" class="w-5 h-5 text-green-600 mr-2"></i>
                                    <span class="text-green-800 font-medium">@TempData["SuccessMessage"]</span>
                                </div>
                            </div>
                        }

                        @if (TempData["ErrorMessage"] != null)
                        {
                            <div class="mb-6 p-4 bg-red-500/10 border border-red-500/20 rounded-lg">
                                <div class="flex items-center">
                                    <i data-lucide="alert-circle" class="w-5 h-5 text-red-600 mr-2"></i>
                                    <span class="text-red-800 font-medium">@TempData["ErrorMessage"]</span>
                                </div>
                            </div>
                        }

                        <!-- Settings Navigation: Mirroring Feed Page "Sorting Pulse" aesthetic -->
                        <div class="flex justify-center mb-8">
                            <div class="inline-flex items-center gap-4 bg-muted/30 backdrop-blur-md p-1.5 rounded-[1.5rem] border border-border/50 shadow-xl">
                                <button data-action="show-tab" data-tab="profile" id="profileTab" class="inline-flex items-center gap-3 px-8 py-2.5 rounded-[1.25rem] text-[10px] font-black uppercase tracking-[0.15em] transition-all bg-background text-foreground shadow-lg border border-border">
                                    <i data-lucide="user" class="w-3.5 h-3.5"></i> @Localizer["Profile"]
                                </button>
                                <button data-action="show-tab" data-tab="privacy" id="privacyTab" class="inline-flex items-center gap-3 px-8 py-2.5 rounded-[1.25rem] text-[10px] font-black uppercase tracking-[0.15em] transition-all text-muted-foreground/60 hover:text-foreground hover:bg-muted/50">
                                    <i data-lucide="shield" class="w-3.5 h-3.5"></i> @Localizer["Privacy"]
                                </button>
                                <button data-action="show-tab" data-tab="notifications" id="notificationsTab" class="inline-flex items-center gap-3 px-8 py-2.5 rounded-[1.25rem] text-[10px] font-black uppercase tracking-[0.15em] transition-all text-muted-foreground/60 hover:text-foreground hover:bg-muted/50">
                                    <i data-lucide="bell" class="w-3.5 h-3.5"></i> @Localizer["Notifications"]
                                </button>
                                <button data-action="show-tab" data-tab="security" id="securityTab" class="inline-flex items-center gap-3 px-8 py-2.5 rounded-[1.25rem] text-[10px] font-black uppercase tracking-[0.15em] transition-all text-muted-foreground/60 hover:text-foreground hover:bg-muted/50">
                                    <i data-lucide="lock" class="w-3.5 h-3.5"></i> @Localizer["Security"]
                                </button>
                            </div>
                        </div>
                        
                        <!-- Settings Content -->
                        <div class="settings-content">
                            <!-- Profile Settings Tab -->
                            <div id="profileSettings" class="tab-content">
                                <form action="/profile/settings/profile" method="post" enctype="multipart/form-data">
                                    @Html.AntiForgeryToken()
                                    <div class="mb-10 text-center relative group/photo">
                                        <div class="w-32 h-32 mx-auto mb-6 rounded-2xl overflow-hidden border-4 border-primary/10 shadow-lg relative">
                                            <img src="@(Model.ProfilePictureUrl ?? "/images/default-avatar.png")?v=@DateTime.Now.Ticks" alt="Profile Picture" id="profile-preview" class="w-full h-full object-cover group-hover/photo:scale-110 transition-transform duration-500" />
                                            <div class="absolute inset-0 bg-black/40 opacity-0 group-hover/photo:opacity-100 transition-opacity flex items-center justify-center">
                                                <i data-lucide="camera" class="w-8 h-8 text-white"></i>
                                            </div>
                                        </div>
                                        <label class="inline-flex items-center justify-center bg-primary/10 text-primary hover:bg-primary hover:text-primary-foreground font-medium text-sm py-3 px-6 rounded-lg transition-all cursor-pointer shadow-sm">
                                            <span>@Localizer["ChangePhoto"]</span>
                                            <input type="file" name="ProfilePicture" class="hidden" />
                                        </label>
                                    </div>

                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div class="space-y-2">
                                            <label class="block text-sm font-medium text-foreground">@Localizer["FullName"]</label>
                                            <input type="text" class="w-full px-4 py-3 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all" asp-for="FullName" placeholder="@Localizer["FullNamePlaceholder"]" />
                                        </div>
                                        <div class="space-y-2">
                                            <label class="block text-sm font-medium text-foreground">@Localizer["UsernameEmail"]</label>
                                           <input type="text" class="w-full px-4 py-3 bg-muted/50 border border-border rounded-lg text-muted-foreground cursor-not-allowed" value="@Model.Email" readonly />
                                        </div>
                                        <div class="md:col-span-2 space-y-2">
                                            <label class="block text-sm font-medium text-foreground">@Localizer["PrimaryEmail"]</label>
                                            <input type="email" class="w-full px-4 py-3 bg-muted/50 border border-border rounded-lg text-muted-foreground cursor-not-allowed" asp-for="Email" readonly />
                                            <p class="text-xs text-muted-foreground mt-2">@Localizer["EmailChangeRestriction"]</p>
                                        </div>
                                        <div class="space-y-2">
                                            <label class="block text-sm font-medium text-foreground">@Localizer["PhoneNumber"]</label>
                                            <input type="tel" class="w-full px-4 py-3 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all" asp-for="PhoneNumber" placeholder="@Localizer["PhoneNumberPlaceholder"]" />
                                        </div>
                                        <div class="space-y-2">
                                            <label class="block text-sm font-medium text-foreground">@Localizer["Country"]</label>
                                            <input type="text" class="w-full px-4 py-3 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all" asp-for="Country" placeholder="@Localizer["CountryPlaceholder"]" />
                                        </div>
                                        <div class="space-y-2">
                                            <label class="block text-sm font-medium text-foreground">@Localizer["City"]</label>
                                            <input type="text" class="w-full px-4 py-3 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all" asp-for="City" placeholder="@Localizer["CityPlaceholder"]" />
                                        </div>
                                        <div class="space-y-2">
                                            <label class="block text-sm font-medium text-foreground">@Localizer["CountryAr"]</label>
                                            <input type="text" class="w-full px-4 py-3 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all" asp-for="CountryAr" placeholder="@Localizer["CountryArPlaceholder"]" dir="rtl" />
                                        </div>
                                        <div class="space-y-2">
                                            <label class="block text-sm font-medium text-foreground">@Localizer["CityAr"]</label>
                                            <input type="text" class="w-full px-4 py-3 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all" asp-for="CityAr" placeholder="@Localizer["CityArPlaceholder"]" dir="rtl" />
                                        </div>
                                        <div class="md:col-span-2 space-y-2">
                                            <label class="block text-sm font-medium text-foreground">@Localizer["Bio"]</label>
                                            <textarea class="w-full px-4 py-3 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all resize-none" asp-for="Bio" rows="4" placeholder="@Localizer["BioPlaceholder"]"></textarea>
                                        </div>
                                        <div class="md:col-span-2 space-y-2">
                                            <label class="block text-sm font-medium text-foreground">@Localizer["BioAr"]</label>
                                            <textarea class="w-full px-4 py-3 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all resize-none" asp-for="BioAr" rows="4" placeholder="@Localizer["BioArPlaceholder"]" dir="rtl"></textarea>
                                        </div>
                                    </div>

                                    <div class="pt-6">
                                        <button type="submit" class="w-full bg-primary text-primary-foreground hover:bg-primary/90 font-medium py-3 px-6 rounded-lg transition-all shadow-lg">
                                            @Localizer["SaveProfileChanges"]
                                        </button>
                                    </div>
                                </form>
                            </div>

                            <!-- Other tabs content would go here -->
                            <div id="privacySettings" class="tab-content hidden">
                                <p class="text-center text-muted-foreground">Privacy settings content...</p>
                            </div>
                            <div id="notificationsSettings" class="tab-content hidden">
                                <p class="text-center text-muted-foreground">Notifications settings content...</p>
                            </div>
                            <div id="securitySettings" class="tab-content hidden">
                                <p class="text-center text-muted-foreground">Security settings content...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
        else
        {
            <!-- Grid Layout with Sidebar -->
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                <!-- Left Sidebar -->
                <div class="lg:col-span-1">
                    <partial name="~/Views/Account/Profile/_ProfileSidebar.cshtml" />
                </div>
                
                <!-- Main Content -->
                <div class="lg:col-span-3 space-y-6">
                    <!-- Tab Navigation & Content -->
                    <div class="bg-card border border-border rounded-2xl shadow-lg overflow-hidden">
                        <partial name="~/Views/Account/Profile/_ProfileNavigation.cshtml" />

                        <div class="p-6 sm:p-8">
                            <div class="mb-8 border-b border-border pb-6 flex items-center justify-between">
                                <h1 class="text-2xl font-bold flex items-center mb-0 text-foreground">
                                    <i data-lucide="settings" class="w-6 h-6 mr-3 text-primary"></i>@Localizer["AccountSettings"]
                                </h1>
                            </div>

                            <!-- Success/Error Messages -->
                            @if (TempData["SuccessMessage"] != null)
                            {
                                <div class="mb-6 p-4 bg-green-500/10 border border-green-500/20 rounded-lg">
                                    <div class="flex items-center">
                                        <i data-lucide="check-circle" class="w-5 h-5 text-green-600 mr-2"></i>
                                        <span class="text-green-800 font-medium">@TempData["SuccessMessage"]</span>
                                    </div>
                                </div>
                            }

                            @if (TempData["ErrorMessage"] != null)
                            {
                                <div class="mb-6 p-4 bg-red-500/10 border border-red-500/20 rounded-lg">
                                    <div class="flex items-center">
                                        <i data-lucide="alert-circle" class="w-5 h-5 text-red-600 mr-2"></i>
                                        <span class="text-red-800 font-medium">@TempData["ErrorMessage"]</span>
                                    </div>
                                </div>
                            }

                            <!-- Settings Navigation: Mirroring Feed Page "Sorting Pulse" aesthetic -->
                            <div class="flex justify-center mb-8">
                                <div class="inline-flex items-center gap-4 bg-muted/30 backdrop-blur-md p-1.5 rounded-[1.5rem] border border-border/50 shadow-xl">
                                    <button data-action="show-tab" data-tab="profile" id="profileTab" class="inline-flex items-center gap-3 px-8 py-2.5 rounded-[1.25rem] text-[10px] font-black uppercase tracking-[0.15em] transition-all bg-background text-foreground shadow-lg border border-border">
                                        <i data-lucide="user" class="w-3.5 h-3.5"></i> @Localizer["Profile"]
                                    </button>
                                    <button data-action="show-tab" data-tab="privacy" id="privacyTab" class="inline-flex items-center gap-3 px-8 py-2.5 rounded-[1.25rem] text-[10px] font-black uppercase tracking-[0.15em] transition-all text-muted-foreground/60 hover:text-foreground hover:bg-muted/50">
                                        <i data-lucide="shield" class="w-3.5 h-3.5"></i> @Localizer["Privacy"]
                                    </button>
                                    <button data-action="show-tab" data-tab="notifications" id="notificationsTab" class="inline-flex items-center gap-3 px-8 py-2.5 rounded-[1.25rem] text-[10px] font-black uppercase tracking-[0.15em] transition-all text-muted-foreground/60 hover:text-foreground hover:bg-muted/50">
                                        <i data-lucide="bell" class="w-3.5 h-3.5"></i> @Localizer["Notifications"]
                                    </button>
                                    <button data-action="show-tab" data-tab="security" id="securityTab" class="inline-flex items-center gap-3 px-8 py-2.5 rounded-[1.25rem] text-[10px] font-black uppercase tracking-[0.15em] transition-all text-muted-foreground/60 hover:text-foreground hover:bg-muted/50">
                                        <i data-lucide="lock" class="w-3.5 h-3.5"></i> @Localizer["Security"]
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Settings Content -->
                            <div class="settings-content">
                                <!-- Profile Settings Tab -->
                                <div id="profileSettings" class="tab-content">
                                    <form action="/profile/settings/profile" method="post" enctype="multipart/form-data">
                                        @Html.AntiForgeryToken()
                                        <div class="mb-10 text-center relative group/photo">
                                            <div class="w-32 h-32 mx-auto mb-6 rounded-2xl overflow-hidden border-4 border-primary/10 shadow-lg relative">
                                                <img src="@(Model.ProfilePictureUrl ?? "/images/default-avatar.png")?v=@DateTime.Now.Ticks" alt="Profile Picture" id="profile-preview" class="w-full h-full object-cover group-hover/photo:scale-110 transition-transform duration-500" />
                                                <div class="absolute inset-0 bg-black/40 opacity-0 group-hover/photo:opacity-100 transition-opacity flex items-center justify-center">
                                                    <i data-lucide="camera" class="w-8 h-8 text-white"></i>
                                                </div>
                                            </div>
                                            <label class="inline-flex items-center justify-center bg-primary/10 text-primary hover:bg-primary hover:text-primary-foreground font-medium text-sm py-3 px-6 rounded-lg transition-all cursor-pointer shadow-sm">
                                                <span>@Localizer["ChangePhoto"]</span>
                                                <input type="file" name="ProfilePicture" class="hidden" />
                                            </label>
                                        </div>

                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            <div class="space-y-2">
                                                <label class="block text-sm font-medium text-foreground">@Localizer["FullName"]</label>
                                                <input type="text" class="w-full px-4 py-3 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all" asp-for="FullName" placeholder="@Localizer["FullNamePlaceholder"]" />
                                            </div>
                                            <div class="space-y-2">
                                                <label class="block text-sm font-medium text-foreground">@Localizer["UsernameEmail"]</label>
                                               <input type="text" class="w-full px-4 py-3 bg-muted/50 border border-border rounded-lg text-muted-foreground cursor-not-allowed" value="@Model.Email" readonly />
                                            </div>
                                            <div class="md:col-span-2 space-y-2">
                                                <label class="block text-sm font-medium text-foreground">@Localizer["PrimaryEmail"]</label>
                                                <input type="email" class="w-full px-4 py-3 bg-muted/50 border border-border rounded-lg text-muted-foreground cursor-not-allowed" asp-for="Email" readonly />
                                                <p class="text-xs text-muted-foreground mt-2">@Localizer["EmailChangeRestriction"]</p>
                                            </div>
                                            <div class="space-y-2">
                                                <label class="block text-sm font-medium text-foreground">@Localizer["PhoneNumber"]</label>
                                                <input type="tel" class="w-full px-4 py-3 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all" asp-for="PhoneNumber" placeholder="@Localizer["PhoneNumberPlaceholder"]" />
                                            </div>
                                            <div class="space-y-2">
                                                <label class="block text-sm font-medium text-foreground">@Localizer["Country"]</label>
                                                <input type="text" class="w-full px-4 py-3 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all" asp-for="Country" placeholder="@Localizer["CountryPlaceholder"]" />
                                            </div>
                                            <div class="space-y-2">
                                                <label class="block text-sm font-medium text-foreground">@Localizer["City"]</label>
                                                <input type="text" class="w-full px-4 py-3 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all" asp-for="City" placeholder="@Localizer["CityPlaceholder"]" />
                                            </div>
                                            <div class="space-y-2">
                                                <label class="block text-sm font-medium text-foreground">@Localizer["CountryAr"]</label>
                                                <input type="text" class="w-full px-4 py-3 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all" asp-for="CountryAr" placeholder="@Localizer["CountryArPlaceholder"]" dir="rtl" />
                                            </div>
                                            <div class="space-y-2">
                                                <label class="block text-sm font-medium text-foreground">@Localizer["CityAr"]</label>
                                                <input type="text" class="w-full px-4 py-3 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all" asp-for="CityAr" placeholder="@Localizer["CityArPlaceholder"]" dir="rtl" />
                                            </div>
                                            <div class="md:col-span-2 space-y-2">
                                                <label class="block text-sm font-medium text-foreground">@Localizer["Bio"]</label>
                                                <textarea class="w-full px-4 py-3 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all resize-none" asp-for="Bio" rows="4" placeholder="@Localizer["BioPlaceholder"]"></textarea>
                                            </div>
                                            <div class="md:col-span-2 space-y-2">
                                                <label class="block text-sm font-medium text-foreground">@Localizer["BioAr"]</label>
                                                <textarea class="w-full px-4 py-3 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all resize-none" asp-for="BioAr" rows="4" placeholder="@Localizer["BioArPlaceholder"]" dir="rtl"></textarea>
                                            </div>
                                        </div>

                                        <div class="pt-6">
                                            <button type="submit" class="w-full bg-primary text-primary-foreground hover:bg-primary/90 font-medium py-3 px-6 rounded-lg transition-all shadow-lg">
                                                @Localizer["SaveProfileChanges"]
                                            </button>
                                        </div>
                                    </form>
                                </div>

                                <!-- Other tabs content would go here -->
                                <div id="privacySettings" class="tab-content hidden">
                                    <p class="text-center text-muted-foreground">Privacy settings content...</p>
                                </div>
                                <div id="notificationsSettings" class="tab-content hidden">
                                    <p class="text-center text-muted-foreground">Notifications settings content...</p>
                                </div>
                                <div id="securitySettings" class="tab-content hidden">
                                    <p class="text-center text-muted-foreground">Security settings content...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="~/js/profile-settings.js" asp-append-version="true"></script>
    
    @if (TempData["SuccessMessage"] != null)
    {
        <script>
            Toastify({
                text: "@TempData["SuccessMessage"]",
                duration: 3000,
                close: true,
                gravity: "top",
                position: "right",
                style: {
                    background: "linear-gradient(to right, #00b09b, #96c93d)",
                }
            }).showToast();
        </script>
    }
    
    @if (TempData["ErrorMessage"] != null)
    {
        <script>
            Toastify({
                text: "@TempData["ErrorMessage"]",
                duration: 4000,
                close: true,
                gravity: "top",
                position: "right",
                style: {
                    background: "linear-gradient(to right, #ff5f6d, #ffc371)",
                }
            }).showToast();
        </script>
    }
}