@using CommunityCar.Application.Features.Account.ViewModels.Activity
@model WhoViewedMyProfileVM

<!-- Stats Overview -->
<div class="card card-premium overflow-hidden mb-4">
    <div class="row g-0">
        <div class="col-lg-8 p-4 p-md-5 border-end">
            <div class="mb-4">
                <span class="badge bg-primary-red-subtle text-primary-red rounded-pill px-3 py-2 border border-primary-red small fw-black tracking-widest mb-3">
                    <i data-lucide="eye" class="me-2" style="width: 14px;"></i> PROFILE ANALYTICS
                </span>
                <h1 class="fw-black text-gradient tracking-tight display-5 mb-0">Who Viewed My Profile</h1>
            </div>

            <div class="row g-4 pt-2">
                <div class="col-6 col-md-3">
                    <div class="h2 fw-black mb-0">@Model.Stats.TotalViews.ToString("N0")</div>
                    <div class="small fw-black text-uppercase tracking-widest text-muted opacity-50">Total Views</div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="h2 fw-black mb-0">@Model.Stats.UniqueViewers.ToString("N0")</div>
                    <div class="small fw-black text-uppercase tracking-widest text-muted opacity-50">Unique Viewers</div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="h2 fw-black mb-0">@Model.Stats.TodayViews.ToString("N0")</div>
                    <div class="small fw-black text-uppercase tracking-widest text-muted opacity-50">Today</div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="h2 fw-black mb-0">@Model.Stats.WeekViews.ToString("N0")</div>
                    <div class="small fw-black text-uppercase tracking-widest text-muted opacity-50">This Week</div>
                </div>
            </div>
        </div>

        <div class="col-lg-4 bg-light p-4 p-md-5 d-flex flex-column justify-content-center gap-4">
            @if (Model.Stats.LastViewedAt.HasValue)
            {
                <div>
                    <div class="h5 fw-black mb-0 text-primary-red">@Model.Stats.LastViewedAt.Value.ToString("MMM dd, HH:mm")</div>
                    <div class="small fw-black text-uppercase tracking-widest text-muted opacity-50">Last Viewed</div>
                </div>
            }
            @if (!string.IsNullOrEmpty(Model.Stats.MostCommonViewSource))
            {
                <div>
                    <div class="h5 fw-black mb-0 capitalize">@Model.Stats.MostCommonViewSource</div>
                    <div class="small fw-black text-uppercase tracking-widest text-muted opacity-50">Top Source</div>
                </div>
            }
        </div>
    </div>
</div>

<!-- Recent Viewers -->
<div class="card card-premium overflow-hidden mb-4">
    <div class="card-header border-0 bg-transparent p-4 p-md-5 pb-0">
        <h3 class="fw-black text-dark tracking-tight d-flex align-items-center gap-3 mb-0">
            <span class="badge bg-primary-red rounded-circle d-flex align-items-center justify-content-center p-0" style="width: 32px; height: 32px; font-size: 0.8rem;">@Model.Viewers.Count()</span>
            Recent Viewers
        </h3>
    </div>

    <div class="card-body p-4 p-md-5">
        @if (Model.Viewers.Any())
        {
            <div class="d-flex flex-column gap-4">
                @foreach (var viewer in Model.Viewers)
                {
                    <div class="card card-premium p-4 border transition-all hover-translate-y-2">
                        <div class="d-flex flex-wrap flex-md-nowrap align-items-center gap-4">
                            <!-- Profile Picture -->
                            <div class="user-avatar-container shadow-sm border p-0 m-0 flex-shrink-0" style="width: 64px; height: 64px;">
                                @if (!string.IsNullOrEmpty(viewer.ViewerProfilePicture))
                                {
                                    <img src="@viewer.ViewerProfilePicture" alt="@viewer.ViewerName" class="rounded-circle object-fit-cover w-100 h-100" />
                                }
                                else
                                {
                                    <div class="w-100 h-100 rounded-circle bg-light d-flex align-items-center justify-content-center text-muted">
                                        <i data-lucide="user" style="width: 32px; height: 32px;"></i>
                                    </div>
                                }
                            </div>

                            <div class="flex-grow-1">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <div>
                                        <h5 class="fw-black mb-1">@(viewer.ViewerName ?? "Anonymous User")</h5>
                                        <div class="d-flex align-items-center gap-3 small text-muted">
                                            @if (!string.IsNullOrEmpty(viewer.ViewerLocation))
                                            {
                                                <span class="d-flex align-items-center gap-1">
                                                    <i data-lucide="map-pin" class="text-primary-red" style="width: 14px;"></i>
                                                    @viewer.ViewerLocation
                                                </span>
                                            }
                                            @if (viewer.IsFollowing)
                                            {
                                                <span class="badge bg-primary-red-subtle text-primary-red rounded-pill px-2 py-1 border border-primary-red-subtle x-small fw-black tracking-widest">
                                                    @(viewer.IsMutualFollowing ? "MUTUAL" : "FOLLOWING")
                                                </span>
                                            }
                                        </div>
                                    </div>
                                    <div class="text-end">
                                        <div class="fw-black text-dark">@viewer.ViewCount views</div>
                                        <div class="x-small text-muted fw-bold">@viewer.LastViewedAt.ToString("MMM dd, HH:mm")</div>
                                    </div>
                                </div>

                                <!-- Mini Stats -->
                                <div class="row g-3 pt-3 border-top border-light mt-2">
                                    <div class="col-4 text-center border-end">
                                        <div class="fw-black text-dark small">@viewer.ViewCount</div>
                                        <div class="x-small text-muted text-uppercase tracking-widest font-bold">Views</div>
                                    </div>
                                    <div class="col-4 text-center border-end">
                                        <div class="fw-black text-dark small">@((int)viewer.AverageViewDuration.TotalSeconds)s</div>
                                        <div class="x-small text-muted text-uppercase tracking-widest font-bold">Avg Duration</div>
                                    </div>
                                    <div class="col-4 text-center">
                                        <div class="fw-black text-dark small">@((DateTime.Now - viewer.FirstViewedAt).Days)d</div>
                                        <div class="x-small text-muted text-uppercase tracking-widest font-bold">First View</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Actions -->
                            <div class="d-flex flex-md-column gap-2 ms-md-auto">
                                <a href="@Url.Action("Details", "Profile", new { id = viewer.ViewerId })" class="btn btn-light rounded-4 shadow-sm p-3 group">
                                    <i data-lucide="user" class="group-hover-scale-110 transition-transform" style="width: 20px; height: 20px;"></i>
                                </a>
                                @if (!viewer.IsFollowing)
                                {
                                    <button onclick="followUser('@viewer.ViewerId')" class="btn btn-primary-red rounded-4 shadow-sm p-3 animate-heartbeat">
                                        <i data-lucide="user-plus" style="width: 20px; height: 20px;"></i>
                                    </button>
                                }
                            </div>
                        </div>
                    </div>
                }
            </div>

            <!-- Pagination -->
            @if (Model.HasPreviousPage || Model.HasNextPage)
            {
                <div class="d-flex justify-content-center gap-3 mt-5">
                    @if (Model.HasPreviousPage)
                    {
                        <a href="@Url.Action("WhoViewedMyProfile", new { page = Model.Page - 1, pageSize = Model.PageSize })" class="btn btn-outline-secondary px-4 py-2 rounded-pill fw-black text-uppercase tracking-widest small">
                            Previous
                        </a>
                    }
                    @if (Model.HasNextPage)
                    {
                        <a href="@Url.Action("WhoViewedMyProfile", new { page = Model.Page + 1, pageSize = Model.PageSize })" class="btn btn-primary-red px-4 py-2 rounded-pill fw-black text-uppercase tracking-widest small shadow-sm">
                            Next
                        </a>
                    }
                </div>
            }
        }
        else
        {
            <div class="p-5 text-center bg-light border-2 border-dashed rounded-5 mt-4">
                <div class="bg-white rounded-circle d-flex align-items-center justify-content-center mx-auto mb-4 border shadow-sm" style="width: 80px; height: 80px;">
                    <i data-lucide="eye-off" class="text-muted opacity-20" style="width: 40px; height: 40px;"></i>
                </div>
                <h4 class="fw-black text-dark mb-2">No Profile Views Yet</h4>
                <p class="text-muted small fw-bold text-uppercase tracking-widest opacity-60">Your profile views will appear here soon.</p>
            </div>
        }
    </div>
</div>

<!-- Quick Actions -->
<div class="d-flex flex-wrap gap-3">
    <a href="@Url.Action("ViewAnalytics")" class="btn btn-primary-red px-4 py-3 rounded-4 fw-black text-uppercase tracking-widest small shadow-sm">
        <i data-lucide="bar-chart-3" class="me-2" style="width: 16px;"></i> View Analytics
    </a>
    <a href="@Url.Action("MyViewHistory")" class="btn btn-white px-4 py-3 rounded-4 fw-black text-uppercase tracking-widest small border shadow-sm">
        <i data-lucide="history" class="me-2" style="width: 16px;"></i> My View History
    </a>
</div>