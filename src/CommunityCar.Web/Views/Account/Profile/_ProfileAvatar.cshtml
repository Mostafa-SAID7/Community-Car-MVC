@{
    // Parameters that can be passed to this partial
    var size = ViewData["Size"] as string ?? "large"; // large, medium, small
    var showLevel = ViewData["ShowLevel"] as bool? ?? true;
    var showStatus = ViewData["ShowStatus"] as bool? ?? true;
    var iconBadge = ViewData["IconBadge"] as string; // Optional icon for badge
    var context = ViewData["Context"] as string ?? "profile"; // profile, cover, sidebar
    
    // Extract data from ViewBag
    var profilePictureUrl = ViewBag.ProfilePictureUrl as string ?? "/images/default-avatar.png";
    var fullName = ViewBag.FullName as string ?? "User";
    var level = ViewBag.Level as int? ?? 1;
    
    // Size configurations
    var sizeConfig = size switch {
        "small" => new { ContainerSize = "50px", BorderWidth = "border-2", BadgeSize = "18px", StatusSize = "12px", FontSize = "0.55rem" },
        "medium" => new { ContainerSize = "80px", BorderWidth = "border-3", BadgeSize = "24px", StatusSize = "16px", FontSize = "0.65rem" },
        "large" => new { ContainerSize = "120px", BorderWidth = "border-4", BadgeSize = "32px", StatusSize = "20px", FontSize = "0.75rem" },
        _ => new { ContainerSize = "80px", BorderWidth = "border-3", BadgeSize = "24px", StatusSize = "16px", FontSize = "0.65rem" }
    };
    
    // Context-specific styling
    var contextStyles = context switch {
        "cover" => "border-white border-opacity-80 shadow-lg",
        "sidebar" => "border-light border-opacity-80 shadow-md",
        _ => "border-white shadow-sm"
    };
}

<!-- Profile Avatar Component -->
<div class="position-relative d-inline-block group-avatar animate-in fade-in">
    <!-- Hover Glow Effect -->
    <div class="position-absolute start-50 top-50 translate-middle rounded-circle blur-lg opacity-0 avatar-glow transition-all duration-500" style="width: 110%; height: 110%; background: var(--primary-red); opacity: 0; filter: blur(15px);"></div>
    
    <!-- Main Avatar Container -->
    <div class="position-relative overflow-hidden rounded-circle @sizeConfig.BorderWidth @contextStyles" style="width: @sizeConfig.ContainerSize; height: @sizeConfig.ContainerSize;">
        <!-- Profile Photo -->
        <img src="@(profilePictureUrl)?v=@DateTime.Now.Ticks" alt="@fullName" class="w-100 h-100 object-fit-cover transition-all duration-300 hover-scale-110" />
        
        <!-- Overlay for better contrast -->
        @if (context == "cover")
        {
            <div class="position-absolute inset-0" style="background: linear-gradient(to top, rgba(0,0,0,0.2), transparent);"></div>
        }
        
        <!-- Online Status Indicator -->
        @if (showStatus)
        {
            <div class="position-absolute bottom-0 end-0 @sizeConfig.StatusSize @sizeConfig.BorderWidth @contextStyles rounded-circle bg-success shadow-sm m-1" style="width: @sizeConfig.StatusSize; height: @sizeConfig.StatusSize;"></div>
        }
    </div>
    
    <!-- Level Badge or Icon Badge -->
    @if (showLevel || !string.IsNullOrEmpty(iconBadge))
    {
        <div class="position-absolute top-0 end-0 bg-primary-red rounded-circle @sizeConfig.BorderWidth @contextStyles shadow-sm d-flex align-items-center justify-content-center" style="width: @sizeConfig.BadgeSize; height: @sizeConfig.BadgeSize; transform: translate(5px, -5px);">
            @if (!string.IsNullOrEmpty(iconBadge))
            {
                <i class="fas fa-@iconBadge text-white" style="font-size: 0.6em;"></i>
            }
            else if (showLevel)
            {
                <span class="fw-black text-white" style="font-size: @sizeConfig.FontSize;">@level</span>
            }
        </div>
    }
    
    <!-- Pulse Animation for Active Status -->
    @if (showStatus)
    {
        <div class="position-absolute bottom-0 end-0 rounded-circle bg-success opacity-75 pulse-avatar m-1" style="width: @sizeConfig.StatusSize; height: @sizeConfig.StatusSize;"></div>
    }
</div>

<style>
    .group-avatar:hover .avatar-glow { opacity: 0.3 !important; }
    .hover-scale-110:hover { transform: scale(1.1); }
    .pulse-avatar { animation: pulse-avatar-ping 2s cubic-bezier(0, 0, 0.2, 1) infinite; }
    @@keyframes pulse-avatar-ping {
        75%, 100% { transform: scale(2); opacity: 0; }
    }
</style>