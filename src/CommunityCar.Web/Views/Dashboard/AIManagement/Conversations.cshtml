@model dynamic
@{
    ViewData["Title"] = "AI Conversations";
    Layout = "_DashboardLayout";
    ViewData["UseModernTheme"] = true;
}

<div class="animate-slide-up">
    <!-- Top Header Section -->
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h1 class="page-title mb-2">AI Conversations</h1>
            <p class="text-muted fw-medium">Browse and manage AI chat conversations</p>
        </div>
        <a asp-action="Index" class="btn-modern-outline d-flex align-items-center gap-2">
            <i data-lucide="arrow-left" class="w-4 h-4"></i>
            Back to Hub
        </a>
    </div>

    <!-- Filter Console -->
    <div class="card-modern p-4 mb-4" style="border-radius: 1.5rem;">
        <div class="row g-3 align-items-end">
            <div class="col-12 col-md-3">
                <label class="modern-label">Status</label>
                <select class="modern-select">
                    <option value="">All Statuses</option>
                    <option value="Active">Active</option>
                    <option value="Completed">Completed</option>
                    <option value="Resolved">Resolved</option>
                </select>
            </div>
            <div class="col-12 col-md-3">
                <label class="modern-label">Sentiment</label>
                <select class="modern-select">
                    <option value="">All Sentiments</option>
                    <option value="Positive">Positive</option>
                    <option value="Neutral">Neutral</option>
                    <option value="Negative">Negative</option>
                </select>
            </div>
            <div class="col-12 col-md-3">
                <label class="modern-label">Date Range</label>
                <input type="date" class="modern-input">
            </div>
            <div class="col-12 col-md-3">
                <button class="btn-modern-primary w-100 justify-content-center">
                    <i data-lucide="search" class="w-4 h-4"></i>
                    Apply Filters
                </button>
            </div>
        </div>
    </div>

    <!-- Data Table -->
    <div class="card-modern p-0 overflow-hidden">
        <div class="modern-table-container border-0">
            <table class="modern-table">
                <thead>
                    <tr>
                        <th>Conversation</th>
                        <th class="text-center">Messages</th>
                        <th>Last Activity</th>
                        <th class="text-center">Status</th>
                        <th class="text-center">Sentiment</th>
                        <th class="text-end">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var conversation in Model.Conversations)
                    {
                        <tr>
                            <td>
                                <div class="fw-bold text-dark">@conversation.Title</div>
                                <div class="xx-small text-muted font-monospace mt-1">ID: @conversation.Id.ToString().Substring(0, 8)...</div>
                            </td>
                            <td class="text-center">
                                <div class="d-flex align-items-center justify-content-center gap-2">
                                    <i data-lucide="message-circle" class="w-4 h-4 text-muted"></i>
                                    <span class="fw-bold">@conversation.MessageCount</span>
                                </div>
                            </td>
                            <td>
                                <div class="small fw-bold">@conversation.LastActivity.ToString("MMM dd, yyyy")</div>
                                <div class="xx-small text-muted">@conversation.LastActivity.ToString("HH:mm")</div>
                            </td>
                            <td class="text-center">
                                @{
                                    var statusBadge = conversation.Status switch
                                    {
                                        "Active" => "modern-badge-info",
                                        "Completed" => "modern-badge-success",
                                        "Resolved" => "modern-badge-indigo",
                                        _ => "modern-badge-outline"
                                    };
                                }
                                <span class="modern-badge @statusBadge">@conversation.Status</span>
                            </td>
                            <td class="text-center">
                                @{
                                    var sentimentBadge = conversation.Sentiment switch
                                    {
                                        "Positive" => "modern-badge-success",
                                        "Negative" => "modern-badge-danger",
                                        _ => "modern-badge-warning"
                                    };
                                }
                                <span class="modern-badge @sentimentBadge">@conversation.Sentiment</span>
                            </td>
                            <td class="text-end">
                                <div class="d-flex justify-content-end gap-2">
                                    <a asp-action="ConversationDetails" asp-route-id="@conversation.Id" class="btn-icon-modern">
                                        <i data-lucide="eye" class="w-4 h-4"></i>
                                    </a>
                                    <button class="btn-icon-modern danger">
                                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="p-4 border-top d-flex justify-content-between align-items-center bg-light bg-opacity-50">
            <span class="modern-page-info">
                Showing @((Model.CurrentPage - 1) * Model.PageSize + 1)-@(Math.Min(Model.CurrentPage * Model.PageSize, Model.TotalCount)) of @Model.TotalCount
            </span>
            
            <div class="modern-pagination">
                @if (Model.CurrentPage > 1)
                {
                    <a asp-action="Conversations" asp-route-page="@(Model.CurrentPage - 1)" class="modern-page-item">
                        <i data-lucide="chevron-left" class="w-4 h-4"></i>
                    </a>
                }
                
                @for (int i = Math.Max(1, Model.CurrentPage - 2); i <= Math.Min(Model.TotalPages, Model.CurrentPage + 2); i++)
                {
                    <a asp-action="Conversations" asp-route-page="@i" class="modern-page-item @(i == Model.CurrentPage ? "active" : "")">
                        @i
                    </a>
                }
                
                @if (Model.CurrentPage < Model.TotalPages)
                {
                    <a asp-action="Conversations" asp-route-page="@(Model.CurrentPage + 1)" class="modern-page-item">
                        <i data-lucide="chevron-right" class="w-4 h-4"></i>
                    </a>
                }
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/ai-dashboard.js" asp-append-version="true"></script>
}
