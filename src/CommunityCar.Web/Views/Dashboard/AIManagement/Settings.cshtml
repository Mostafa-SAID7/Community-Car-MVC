@model AISettingsViewModel
@{
    ViewData["Title"] = "AI Settings";
    Layout = "_DashboardLayout";
}

<div class="space-y-6">
    <!-- Header -->
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-bold text-foreground">AI Settings</h1>
            <p class="text-muted-foreground">Configure AI assistant behavior and providers</p>
        </div>
        <div class="flex items-center gap-3">
            <a asp-action="Test" class="btn btn-outline">
                <i data-lucide="flask" class="w-4 h-4 mr-2"></i>
                Test Changes
            </a>
        </div>
    </div>

    <form asp-action="Settings" method="post" class="space-y-6">
        @Html.AntiForgeryToken()
        
        <!-- Provider Configuration -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">AI Provider Configuration</h3>
                <p class="card-description">Configure AI service providers and API keys</p>
            </div>
            <div class="card-content space-y-6">
                <!-- Default Provider -->
                <div class="space-y-2">
                    <label asp-for="DefaultProvider" class="text-sm font-medium text-foreground">Default Provider</label>
                    <select asp-for="DefaultProvider" class="input">
                        <option value="Gemini">Google Gemini</option>
                        <option value="HuggingFace">HuggingFace</option>
                    </select>
                    <span asp-validation-for="DefaultProvider" class="field-error"></span>
                </div>

                <!-- Gemini Configuration -->
                <div class="space-y-4 p-4 rounded-lg border border-border">
                    <div class="flex items-center gap-3">
                        <div class="flex items-center justify-center w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/30">
                            <i data-lucide="brain" class="w-5 h-5 text-blue-600 dark:text-blue-400"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-foreground">Google Gemini</h4>
                            <p class="text-sm text-muted-foreground">Advanced conversational AI with multimodal capabilities</p>
                        </div>
                        <div class="ml-auto">
                            @if (!string.IsNullOrEmpty(Model.GeminiApiKey))
                            {
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400">
                                    <i data-lucide="check" class="w-3 h-3 mr-1"></i>
                                    Configured
                                </span>
                            }
                            else
                            {
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400">
                                    <i data-lucide="x" class="w-3 h-3 mr-1"></i>
                                    Not Configured
                                </span>
                            }
                        </div>
                    </div>
                    
                    <div class="space-y-2">
                        <label asp-for="GeminiApiKey" class="text-sm font-medium text-foreground">API Key</label>
                        <div class="relative">
                            <input asp-for="GeminiApiKey" type="password" class="input pr-10" placeholder="Enter your Gemini API key">
                            <button type="button" class="absolute inset-y-0 right-0 pr-3 flex items-center" onclick="togglePasswordVisibility('GeminiApiKey')">
                                <i data-lucide="eye" class="w-4 h-4 text-muted-foreground"></i>
                            </button>
                        </div>
                        <span asp-validation-for="GeminiApiKey" class="field-error"></span>
                        <p class="text-xs text-muted-foreground">Get your API key from <a href="https://makersuite.google.com/app/apikey" target="_blank" class="text-primary hover:text-primary/80">Google AI Studio</a></p>
                    </div>
                </div>

                <!-- HuggingFace Configuration -->
                <div class="space-y-4 p-4 rounded-lg border border-border">
                    <div class="flex items-center gap-3">
                        <div class="flex items-center justify-center w-10 h-10 rounded-full bg-yellow-100 dark:bg-yellow-900/30">
                            <i data-lucide="zap" class="w-5 h-5 text-yellow-600 dark:text-yellow-400"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-foreground">HuggingFace</h4>
                            <p class="text-sm text-muted-foreground">Open-source machine learning models and transformers</p>
                        </div>
                        <div class="ml-auto">
                            @if (!string.IsNullOrEmpty(Model.HuggingFaceApiKey))
                            {
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400">
                                    <i data-lucide="check" class="w-3 h-3 mr-1"></i>
                                    Configured
                                </span>
                            }
                            else
                            {
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400">
                                    <i data-lucide="x" class="w-3 h-3 mr-1"></i>
                                    Not Configured
                                </span>
                            }
                        </div>
                    </div>
                    
                    <div class="space-y-2">
                        <label asp-for="HuggingFaceApiKey" class="text-sm font-medium text-foreground">API Token</label>
                        <div class="relative">
                            <input asp-for="HuggingFaceApiKey" type="password" class="input pr-10" placeholder="Enter your HuggingFace token">
                            <button type="button" class="absolute inset-y-0 right-0 pr-3 flex items-center" onclick="togglePasswordVisibility('HuggingFaceApiKey')">
                                <i data-lucide="eye" class="w-4 h-4 text-muted-foreground"></i>
                            </button>
                        </div>
                        <span asp-validation-for="HuggingFaceApiKey" class="field-error"></span>
                        <p class="text-xs text-muted-foreground">Get your token from <a href="https://huggingface.co/settings/tokens" target="_blank" class="text-primary hover:text-primary/80">HuggingFace Settings</a></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Feature Configuration -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Feature Configuration</h3>
                <p class="card-description">Enable or disable AI features</p>
            </div>
            <div class="card-content space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Sentiment Analysis -->
                    <div class="flex items-center justify-between p-4 rounded-lg border border-border">
                        <div class="flex items-center gap-3">
                            <div class="flex items-center justify-center w-10 h-10 rounded-full bg-green-100 dark:bg-green-900/30">
                                <i data-lucide="heart" class="w-5 h-5 text-green-600 dark:text-green-400"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-foreground">Sentiment Analysis</h4>
                                <p class="text-sm text-muted-foreground">Analyze user emotions and sentiment</p>
                            </div>
                        </div>
                        <div class="toggle-switch">
                            <input asp-for="EnableSentimentAnalysis" type="checkbox" id="EnableSentimentAnalysis">
                            <span class="toggle-slider"></span>
                        </div>
                    </div>

                    <!-- Predictions -->
                    <div class="flex items-center justify-between p-4 rounded-lg border border-border">
                        <div class="flex items-center gap-3">
                            <div class="flex items-center justify-center w-10 h-10 rounded-full bg-purple-100 dark:bg-purple-900/30">
                                <i data-lucide="trending-up" class="w-5 h-5 text-purple-600 dark:text-purple-400"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-foreground">Predictions</h4>
                                <p class="text-sm text-muted-foreground">Predict user behavior and preferences</p>
                            </div>
                        </div>
                        <div class="toggle-switch">
                            <input asp-for="EnablePredictions" type="checkbox" id="EnablePredictions">
                            <span class="toggle-slider"></span>
                        </div>
                    </div>

                    <!-- Content Moderation -->
                    <div class="flex items-center justify-between p-4 rounded-lg border border-border">
                        <div class="flex items-center gap-3">
                            <div class="flex items-center justify-center w-10 h-10 rounded-full bg-red-100 dark:bg-red-900/30">
                                <i data-lucide="shield" class="w-5 h-5 text-red-600 dark:text-red-400"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-foreground">Content Moderation</h4>
                                <p class="text-sm text-muted-foreground">Filter inappropriate content</p>
                            </div>
                        </div>
                        <div class="toggle-switch">
                            <input asp-for="EnableModeration" type="checkbox" id="EnableModeration">
                            <span class="toggle-slider"></span>
                        </div>
                    </div>

                    <!-- Logging -->
                    <div class="flex items-center justify-between p-4 rounded-lg border border-border">
                        <div class="flex items-center gap-3">
                            <div class="flex items-center justify-center w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/30">
                                <i data-lucide="file-text" class="w-5 h-5 text-blue-600 dark:text-blue-400"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-foreground">Detailed Logging</h4>
                                <p class="text-sm text-muted-foreground">Log all AI interactions</p>
                            </div>
                        </div>
                        <div class="toggle-switch">
                            <input asp-for="EnableLogging" type="checkbox" id="EnableLogging">
                            <span class="toggle-slider"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Configuration -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Performance Configuration</h3>
                <p class="card-description">Configure AI performance parameters</p>
            </div>
            <div class="card-content space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Max Response Length -->
                    <div class="space-y-2">
                        <label asp-for="MaxResponseLength" class="text-sm font-medium text-foreground">Max Response Length</label>
                        <div class="relative">
                            <input asp-for="MaxResponseLength" type="number" class="input" min="100" max="2000" step="50">
                            <span class="absolute inset-y-0 right-0 pr-3 flex items-center text-sm text-muted-foreground">characters</span>
                        </div>
                        <span asp-validation-for="MaxResponseLength" class="field-error"></span>
                        <p class="text-xs text-muted-foreground">Maximum length of AI responses (100-2000 characters)</p>
                    </div>

                    <!-- Response Timeout -->
                    <div class="space-y-2">
                        <label asp-for="ResponseTimeout" class="text-sm font-medium text-foreground">Response Timeout</label>
                        <div class="relative">
                            <input asp-for="ResponseTimeout" type="number" class="input" min="5" max="120" step="5">
                            <span class="absolute inset-y-0 right-0 pr-3 flex items-center text-sm text-muted-foreground">seconds</span>
                        </div>
                        <span asp-validation-for="ResponseTimeout" class="field-error"></span>
                        <p class="text-xs text-muted-foreground">Maximum time to wait for AI response (5-120 seconds)</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex items-center justify-between">
            <a asp-action="Index" class="btn btn-outline">
                <i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>
                Back to Dashboard
            </a>
            <div class="flex items-center gap-3">
                <button type="button" class="btn btn-outline" onclick="resetToDefaults()">
                    Reset to Defaults
                </button>
                <button type="submit" class="btn btn-primary">
                    <i data-lucide="save" class="w-4 h-4 mr-2"></i>
                    Save Settings
                </button>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize icons
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        });

        function togglePasswordVisibility(fieldId) {
            const field = document.getElementById(fieldId);
            const icon = field.nextElementSibling.querySelector('i');
            
            if (field.type === 'password') {
                field.type = 'text';
                icon.setAttribute('data-lucide', 'eye-off');
            } else {
                field.type = 'password';
                icon.setAttribute('data-lucide', 'eye');
            }
            
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }

        function resetToDefaults() {
            if (confirm('Are you sure you want to reset all settings to their default values?')) {
                // Reset form to default values
                document.getElementById('DefaultProvider').value = 'Gemini';
                document.getElementById('EnableSentimentAnalysis').checked = true;
                document.getElementById('EnablePredictions').checked = true;
                document.getElementById('EnableModeration').checked = true;
                document.getElementById('EnableLogging').checked = true;
                document.getElementById('MaxResponseLength').value = 500;
                document.getElementById('ResponseTimeout').value = 30;
            }
        }
    </script>
}