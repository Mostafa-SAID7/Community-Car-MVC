@model AITrainingViewModel
@{
    ViewData["Title"] = "AI Training";
    Layout = "_DashboardLayout";
}

<div class="space-y-6">
    <!-- Header -->
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-bold text-foreground">AI Training</h1>
            <p class="text-muted-foreground">Manage AI model training and feedback data</p>
        </div>
        <div class="flex items-center gap-3">
            <button class="btn btn-outline" onclick="downloadTrainingData()">
                <i data-lucide="download" class="w-4 h-4 mr-2"></i>
                Download Data
            </button>
            <form asp-action="StartTraining" method="post" class="inline">
                @Html.AntiForgeryToken()
                <button type="submit" class="btn btn-primary" onclick="return confirm('Are you sure you want to start AI training? This process may take several hours.')">
                    <i data-lucide="play" class="w-4 h-4 mr-2"></i>
                    Start Training
                </button>
            </form>
        </div>
    </div>

    <!-- Training Status Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <div class="card">
            <div class="card-content p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-muted-foreground">Training Data</p>
                        <p class="text-2xl font-bold text-foreground">@Model.TrainingDataCount.ToString("N0")</p>
                    </div>
                    <div class="flex items-center justify-center w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900/30">
                        <i data-lucide="database" class="w-6 h-6 text-blue-600 dark:text-blue-400"></i>
                    </div>
                </div>
                <p class="text-xs text-muted-foreground mt-2">Conversation pairs</p>
            </div>
        </div>

        <div class="card">
            <div class="card-content p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-muted-foreground">Model Accuracy</p>
                        <p class="text-2xl font-bold text-foreground">@Model.ModelAccuracy.ToString("F1")%</p>
                    </div>
                    <div class="flex items-center justify-center w-12 h-12 rounded-full bg-green-100 dark:bg-green-900/30">
                        <i data-lucide="target" class="w-6 h-6 text-green-600 dark:text-green-400"></i>
                    </div>
                </div>
                <p class="text-xs text-green-600 dark:text-green-400 mt-2">Excellent performance</p>
            </div>
        </div>

        <div class="card">
            <div class="card-content p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-muted-foreground">Last Training</p>
                        <p class="text-2xl font-bold text-foreground">
                            @if (Model.LastTrainingDate.HasValue)
                            {
                                @((DateTime.UtcNow - Model.LastTrainingDate.Value).Days)d
                            }
                            else
                            {
                                @("Never")
                            }
                        </p>
                    </div>
                    <div class="flex items-center justify-center w-12 h-12 rounded-full bg-orange-100 dark:bg-orange-900/30">
                        <i data-lucide="clock" class="w-6 h-6 text-orange-600 dark:text-orange-400"></i>
                    </div>
                </div>
                <p class="text-xs text-muted-foreground mt-2">
                    @if (Model.LastTrainingDate.HasValue)
                    {
                        @Model.LastTrainingDate.Value.ToString("MMM dd, yyyy")
                    }
                    else
                    {
                        @("No training history")
                    }
                </p>
            </div>
        </div>

        <div class="card">
            <div class="card-content p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-muted-foreground">Pending Feedback</p>
                        <p class="text-2xl font-bold text-foreground">@Model.PendingFeedback</p>
                    </div>
                    <div class="flex items-center justify-center w-12 h-12 rounded-full bg-purple-100 dark:bg-purple-900/30">
                        <i data-lucide="message-square" class="w-6 h-6 text-purple-600 dark:text-purple-400"></i>
                    </div>
                </div>
                <p class="text-xs text-muted-foreground mt-2">Awaiting review</p>
            </div>
        </div>
    </div>

    <!-- Training Progress -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Training Progress</h3>
            <p class="card-description">Current training status and progress</p>
        </div>
        <div class="card-content">
            <div class="space-y-4">
                <div class="flex items-center justify-between">
                    <span class="text-sm font-medium text-foreground">Training Status</span>
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400">
                        <i data-lucide="check" class="w-3 h-3 mr-1"></i>
                        Ready
                    </span>
                </div>
                
                <div class="space-y-2">
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-muted-foreground">Data Preparation</span>
                        <span class="text-sm text-foreground">100%</span>
                    </div>
                    <div class="w-full bg-muted rounded-full h-2">
                        <div class="bg-green-500 h-2 rounded-full" style="width: 100%"></div>
                    </div>
                </div>

                <div class="space-y-2">
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-muted-foreground">Model Training</span>
                        <span class="text-sm text-foreground">0%</span>
                    </div>
                    <div class="w-full bg-muted rounded-full h-2">
                        <div class="bg-blue-500 h-2 rounded-full" style="width: 0%"></div>
                    </div>
                </div>

                <div class="space-y-2">
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-muted-foreground">Validation</span>
                        <span class="text-sm text-foreground">0%</span>
                    </div>
                    <div class="w-full bg-muted rounded-full h-2">
                        <div class="bg-purple-500 h-2 rounded-full" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Training Data Management -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Data Sources -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Training Data Sources</h3>
                <p class="card-description">Sources of training data</p>
            </div>
            <div class="card-content">
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-3 rounded-lg bg-muted/50">
                        <div class="flex items-center gap-3">
                            <div class="flex items-center justify-center w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900/30">
                                <i data-lucide="message-circle" class="w-4 h-4 text-blue-600 dark:text-blue-400"></i>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-foreground">User Conversations</p>
                                <p class="text-xs text-muted-foreground">Real user interactions</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-sm font-medium text-foreground">12,450</p>
                            <p class="text-xs text-green-600 dark:text-green-400">Active</p>
                        </div>
                    </div>

                    <div class="flex items-center justify-between p-3 rounded-lg bg-muted/50">
                        <div class="flex items-center gap-3">
                            <div class="flex items-center justify-center w-8 h-8 rounded-full bg-green-100 dark:bg-green-900/30">
                                <i data-lucide="thumbs-up" class="w-4 h-4 text-green-600 dark:text-green-400"></i>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-foreground">User Feedback</p>
                                <p class="text-xs text-muted-foreground">Ratings and corrections</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-sm font-medium text-foreground">2,180</p>
                            <p class="text-xs text-green-600 dark:text-green-400">Active</p>
                        </div>
                    </div>

                    <div class="flex items-center justify-between p-3 rounded-lg bg-muted/50">
                        <div class="flex items-center gap-3">
                            <div class="flex items-center justify-center w-8 h-8 rounded-full bg-purple-100 dark:bg-purple-900/30">
                                <i data-lucide="book" class="w-4 h-4 text-purple-600 dark:text-purple-400"></i>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-foreground">Knowledge Base</p>
                                <p class="text-xs text-muted-foreground">Curated automotive content</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-sm font-medium text-foreground">370</p>
                            <p class="text-xs text-green-600 dark:text-green-400">Active</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Training History -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Training History</h3>
                <p class="card-description">Recent training sessions</p>
            </div>
            <div class="card-content">
                <div class="space-y-4">
                    <div class="flex items-start gap-3 p-3 rounded-lg bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800">
                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-green-100 dark:bg-green-900/30">
                            <i data-lucide="check" class="w-4 h-4 text-green-600 dark:text-green-400"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium text-green-800 dark:text-green-200">Training Completed</p>
                            <p class="text-xs text-green-600 dark:text-green-400 mt-1">
                                @if (Model.LastTrainingDate.HasValue)
                                {
                                    @Model.LastTrainingDate.Value.ToString("MMM dd, yyyy HH:mm")
                                }
                                else
                                {
                                    @("No previous training")
                                }
                            </p>
                            <p class="text-xs text-green-600 dark:text-green-400">Accuracy: @Model.ModelAccuracy.ToString("F1")%</p>
                        </div>
                        <span class="text-xs text-green-600 dark:text-green-400">2h 15m</span>
                    </div>

                    <div class="flex items-start gap-3 p-3 rounded-lg bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800">
                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900/30">
                            <i data-lucide="info" class="w-4 h-4 text-blue-600 dark:text-blue-400"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium text-blue-800 dark:text-blue-200">Data Updated</p>
                            <p class="text-xs text-blue-600 dark:text-blue-400 mt-1">Jan 20, 2026 14:30</p>
                            <p class="text-xs text-blue-600 dark:text-blue-400">Added 450 new conversation pairs</p>
                        </div>
                    </div>

                    <div class="flex items-start gap-3 p-3 rounded-lg bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800">
                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-yellow-100 dark:bg-yellow-900/30">
                            <i data-lucide="alert-triangle" class="w-4 h-4 text-yellow-600 dark:text-yellow-400"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium text-yellow-800 dark:text-yellow-200">Training Recommended</p>
                            <p class="text-xs text-yellow-600 dark:text-yellow-400 mt-1">Jan 18, 2026</p>
                            <p class="text-xs text-yellow-600 dark:text-yellow-400">Significant new data available</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Feedback Management -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Pending Feedback Review</h3>
            <p class="card-description">User feedback awaiting review and integration</p>
        </div>
        <div class="card-content">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-border">
                            <th class="text-left py-3 px-4 font-medium text-muted-foreground">Message</th>
                            <th class="text-left py-3 px-4 font-medium text-muted-foreground">Rating</th>
                            <th class="text-left py-3 px-4 font-medium text-muted-foreground">Feedback</th>
                            <th class="text-left py-3 px-4 font-medium text-muted-foreground">Date</th>
                            <th class="text-left py-3 px-4 font-medium text-muted-foreground">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-b border-border hover:bg-muted/50 transition-colors">
                            <td class="py-4 px-4">
                                <p class="text-sm text-foreground line-clamp-2">How often should I change my car's oil?</p>
                                <p class="text-xs text-muted-foreground mt-1">AI Response: "Most vehicles need an oil change every 3,000-5,000 miles..."</p>
                            </td>
                            <td class="py-4 px-4">
                                <div class="flex items-center gap-1">
                                    @for (int i = 1; i <= 5; i++)
                                    {
                                        <i data-lucide="star" class="w-4 h-4 @(i <= 4 ? "text-yellow-500 fill-current" : "text-gray-300")"></i>
                                    }
                                </div>
                            </td>
                            <td class="py-4 px-4">
                                <p class="text-sm text-foreground line-clamp-2">Very helpful response, but could mention synthetic oil benefits</p>
                            </td>
                            <td class="py-4 px-4">
                                <p class="text-sm text-foreground">Jan 25, 2026</p>
                                <p class="text-xs text-muted-foreground">10:30 AM</p>
                            </td>
                            <td class="py-4 px-4">
                                <div class="flex items-center gap-2">
                                    <button class="btn btn-outline btn-sm" onclick="approveFeedback('1')">
                                        <i data-lucide="check" class="w-4 h-4 mr-1"></i>
                                        Approve
                                    </button>
                                    <button class="btn btn-outline btn-sm" onclick="rejectFeedback('1')">
                                        <i data-lucide="x" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>

                        <tr class="border-b border-border hover:bg-muted/50 transition-colors">
                            <td class="py-4 px-4">
                                <p class="text-sm text-foreground line-clamp-2">What's the best car insurance for young drivers?</p>
                                <p class="text-xs text-muted-foreground mt-1">AI Response: "Young drivers should consider factors like..."</p>
                            </td>
                            <td class="py-4 px-4">
                                <div class="flex items-center gap-1">
                                    @for (int i = 1; i <= 5; i++)
                                    {
                                        <i data-lucide="star" class="w-4 h-4 @(i <= 2 ? "text-yellow-500 fill-current" : "text-gray-300")"></i>
                                    }
                                </div>
                            </td>
                            <td class="py-4 px-4">
                                <p class="text-sm text-foreground line-clamp-2">Response was too generic, needs more specific recommendations</p>
                            </td>
                            <td class="py-4 px-4">
                                <p class="text-sm text-foreground">Jan 25, 2026</p>
                                <p class="text-xs text-muted-foreground">09:15 AM</p>
                            </td>
                            <td class="py-4 px-4">
                                <div class="flex items-center gap-2">
                                    <button class="btn btn-outline btn-sm" onclick="approveFeedback('2')">
                                        <i data-lucide="check" class="w-4 h-4 mr-1"></i>
                                        Approve
                                    </button>
                                    <button class="btn btn-outline btn-sm" onclick="rejectFeedback('2')">
                                        <i data-lucide="x" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize icons
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        });

        function downloadTrainingData() {
            // Implement download functionality
            alert('Download training data functionality would be implemented here');
        }

        function approveFeedback(feedbackId) {
            if (confirm('Are you sure you want to approve this feedback for training?')) {
                // Implement approve functionality
                alert(`Feedback ${feedbackId} approved for training`);
                // Remove row or update UI
            }
        }

        function rejectFeedback(feedbackId) {
            if (confirm('Are you sure you want to reject this feedback?')) {
                // Implement reject functionality
                alert(`Feedback ${feedbackId} rejected`);
                // Remove row or update UI
            }
        }
    </script>
}