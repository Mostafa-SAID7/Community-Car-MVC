@model dynamic
@{
    ViewData["Title"] = "AI Analytics";
    Layout = "_DashboardLayout";
    ViewData["UseModernTheme"] = true;
}

<div class="animate-slide-up">
    <!-- Top Header Section -->
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h1 class="page-title mb-2">AI Analytics</h1>
            <p class="text-muted fw-medium">Detailed insights and performance metrics</p>
        </div>
        <a asp-action="Index" class="btn-modern-outline d-flex align-items-center gap-2">
            <i data-lucide="arrow-left" class="w-4 h-4"></i>
            Back to Hub
        </a>
    </div>

    @if (Model.Error != null)
    {
        <div class="card-modern text-center py-5">
            <div class="w-16 h-16 rounded-circle bg-light d-flex align-items-center justify-content-center text-warning mx-auto mb-4">
                <i data-lucide="alert-circle" class="w-8 h-8"></i>
            </div>
            <h4 class="fw-black mb-2">Analytics Not Available</h4>
            <p class="text-muted mb-4">@Model.Error</p>
            <button data-action="reload-page" class="btn-modern-primary">
                <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                Retry Loading
            </button>
        </div>
    }
    else
    {
        <!-- Metrics Row -->
        <div class="row g-4 mb-5">
            <div class="col-12 col-md-3">
                <div class="card-modern p-4">
                    <p class="modern-label mb-2">TOTAL CONVERSATIONS</p>
                    <div class="d-flex align-items-center justify-content-between">
                        <h2 class="fw-black mb-0">@Model.ConversationMetrics.Total.ToString("N0")</h2>
                        <span class="modern-badge modern-badge-success">+@Model.ConversationMetrics.ThisWeek</span>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-3">
                <div class="card-modern p-4">
                    <p class="modern-label mb-2">AVG LENGTH</p>
                    <div class="d-flex align-items-center justify-content-between">
                        <h2 class="fw-black mb-0">@Model.ConversationMetrics.AvgLength.ToString("F1")</h2>
                        <span class="xx-small text-muted fw-bold">MESSAGES</span>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-3">
                <div class="card-modern p-4">
                    <p class="modern-label mb-2">COMPLETION RATE</p>
                    <div class="d-flex align-items-center justify-content-between">
                        <h2 class="fw-black mb-0">@Model.ConversationMetrics.CompletionRate.ToString("F1")%</h2>
                        <div class="modern-progress w-25 h-1">
                            <div class="modern-progress-bar bg-success" style="width: @Model.ConversationMetrics.CompletionRate.ToString("F1")%"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-3">
                <div class="card-modern p-4">
                    <p class="modern-label mb-2">RETURN RATE</p>
                    <div class="d-flex align-items-center justify-content-between">
                        <h2 class="fw-black mb-0">@Model.UserEngagement.ReturnRate.ToString("F1")%</h2>
                        <i data-lucide="users" class="w-6 h-6 opacity-20"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-4 mb-5">
            <!-- Sentiment Analysis -->
            <div class="col-12 col-lg-5">
                <div class="card-modern h-100">
                    <h5 class="fw-black mb-4">Sentiment Distribution</h5>
                    <div class="d-flex flex-column gap-4">
                        <div>
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="small fw-bold">Positive</span>
                                <span class="xx-small fw-black">@Model.SentimentAnalysis.Positive.ToString("F1")%</span>
                            </div>
                            <div class="modern-progress">
                                <div class="modern-progress-bar bg-success" style="width: @Model.SentimentAnalysis.Positive.ToString("F1")%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="small fw-bold">Neutral</span>
                                <span class="xx-small fw-black">@Model.SentimentAnalysis.Neutral.ToString("F1")%</span>
                            </div>
                            <div class="modern-progress">
                                <div class="modern-progress-bar bg-warning" style="width: @Model.SentimentAnalysis.Neutral.ToString("F1")%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="small fw-bold">Negative</span>
                                <span class="xx-small fw-black">@Model.SentimentAnalysis.Negative.ToString("F1")%</span>
                            </div>
                            <div class="modern-progress">
                                <div class="modern-progress-bar bg-danger" style="width: @Model.SentimentAnalysis.Negative.ToString("F1")%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Top Topics -->
            <div class="col-12 col-lg-7">
                <div class="card-modern h-100">
                    <h5 class="fw-black mb-4">Popular Discussion Topics</h5>
                    <div class="row g-3">
                        @foreach (var topic in Model.TopTopics)
                        {
                            <div class="col-12 col-md-6">
                                <div class="modern-topic-badge">
                                    <div>
                                        <div class="small fw-black">@topic.Topic</div>
                                        <div class="xx-small text-muted">@topic.Count.ToString("N0") Sessions</div>
                                    </div>
                                    <div class="modern-badge modern-badge-info">@topic.Percentage.ToString("F1")%</div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- User Engagement Metrics -->
        <div class="card-modern-dark p-4 mb-5">
            <h5 class="fw-black mb-4 text-white">Engagement Overview</h5>
            <div class="modern-metrics-group">
                <div class="modern-metric-item">
                    <span class="metric-val text-white">@Model.UserEngagement.ActiveUsers.ToString("N0")</span>
                    <span class="xx-small text-white opacity-60 fw-bold">ACTIVE USERS</span>
                </div>
                <div class="modern-metric-item">
                    <span class="metric-val text-white">@Model.UserEngagement.ReturnRate.ToString("F1")%</span>
                    <span class="xx-small text-white opacity-60 fw-bold">RETENTION</span>
                </div>
                <div class="modern-metric-item">
                    <span class="metric-val text-white">@Model.UserEngagement.AvgSessionTime</span>
                    <span class="xx-small text-white opacity-60 fw-bold">AVG SESSION</span>
                </div>
            </div>
        </div>
    }
</div>

@section Scripts {
    <script src="~/js/ai-dashboard.js" asp-append-version="true"></script>
}
