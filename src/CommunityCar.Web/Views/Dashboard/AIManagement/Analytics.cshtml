@model AIAnalyticsViewModel
@{
    ViewData["Title"] = "AI Analytics";
    Layout = "_DashboardLayout";
}

<div class="space-y-6">
    <!-- Header -->
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-bold text-foreground">AI Analytics</h1>
            <p class="text-muted-foreground">Detailed insights into AI performance and usage</p>
        </div>
        <div class="flex items-center gap-3">
            <select class="input w-32" id="timeRange">
                <option value="7">Last 7 days</option>
                <option value="30" selected>Last 30 days</option>
                <option value="90">Last 90 days</option>
            </select>
            <button class="btn btn-outline" onclick="exportData()">
                <i data-lucide="download" class="w-4 h-4 mr-2"></i>
                Export
            </button>
        </div>
    </div>

    <!-- Key Metrics -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <div class="card">
            <div class="card-content p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-muted-foreground">Active Users</p>
                        <p class="text-2xl font-bold text-foreground">1,250</p>
                    </div>
                    <div class="text-green-600 dark:text-green-400">
                        <i data-lucide="trending-up" class="w-5 h-5"></i>
                    </div>
                </div>
                <p class="text-xs text-green-600 dark:text-green-400 mt-2">+12% from last month</p>
            </div>
        </div>

        <div class="card">
            <div class="card-content p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-muted-foreground">Success Rate</p>
                        <p class="text-2xl font-bold text-foreground">98.5%</p>
                    </div>
                    <div class="text-green-600 dark:text-green-400">
                        <i data-lucide="check-circle" class="w-5 h-5"></i>
                    </div>
                </div>
                <p class="text-xs text-green-600 dark:text-green-400 mt-2">+0.3% from last month</p>
            </div>
        </div>

        <div class="card">
            <div class="card-content p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-muted-foreground">Avg Session</p>
                        <p class="text-2xl font-bold text-foreground">12.5m</p>
                    </div>
                    <div class="text-blue-600 dark:text-blue-400">
                        <i data-lucide="clock" class="w-5 h-5"></i>
                    </div>
                </div>
                <p class="text-xs text-blue-600 dark:text-blue-400 mt-2">+2.1m from last month</p>
            </div>
        </div>

        <div class="card">
            <div class="card-content p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-muted-foreground">Satisfaction</p>
                        <p class="text-2xl font-bold text-foreground">4.7/5</p>
                    </div>
                    <div class="text-yellow-600 dark:text-yellow-400">
                        <i data-lucide="star" class="w-5 h-5"></i>
                    </div>
                </div>
                <p class="text-xs text-yellow-600 dark:text-yellow-400 mt-2">+0.2 from last month</p>
            </div>
        </div>
    </div>

    <!-- Charts Row 1 -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Conversation Trends -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Conversation Trends</h3>
                <p class="card-description">Daily conversation volume over time</p>
            </div>
            <div class="card-content">
                <div class="h-64 flex items-center justify-center bg-muted/20 rounded-lg">
                    <canvas id="conversationChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>

        <!-- Response Time Analysis -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Response Time Analysis</h3>
                <p class="card-description">AI response time distribution</p>
            </div>
            <div class="card-content">
                <div class="h-64 flex items-center justify-center bg-muted/20 rounded-lg">
                    <canvas id="responseTimeChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row 2 -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Sentiment Trends -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Sentiment Trends</h3>
                <p class="card-description">Sentiment analysis over time</p>
            </div>
            <div class="card-content">
                <div class="h-64 flex items-center justify-center bg-muted/20 rounded-lg">
                    <canvas id="sentimentChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>

        <!-- Topic Distribution -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Topic Distribution</h3>
                <p class="card-description">Most discussed topics</p>
            </div>
            <div class="card-content">
                <div class="h-64 flex items-center justify-center bg-muted/20 rounded-lg">
                    <canvas id="topicChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Detailed Tables -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Top Performing Responses -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Top Performing Responses</h3>
                <p class="card-description">Highest rated AI responses</p>
            </div>
            <div class="card-content">
                <div class="space-y-4">
                    <div class="flex items-start gap-3 p-3 rounded-lg bg-muted/50">
                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 text-sm font-bold">
                            1
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium">Car maintenance schedule guidance</p>
                            <p class="text-xs text-muted-foreground mt-1">95% satisfaction • 234 interactions</p>
                        </div>
                        <div class="flex items-center gap-1">
                            <i data-lucide="star" class="w-4 h-4 text-yellow-500 fill-current"></i>
                            <span class="text-sm font-medium">4.9</span>
                        </div>
                    </div>

                    <div class="flex items-start gap-3 p-3 rounded-lg bg-muted/50">
                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 text-sm font-bold">
                            2
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium">Insurance claim assistance</p>
                            <p class="text-xs text-muted-foreground mt-1">92% satisfaction • 189 interactions</p>
                        </div>
                        <div class="flex items-center gap-1">
                            <i data-lucide="star" class="w-4 h-4 text-yellow-500 fill-current"></i>
                            <span class="text-sm font-medium">4.8</span>
                        </div>
                    </div>

                    <div class="flex items-start gap-3 p-3 rounded-lg bg-muted/50">
                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 text-sm font-bold">
                            3
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium">Electric vehicle information</p>
                            <p class="text-xs text-muted-foreground mt-1">89% satisfaction • 156 interactions</p>
                        </div>
                        <div class="flex items-center gap-1">
                            <i data-lucide="star" class="w-4 h-4 text-yellow-500 fill-current"></i>
                            <span class="text-sm font-medium">4.7</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Issues -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Recent Issues</h3>
                <p class="card-description">Areas needing attention</p>
            </div>
            <div class="card-content">
                <div class="space-y-4">
                    <div class="flex items-start gap-3 p-3 rounded-lg bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800">
                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-red-100 dark:bg-red-900/30">
                            <i data-lucide="alert-triangle" class="w-4 h-4 text-red-600 dark:text-red-400"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium text-red-800 dark:text-red-200">High response time</p>
                            <p class="text-xs text-red-600 dark:text-red-400 mt-1">Complex queries taking >2s • 12 instances</p>
                        </div>
                        <span class="text-xs text-red-600 dark:text-red-400">2h ago</span>
                    </div>

                    <div class="flex items-start gap-3 p-3 rounded-lg bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800">
                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-yellow-100 dark:bg-yellow-900/30">
                            <i data-lucide="help-circle" class="w-4 h-4 text-yellow-600 dark:text-yellow-400"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium text-yellow-800 dark:text-yellow-200">Unclear responses</p>
                            <p class="text-xs text-yellow-600 dark:text-yellow-400 mt-1">Users requesting clarification • 8 instances</p>
                        </div>
                        <span class="text-xs text-yellow-600 dark:text-yellow-400">4h ago</span>
                    </div>

                    <div class="flex items-start gap-3 p-3 rounded-lg bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800">
                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900/30">
                            <i data-lucide="info" class="w-4 h-4 text-blue-600 dark:text-blue-400"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium text-blue-800 dark:text-blue-200">New topic detected</p>
                            <p class="text-xs text-blue-600 dark:text-blue-400 mt-1">Autonomous driving questions increasing • 15 instances</p>
                        </div>
                        <span class="text-xs text-blue-600 dark:text-blue-400">6h ago</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize icons
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }

            // Initialize charts
            initializeCharts();
        });

        function initializeCharts() {
            // Conversation Trends Chart
            const conversationCtx = document.getElementById('conversationChart').getContext('2d');
            new Chart(conversationCtx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Conversations',
                        data: [45, 52, 38, 67, 73, 58, 62],
                        borderColor: 'rgb(239, 68, 68)',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Response Time Chart
            const responseTimeCtx = document.getElementById('responseTimeChart').getContext('2d');
            new Chart(responseTimeCtx, {
                type: 'bar',
                data: {
                    labels: ['<0.5s', '0.5-1s', '1-1.5s', '1.5-2s', '>2s'],
                    datasets: [{
                        label: 'Responses',
                        data: [45, 35, 15, 3, 2],
                        backgroundColor: [
                            'rgba(34, 197, 94, 0.8)',
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(251, 191, 36, 0.8)',
                            'rgba(249, 115, 22, 0.8)',
                            'rgba(239, 68, 68, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Sentiment Trends Chart
            const sentimentCtx = document.getElementById('sentimentChart').getContext('2d');
            new Chart(sentimentCtx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [
                        {
                            label: 'Positive',
                            data: [60, 65, 62, 68, 70, 67, 65],
                            borderColor: 'rgb(34, 197, 94)',
                            backgroundColor: 'rgba(34, 197, 94, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Neutral',
                            data: [30, 25, 28, 22, 20, 23, 25],
                            borderColor: 'rgb(107, 114, 128)',
                            backgroundColor: 'rgba(107, 114, 128, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Negative',
                            data: [10, 10, 10, 10, 10, 10, 10],
                            borderColor: 'rgb(239, 68, 68)',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });

            // Topic Distribution Chart
            const topicCtx = document.getElementById('topicChart').getContext('2d');
            new Chart(topicCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Maintenance', 'Insurance', 'Electric', 'Repairs', 'Safety', 'Performance'],
                    datasets: [{
                        data: [450, 320, 280, 380, 220, 180],
                        backgroundColor: [
                            'rgba(239, 68, 68, 0.8)',
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(34, 197, 94, 0.8)',
                            'rgba(251, 191, 36, 0.8)',
                            'rgba(249, 115, 22, 0.8)',
                            'rgba(168, 85, 247, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function exportData() {
            // Implement export functionality
            alert('Export functionality would be implemented here');
        }
    </script>
}