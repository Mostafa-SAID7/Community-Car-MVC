@model CommunityCar.Application.Features.Dashboard.ViewModels.UserAnalyticsVM
@{
    ViewData["Title"] = "Analytics Dashboard";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}

<div class="space-y-8 animate-in fade-in duration-700">
    <!-- Analytics Header -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-6">
        <div>
            <h2 class="text-3xl font-black text-foreground tracking-tight">Analytics Dashboard</h2>
            <p class="text-sm text-muted-foreground font-medium opacity-70">Insights and metrics for the community platform</p>
        </div>
        <div class="flex flex-wrap items-center gap-3">
            <div class="inline-flex p-1 bg-muted/40 backdrop-blur-sm rounded-xl border border-border/50 shadow-sm">
                <button type="button" class="px-4 py-2 text-[10px] font-black rounded-lg transition-all active bg-background text-foreground shadow-md ring-1 ring-border" data-range="7">7 Days</button>
                <button type="button" class="px-4 py-2 text-[10px] font-black rounded-lg transition-all text-muted-foreground hover:text-foreground hover:bg-muted/30" data-range="30">30 Days</button>
                <button type="button" class="px-4 py-2 text-[10px] font-black rounded-lg transition-all text-muted-foreground hover:text-foreground hover:bg-muted/30" data-range="90">90 Days</button>
            </div>
            <button class="inline-flex items-center gap-2 px-6 py-2.5 bg-primary text-primary-foreground hover:bg-primary/90 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all shadow-lg shadow-primary/20 active:scale-95" onclick="exportAnalytics()">
                <i class="fas fa-download"></i> Export
            </button>
        </div>
    </div>

    <!-- Key Metrics Row -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        <div class="bg-card/50 backdrop-blur-md border border-border rounded-2xl p-6 shadow-lg transition-all hover:shadow-xl hover:border-primary/20 group">
            <div class="flex items-center justify-between mb-4">
                <h6 class="text-[10px] font-black uppercase tracking-widest text-muted-foreground opacity-60">New Users</h6>
                <div class="p-2 rounded-lg bg-green-500/10 text-green-500 text-sm group-hover:scale-110 transition-transform">
                    <i class="fas fa-user-plus"></i>
                </div>
            </div>
            <div class="text-3xl font-black text-foreground tabular-nums">@Model.NewUsers.ToString("N0")</div>
            <div class="text-[10px] font-black uppercase flex items-center gap-1 mt-2 text-green-500">
                <i class="fas fa-arrow-up text-[8px]"></i> +12.5% <span class="opacity-40 ml-1">vs last period</span>
            </div>
        </div>
        
        <div class="bg-card/50 backdrop-blur-md border border-border rounded-2xl p-6 shadow-lg transition-all hover:shadow-xl hover:border-primary/20 group">
            <div class="flex items-center justify-between mb-4">
                <h6 class="text-[10px] font-black uppercase tracking-widest text-muted-foreground opacity-60">Active Users</h6>
                <div class="p-2 rounded-lg bg-blue-500/10 text-blue-500 text-sm group-hover:scale-110 transition-transform">
                    <i class="fas fa-users"></i>
                </div>
            </div>
            <div class="text-3xl font-black text-foreground tabular-nums">@Model.ActiveUsers.ToString("N0")</div>
            <div class="text-[10px] font-black uppercase flex items-center gap-1 mt-2 text-blue-500">
                <i class="fas fa-arrow-up text-[8px]"></i> +8.3% <span class="opacity-40 ml-1">vs last period</span>
            </div>
        </div>
        
        <div class="bg-card/50 backdrop-blur-md border border-border rounded-2xl p-6 shadow-lg transition-all hover:shadow-xl hover:border-primary/20 group">
            <div class="flex items-center justify-between mb-4">
                <h6 class="text-[10px] font-black uppercase tracking-widest text-muted-foreground opacity-60">Retention Rate</h6>
                <div class="p-2 rounded-lg bg-indigo-500/10 text-indigo-500 text-sm group-hover:scale-110 transition-transform">
                    <i class="fas fa-chart-line"></i>
                </div>
            </div>
            <div class="text-3xl font-black text-foreground tabular-nums">@Model.RetentionRate.ToString("F1")%</div>
            <div class="text-[10px] font-black uppercase flex items-center gap-1 mt-2 text-indigo-500">
                <i class="fas fa-arrow-up text-[8px]"></i> +2.1% <span class="opacity-40 ml-1">vs last period</span>
            </div>
        </div>
        
        <div class="bg-card/50 backdrop-blur-md border border-border rounded-2xl p-6 shadow-lg transition-all hover:shadow-xl hover:border-primary/20 group">
            <div class="flex items-center justify-between mb-4">
                <h6 class="text-[10px] font-black uppercase tracking-widest text-muted-foreground opacity-60">Avg Session</h6>
                <div class="p-2 rounded-lg bg-amber-500/10 text-amber-500 text-sm group-hover:scale-110 transition-transform">
                    <i class="fas fa-clock"></i>
                </div>
            </div>
            <div class="text-3xl font-black text-foreground tabular-nums">@Model.AverageSessionDuration.ToString(@"mm\:ss")</div>
            <div class="text-[10px] font-black uppercase flex items-center gap-1 mt-2 text-destructive">
                <i class="fas fa-arrow-down text-[8px]"></i> -1.2% <span class="opacity-40 ml-1">vs last period</span>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="lg:col-span-2 bg-card/40 backdrop-blur-md border border-border rounded-xl shadow-md overflow-hidden transition-all hover:border-primary/10 hover:shadow-lg">
            <div class="p-4 border-b border-border/50 bg-muted/20 px-6">
                <h5 class="text-xs font-black uppercase tracking-widest text-foreground">User Growth Trend</h5>
            </div>
            <div class="p-6">
                <canvas id="userGrowthChart" class="w-full h-[300px]"></canvas>
            </div>
        </div>
        
        <div class="bg-card/40 backdrop-blur-md border border-border rounded-xl shadow-md overflow-hidden transition-all hover:border-primary/10 hover:shadow-lg">
            <div class="p-4 border-b border-border/50 bg-muted/20 px-6">
                <h5 class="text-xs font-black uppercase tracking-widest text-foreground">User Activity</h5>
            </div>
            <div class="p-6">
                <canvas id="activityChart" class="w-full h-[300px]"></canvas>
            </div>
        </div>
    </div>

    <!-- Detailed Analytics Row -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="bg-card/40 backdrop-blur-md border border-border rounded-xl shadow-md overflow-hidden transition-all hover:border-primary/10">
            <div class="p-4 border-b border-border/50 bg-muted/20 px-6">
                <h5 class="text-xs font-black uppercase tracking-widest text-foreground">User Engagement</h5>
            </div>
            <div class="p-8 space-y-6">
                <div class="space-y-3">
                    <div class="flex justify-between items-end">
                        <span class="text-[11px] font-black uppercase tracking-widest opacity-60">Posts Created</span>
                        <span class="text-base font-black tabular-nums">@Model.PostsCreated.ToString("N0")</span>
                    </div>
                    <div class="h-1.5 bg-muted rounded-full overflow-hidden shadow-inner ring-1 ring-border/30">
                        <div class="h-full bg-blue-500 rounded-full shadow-lg shadow-blue-500/20 transition-all duration-1000" style="width: 85%"></div>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <div class="flex justify-between items-end">
                        <span class="text-[11px] font-black uppercase tracking-widest opacity-60">Questions Asked</span>
                        <span class="text-base font-black tabular-nums">@Model.QuestionsAsked.ToString("N0")</span>
                    </div>
                    <div class="h-1.5 bg-muted rounded-full overflow-hidden shadow-inner ring-1 ring-border/30">
                        <div class="h-full bg-green-500 rounded-full shadow-lg shadow-green-500/20 transition-all duration-1000" style="width: 70%"></div>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <div class="flex justify-between items-end">
                        <span class="text-[11px] font-black uppercase tracking-widest opacity-60">Answers Given</span>
                        <span class="text-base font-black tabular-nums">@Model.AnswersGiven.ToString("N0")</span>
                    </div>
                    <div class="h-1.5 bg-muted rounded-full overflow-hidden shadow-inner ring-1 ring-border/30">
                        <div class="h-full bg-amber-500 rounded-full shadow-lg shadow-amber-500/20 transition-all duration-1000" style="width: 60%"></div>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <div class="flex justify-between items-end">
                        <span class="text-[11px] font-black uppercase tracking-widest opacity-60">Reviews Written</span>
                        <span class="text-base font-black tabular-nums">@Model.ReviewsWritten.ToString("N0")</span>
                    </div>
                    <div class="h-1.5 bg-muted rounded-full overflow-hidden shadow-inner ring-1 ring-border/30">
                        <div class="h-full bg-red-500 rounded-full shadow-lg shadow-red-500/20 transition-all duration-1000" style="width: 45%"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="bg-card/40 backdrop-blur-md border border-border rounded-xl shadow-md overflow-hidden transition-all hover:border-primary/10">
            <div class="p-4 border-b border-border/50 bg-muted/20 px-6">
                <h5 class="text-xs font-black uppercase tracking-widest text-foreground">User Demographics</h5>
            </div>
            <div class="p-6 divide-y divide-border/30">
                <div class="flex items-center justify-between py-4 group/item">
                    <span class="text-[11px] font-bold text-muted-foreground uppercase tracking-widest opacity-70 group-hover/item:text-primary transition-colors">Most Active Device</span>
                    <span class="text-xs font-black text-foreground">@Model.DeviceType</span>
                </div>
                <div class="flex items-center justify-between py-4 group/item">
                    <span class="text-[11px] font-bold text-muted-foreground uppercase tracking-widest opacity-70 group-hover/item:text-primary transition-colors">Primary Browser</span>
                    <span class="text-xs font-black text-foreground">@Model.BrowserType</span>
                </div>
                <div class="flex items-center justify-between py-4 group/item">
                    <span class="text-[11px] font-bold text-muted-foreground uppercase tracking-widest opacity-70 group-hover/item:text-primary transition-colors">Top Location</span>
                    <span class="text-xs font-black text-foreground">@Model.Location</span>
                </div>
                <div class="flex items-center justify-between py-4 group/item">
                    <span class="text-[11px] font-bold text-muted-foreground uppercase tracking-widest opacity-70 group-hover/item:text-primary transition-colors">Most Visited Area</span>
                    <span class="text-xs font-black text-foreground">@Model.MostVisitedSection</span>
                </div>
                <div class="flex items-center justify-between py-4 group/item">
                    <span class="text-[11px] font-bold text-muted-foreground uppercase tracking-widest opacity-70 group-hover/item:text-primary transition-colors">Total Page Views</span>
                    <span class="text-xs font-black text-foreground tabular-nums">@Model.PageViews.ToString("N0")</span>
                </div>
                <div class="flex items-center justify-between py-4 group/item">
                    <span class="text-[11px] font-bold text-muted-foreground uppercase tracking-widest opacity-70 group-hover/item:text-primary transition-colors">Time on Site (Avg)</span>
                    <span class="text-xs font-black text-foreground tabular-nums">@Model.TimeSpentOnSite.ToString(@"hh\:mm\:ss")</span>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const textColor = getComputedStyle(document.documentElement).getPropertyValue('--muted-foreground') || '#64748b';
        const gridColor = getComputedStyle(document.documentElement).getPropertyValue('--border') || 'rgba(0,0,0,0.05)';
        
        // User Growth Chart
        const userGrowthCtx = document.getElementById('userGrowthChart').getContext('2d');
        const userGrowthChart = new Chart(userGrowthCtx, {
            type: 'line',
            data: {
                labels: @Html.Raw(Json.Serialize(Model.UserGrowthData.Select(x => x.Label))),
                datasets: [{
                    label: 'New Users',
                    data: @Html.Raw(Json.Serialize(Model.UserGrowthData.Select(x => x.Value))),
                    borderColor: '#3b82f6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    pointRadius: 0,
                    pointHoverRadius: 6
                }, {
                    label: 'Active Users',
                    data: @Html.Raw(Json.Serialize(Model.ActivityData.Select(x => x.Value))),
                    borderColor: '#10b981',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    pointRadius: 0,
                    pointHoverRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'top', labels: { font: { weight: 'bold', size: 10 } } }
                },
                scales: {
                    y: { grid: { color: gridColor }, ticks: { font: { size: 10, weight: 'bold' }, color: textColor } },
                    x: { grid: { display: false }, ticks: { font: { size: 10, weight: 'bold' }, color: textColor } }
                }
            }
        });

        // Activity Doughnut Chart
        const activityCtx = document.getElementById('activityChart').getContext('2d');
        const activityChart = new Chart(activityCtx, {
            type: 'doughnut',
            data: {
                labels: ['Posts', 'Questions', 'Answers', 'Reviews', 'Stories'],
                datasets: [{
                    data: [@Model.PostsCreated, @Model.QuestionsAsked, @Model.AnswersGiven, @Model.ReviewsWritten, @Model.StoriesShared],
                    backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'],
                    borderWidth: 0,
                    weight: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '70%',
                plugins: {
                    legend: { position: 'bottom', labels: { font: { weight: 'bold', size: 9 }, usePointStyle: true, padding: 20 } }
                }
            }
        });

        function exportAnalytics() { console.log('Exporting...'); }
    </script>
}