@model CommunityCar.Application.Features.Dashboard.ViewModels.UserAnalyticsVM
@inject IViewLocalizer Localizer
@{
    ViewData["Title"] = Localizer["AnalyticsDashboard"];
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}

<div class="space-y-8 animate-in fade-in duration-700">
    <div id="analytics-skeleton" class="hidden space-y-8">
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
            <skeleton type="Card" />
            <skeleton type="Card" />
            <skeleton type="Card" />
            <skeleton type="Card" />
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-2 h-[350px] bg-card/40 animate-pulse rounded-xl border border-border"></div>
            <div class="h-[350px] bg-card/40 animate-pulse rounded-xl border border-border"></div>
        </div>
    </div>

    <div id="analytics-content" class="space-y-8">

    <!-- Key Metrics Row -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        <div class="eng-stat-group group">
            <div class="flex items-center justify-between mb-4 w-full">
                <h6 class="eng-stat-label">@Localizer["NewUsers"]</h6>
                <div class="p-2 rounded-lg bg-green-500/10 text-green-500 text-sm group-hover:scale-110 transition-transform">
                    <i class="fas fa-user-plus"></i>
                </div>
            </div>
            <div class="eng-stat-value">@Model.NewUsers.ToString("N0")</div>
            <div class="eng-stat-delta text-green-500">
                <i class="fas fa-arrow-up text-[8px]"></i> +12.5% <span class="opacity-40 ml-1">@Localizer["VsLastPeriod"]</span>
            </div>
        </div>
        
        <div class="eng-stat-group group">
            <div class="flex items-center justify-between mb-4 w-full">
                <h6 class="eng-stat-label">@Localizer["ActiveUsers"]</h6>
                <div class="p-2 rounded-lg bg-blue-500/10 text-blue-500 text-sm group-hover:scale-110 transition-transform">
                    <i class="fas fa-users"></i>
                </div>
            </div>
            <div class="eng-stat-value">@Model.ActiveUsers.ToString("N0")</div>
            <div class="eng-stat-delta text-blue-500">
                <i class="fas fa-arrow-up text-[8px]"></i> +8.3% <span class="opacity-40 ml-1">@Localizer["VsLastPeriod"]</span>
            </div>
        </div>
        
        <div class="eng-stat-group group">
            <div class="flex items-center justify-between mb-4 w-full">
                <h6 class="eng-stat-label">@Localizer["RetentionRate"]</h6>
                <div class="p-2 rounded-lg bg-indigo-500/10 text-indigo-500 text-sm group-hover:scale-110 transition-transform">
                    <i class="fas fa-chart-line"></i>
                </div>
            </div>
            <div class="eng-stat-value">@Model.RetentionRate.ToString("F1")%</div>
            <div class="eng-stat-delta text-indigo-500">
                <i class="fas fa-arrow-up text-[8px]"></i> +2.1% <span class="opacity-40 ml-1">@Localizer["VsLastPeriod"]</span>
            </div>
        </div>
        
        <div class="eng-stat-group group">
            <div class="flex items-center justify-between mb-4 w-full">
                <h6 class="eng-stat-label">@Localizer["AvgSession"]</h6>
                <div class="p-2 rounded-lg bg-amber-500/10 text-amber-500 text-sm group-hover:scale-110 transition-transform">
                    <i class="fas fa-clock"></i>
                </div>
            </div>
            <div class="eng-stat-value">@Model.AverageSessionDuration.ToString(@"mm\:ss")</div>
            <div class="eng-stat-delta text-destructive">
                <i class="fas fa-arrow-down text-[8px]"></i> -1.2% <span class="opacity-40 ml-1">@Localizer["VsLastPeriod"]</span>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="lg:col-span-2 eng-card overflow-hidden transition-all">
            <div class="eng-card-header">
                <h5 class="eng-card-title">@Localizer["UserGrowthTrend"]</h5>
            </div>
            <div class="p-6">
                <canvas id="userGrowthChart" class="w-full h-[300px]"
                        data-labels='@Html.Raw(Json.Serialize(Model.UserGrowthData.Select(x => x.Label)))'
                        data-datasets='[{"label": "@Localizer["NewUsers"]", "data": @Html.Raw(Json.Serialize(Model.UserGrowthData.Select(x => x.Value)))}, {"label": "@Localizer["ActiveUsers"]", "data": @Html.Raw(Json.Serialize(Model.ActivityData.Select(x => x.Value)))}]'></canvas>
            </div>
        </div>
        
        <div class="eng-card overflow-hidden transition-all">
            <div class="eng-card-header">
                <h5 class="eng-card-title">@Localizer["UserActivity"]</h5>
            </div>
            <div class="p-6">
                <canvas id="activityChart" class="w-full h-[300px]"
                        data-labels='["@Localizer["Posts"]", "@Localizer["Questions"]", "@Localizer["Answers"]", "@Localizer["Reviews"]", "@Localizer["Stories"]"]'
                        data-values='[@Model.PostsCreated, @Model.QuestionsAsked, @Model.AnswersGiven, @Model.ReviewsWritten, @Model.StoriesShared]'></canvas>
            </div>
        </div>
    </div>

    <!-- Detailed Analytics Row -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="eng-card overflow-hidden transition-all">
            <div class="eng-card-header">
                <h5 class="eng-card-title">@Localizer["UserEngagement"]</h5>
            </div>
            <div class="p-8 space-y-6">
                <div class="space-y-3">
                    <div class="flex justify-between items-end">
                        <span class="text-[11px] font-black uppercase tracking-widest opacity-60">@Localizer["PostsCreated"]</span>
                        <span class="text-base font-black tabular-nums">@Model.PostsCreated.ToString("N0")</span>
                    </div>
                    <div class="eng-progress-container h-1.5">
                        <div class="eng-progress-bar bg-blue-500 w-[85%]"></div>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <div class="flex justify-between items-end">
                        <span class="text-[11px] font-black uppercase tracking-widest opacity-60">@Localizer["QuestionsAsked"]</span>
                        <span class="text-base font-black tabular-nums">@Model.QuestionsAsked.ToString("N0")</span>
                    </div>
                    <div class="eng-progress-container h-1.5">
                        <div class="eng-progress-bar bg-green-500 w-[70%]"></div>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <div class="flex justify-between items-end">
                        <span class="text-[11px] font-black uppercase tracking-widest opacity-60">@Localizer["AnswersGiven"]</span>
                        <span class="text-base font-black tabular-nums">@Model.AnswersGiven.ToString("N0")</span>
                    </div>
                    <div class="eng-progress-container h-1.5">
                        <div class="eng-progress-bar bg-amber-500 w-[60%]"></div>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <div class="flex justify-between items-end">
                        <span class="text-[11px] font-black uppercase tracking-widest opacity-60">@Localizer["ReviewsWritten"]</span>
                        <span class="text-base font-black tabular-nums">@Model.ReviewsWritten.ToString("N0")</span>
                    </div>
                    <div class="eng-progress-container h-1.5">
                        <div class="eng-progress-bar bg-red-500 w-[45%]"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="eng-card overflow-hidden transition-all">
            <div class="eng-card-header">
                <h5 class="eng-card-title">@Localizer["UserDemographics"]</h5>
            </div>
            <div class="p-6 divide-y divide-border/30">
                <div class="flex items-center justify-between py-4 group/item">
                    <span class="text-[11px] font-bold text-muted-foreground uppercase tracking-widest opacity-70 group-hover/item:text-primary transition-colors">@Localizer["MostActiveDevice"]</span>
                    <span class="text-xs font-black text-foreground">@Model.DeviceType</span>
                </div>
                <div class="flex items-center justify-between py-4 group/item">
                    <span class="text-[11px] font-bold text-muted-foreground uppercase tracking-widest opacity-70 group-hover/item:text-primary transition-colors">@Localizer["PrimaryBrowser"]</span>
                    <span class="text-xs font-black text-foreground">@Model.BrowserType</span>
                </div>
                <div class="flex items-center justify-between py-4 group/item">
                    <span class="text-[11px] font-bold text-muted-foreground uppercase tracking-widest opacity-70 group-hover/item:text-primary transition-colors">@Localizer["TopLocation"]</span>
                    <span class="text-xs font-black text-foreground">@Model.Location</span>
                </div>
                <div class="flex items-center justify-between py-4 group/item">
                    <span class="text-[11px] font-bold text-muted-foreground uppercase tracking-widest opacity-70 group-hover/item:text-primary transition-colors">@Localizer["MostVisitedArea"]</span>
                    <span class="text-xs font-black text-foreground">@Model.MostVisitedSection</span>
                </div>
                <div class="flex items-center justify-between py-4 group/item">
                    <span class="text-[11px] font-bold text-muted-foreground uppercase tracking-widest opacity-70 group-hover/item:text-primary transition-colors">@Localizer["TotalPageViews"]</span>
                    <span class="text-xs font-black text-foreground tabular-nums">@Model.PageViews.ToString("N0")</span>
                </div>
                <div class="flex items-center justify-between py-4 group/item">
                    <span class="text-[11px] font-bold text-muted-foreground uppercase tracking-widest opacity-70 group-hover/item:text-primary transition-colors">@Localizer["TimeOnSite"]</span>
                    <span class="text-xs font-black text-foreground tabular-nums">@Model.TimeSpentOnSite.ToString(@"hh\:mm\:ss")</span>
                </div>
            </div>
        </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="~/js/dashboard-charts.js" asp-append-version="true"></script>
    <script>
        function exportAnalytics() { console.log('Exporting...'); }
    </script>
}