@model CommunityCar.Application.Features.Dashboard.ViewModels.UserAnalyticsVM
@{
    ViewData["Title"] = "Analytics Dashboard";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}

<div class="dashboard-analytics">
    <!-- Analytics Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="dashboard-title">Analytics Dashboard</h2>
        <div class="analytics-controls">
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-outline-primary active" data-range="7">7 Days</button>
                <button type="button" class="btn btn-outline-primary" data-range="30">30 Days</button>
                <button type="button" class="btn btn-outline-primary" data-range="90">90 Days</button>
            </div>
            <button class="btn btn-primary ms-2" onclick="exportAnalytics()">
                <i class="fas fa-download"></i> Export
            </button>
        </div>
    </div>

    <!-- Key Metrics Row -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card metric-card">
                <div class="card-body">
                    <div class="metric-header">
                        <h6 class="metric-title">New Users</h6>
                        <i class="fas fa-user-plus metric-icon text-success"></i>
                    </div>
                    <div class="metric-value">@Model.NewUsers.ToString("N0")</div>
                    <div class="metric-change positive">
                        <i class="fas fa-arrow-up"></i> +12.5%
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card metric-card">
                <div class="card-body">
                    <div class="metric-header">
                        <h6 class="metric-title">Active Users</h6>
                        <i class="fas fa-users metric-icon text-primary"></i>
                    </div>
                    <div class="metric-value">@Model.ActiveUsers.ToString("N0")</div>
                    <div class="metric-change positive">
                        <i class="fas fa-arrow-up"></i> +8.3%
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card metric-card">
                <div class="card-body">
                    <div class="metric-header">
                        <h6 class="metric-title">Retention Rate</h6>
                        <i class="fas fa-chart-line metric-icon text-info"></i>
                    </div>
                    <div class="metric-value">@Model.RetentionRate.ToString("F1")%</div>
                    <div class="metric-change positive">
                        <i class="fas fa-arrow-up"></i> +2.1%
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card metric-card">
                <div class="card-body">
                    <div class="metric-header">
                        <h6 class="metric-title">Avg Session</h6>
                        <i class="fas fa-clock metric-icon text-warning"></i>
                    </div>
                    <div class="metric-value">@Model.AverageSessionDuration.ToString(@"mm\:ss")</div>
                    <div class="metric-change negative">
                        <i class="fas fa-arrow-down"></i> -1.2%
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="row mb-4">
        <div class="col-lg-8 mb-3">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">User Growth Trend</h5>
                </div>
                <div class="card-body">
                    <canvas id="userGrowthChart" height="300"></canvas>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 mb-3">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">User Activity</h5>
                </div>
                <div class="card-body">
                    <canvas id="activityChart" height="300"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Detailed Analytics Row -->
    <div class="row">
        <div class="col-lg-6 mb-3">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">User Engagement</h5>
                </div>
                <div class="card-body">
                    <div class="engagement-metrics">
                        <div class="engagement-item">
                            <div class="engagement-label">Posts Created</div>
                            <div class="engagement-value">@Model.PostsCreated.ToString("N0")</div>
                            <div class="engagement-bar">
                                <div class="engagement-progress" style="width: 85%"></div>
                            </div>
                        </div>
                        
                        <div class="engagement-item">
                            <div class="engagement-label">Questions Asked</div>
                            <div class="engagement-value">@Model.QuestionsAsked.ToString("N0")</div>
                            <div class="engagement-bar">
                                <div class="engagement-progress" style="width: 70%"></div>
                            </div>
                        </div>
                        
                        <div class="engagement-item">
                            <div class="engagement-label">Answers Given</div>
                            <div class="engagement-value">@Model.AnswersGiven.ToString("N0")</div>
                            <div class="engagement-bar">
                                <div class="engagement-progress" style="width: 60%"></div>
                            </div>
                        </div>
                        
                        <div class="engagement-item">
                            <div class="engagement-label">Reviews Written</div>
                            <div class="engagement-value">@Model.ReviewsWritten.ToString("N0")</div>
                            <div class="engagement-bar">
                                <div class="engagement-progress" style="width: 45%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6 mb-3">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">User Demographics</h5>
                </div>
                <div class="card-body">
                    <div class="demographics-info">
                        <div class="demo-item">
                            <span class="demo-label">Most Active Device:</span>
                            <span class="demo-value">@Model.DeviceType</span>
                        </div>
                        <div class="demo-item">
                            <span class="demo-label">Primary Browser:</span>
                            <span class="demo-value">@Model.BrowserType</span>
                        </div>
                        <div class="demo-item">
                            <span class="demo-label">Top Location:</span>
                            <span class="demo-value">@Model.Location</span>
                        </div>
                        <div class="demo-item">
                            <span class="demo-label">Most Visited Section:</span>
                            <span class="demo-value">@Model.MostVisitedSection</span>
                        </div>
                        <div class="demo-item">
                            <span class="demo-label">Total Page Views:</span>
                            <span class="demo-value">@Model.PageViews.ToString("N0")</span>
                        </div>
                        <div class="demo-item">
                            <span class="demo-label">Time on Site:</span>
                            <span class="demo-value">@Model.TimeSpentOnSite.ToString(@"hh\:mm\:ss")</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // User Growth Chart
        const userGrowthCtx = document.getElementById('userGrowthChart').getContext('2d');
        const userGrowthChart = new Chart(userGrowthCtx, {
            type: 'line',
            data: {
                labels: @Html.Raw(Json.Serialize(Model.UserGrowthData.Select(x => x.Label))),
                datasets: [{
                    label: 'New Users',
                    data: @Html.Raw(Json.Serialize(Model.UserGrowthData.Select(x => x.Value))),
                    borderColor: '#007bff',
                    backgroundColor: 'rgba(0, 123, 255, 0.1)',
                    tension: 0.4,
                    fill: true
                }, {
                    label: 'Active Users',
                    data: @Html.Raw(Json.Serialize(Model.ActivityData.Select(x => x.Value))),
                    borderColor: '#28a745',
                    backgroundColor: 'rgba(40, 167, 69, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Activity Doughnut Chart
        const activityCtx = document.getElementById('activityChart').getContext('2d');
        const activityChart = new Chart(activityCtx, {
            type: 'doughnut',
            data: {
                labels: ['Posts', 'Questions', 'Answers', 'Reviews', 'Stories'],
                datasets: [{
                    data: [@Model.PostsCreated, @Model.QuestionsAsked, @Model.AnswersGiven, @Model.ReviewsWritten, @Model.StoriesShared],
                    backgroundColor: [
                        '#007bff',
                        '#28a745',
                        '#ffc107',
                        '#dc3545',
                        '#6f42c1'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

        // Export function
        function exportAnalytics() {
            // In real implementation, generate and download analytics report
            console.log('Exporting analytics data...');
        }

        // Range selector
        document.querySelectorAll('[data-range]').forEach(button => {
            button.addEventListener('click', function() {
                document.querySelectorAll('[data-range]').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                const range = this.getAttribute('data-range');
                loadAnalyticsData(range);
            });
        });

        function loadAnalyticsData(range) {
            // In real implementation, load data for the selected range
            console.log('Loading analytics data for range:', range);
        }
    </script>
}