@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer
@{
    int currentPage = ViewBag.CurrentPage ?? 1;
    int pageSize = ViewBag.PageSize ?? 10;
}
<div class="d-flex flex-column gap-5 animate-in fade-in duration-700">
    <!-- Header -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-4">
        <div>
            <h1 class="h2 fw-black text-gradient mb-1">@Localizer["Reports"]</h1>
            <p class="text-sm fw-bold text-muted-foreground opacity-70">@Localizer["ReportsDesc"]</p>
        </div>
        <div class="d-flex align-items-center gap-3">
            <a href="@Url.Action("Generate", "Reports")" 
               class="btn btn-primary-red px-4 text-[10px] fw-black text-uppercase tracking-widest shadow-lg shadow-primary-red shadow-opacity-20 d-flex align-items-center gap-2 group">
                <i data-lucide="plus" class="w-4 h-4 group-hover:rotate-90 transition-transform"></i>
                @Localizer["GenerateReport"]
            </a>
        </div>
    </div>

    <!-- Success/Error Messages -->
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert bg-success bg-opacity-10 border border-success border-opacity-20 text-success rounded-4 p-4 shadow-lg shadow-success shadow-opacity-10 animate-in slide-in-from-top duration-300">
            <div class="d-flex align-items-center gap-3">
                <i data-lucide="check-circle" class="w-5 h-5"></i>
                <span class="fw-bold">@TempData["SuccessMessage"]</span>
            </div>
        </div>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert bg-danger bg-opacity-10 border border-danger border-opacity-20 text-danger rounded-4 p-4 shadow-lg shadow-danger shadow-opacity-10 animate-in slide-in-from-top duration-300">
            <div class="d-flex align-items-center gap-3">
                <i data-lucide="alert-circle" class="w-5 h-5"></i>
                <span class="fw-bold">@TempData["ErrorMessage"]</span>
            </div>
        </div>
    }

    <div class="card card-premium shadow-xl overflow-hidden border-border border-opacity-50">
        <!-- Reports Hero Section -->
        <div class="card-header border-0 bg-transparent p-4 p-md-5 pb-0">
            <div class="d-flex flex-column gap-4">
                <div class="d-flex align-items-center gap-3 mb-2">
                    <span class="badge rounded-pill bg-primary-red bg-opacity-10 text-primary-red border border-primary-red border-opacity-20 text-[9px] fw-black px-3 py-1.5 uppercase tracking-widest">
                        <i data-lucide="database" class="w-3 h-3 me-1"></i> SYSTEM ANALYTICS
                    </span>
                    <span class="text-[10px] fw-black text-muted-foreground opacity-40 uppercase tracking-widest">@string.Format("GENERATED {0}", DateTime.Now.ToString("MMM dd, yyyy"))</span>
                </div>

                <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-4 pt-4 border-t border-border border-opacity-20">
                    <div class="d-flex align-items-center gap-4">
                        <div class="w-14 h-14 rounded-4 bg-primary-red bg-opacity-10 border border-primary-red border-opacity-10 d-flex align-items-center justify-content-center shadow-inner group">
                            <i data-lucide="bar-chart-3" class="w-7 h-7 text-primary-red group-hover:scale-110 transition-transform"></i>
                        </div>
                        <div>
                            <span class="h5 fw-black text-foreground d-block mb-1">@Localizer["GeneratedReports"]</span>
                            <span class="text-[10px] fw-black text-muted-foreground opacity-40 uppercase tracking-widest">@Localizer["SystemContributor"]</span>
                        </div>
                    </div>
                    
                    <div class="d-flex gap-5">
                        <div class="text-right">
                            <span class="h4 fw-black text-foreground d-block mb-0 tabular-nums">@(Model?.Count.ToString("N0") ?? "0")</span>
                            <span class="text-[8px] fw-black text-muted-foreground opacity-40 uppercase tracking-widest">@Localizer["TotalReports"]</span>
                        </div>
                        <div class="text-right">
                            @{
                                int completedCount = 0;
                                if (Model != null)
                                {
                                    foreach (var report in Model)
                                    {
                                        if (report.Status.ToLower() == "generated")
                                        {
                                            completedCount++;
                                        }
                                    }
                                }
                            }
                            <span class="h4 fw-black text-foreground d-block mb-0 tabular-nums">@completedCount</span>
                            <span class="text-[8px] fw-black text-muted-foreground opacity-40 uppercase tracking-widest">@Localizer["Completed"]</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports List -->
        <div class="card-body p-4 p-md-5 bg-muted-subtle bg-opacity-20 border-y border-border border-opacity-20">
            <div id="reports-skeleton" class="d-none">
                <div class="d-flex flex-column gap-3">
                    @for (int i = 0; i < 4; i++) {
                        <div class="h-16 bg-muted animate-pulse rounded-4 w-100"></div>
                    }
                </div>
            </div>
            <div id="reports-list-container">
            @if (Model != null && Model.Count > 0)
            {
                <div class="d-flex flex-column gap-4">
                    @foreach (var report in Model)
                    {
                        <div class="card card-premium-subtle border-border border-opacity-40 rounded-4 p-4 hover-bg-muted-subtle transition-all group">
                            <div class="d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between gap-4">
                                <div class="d-flex align-items-center gap-4 flex-grow-1">
                                    <div class="w-12 h-12 rounded-4 bg-primary-red bg-opacity-10 d-flex align-items-center justify-content-center text-primary-red border border-primary-red border-opacity-10 shrink-0 group-hover:scale-110 transition-transform shadow-sm">
                                        <i data-lucide="file-text" class="w-6 h-6"></i>
                                    </div>
                                    <div class="flex-grow-1 min-w-0">
                                        <h6 class="text-[15px] fw-black text-foreground mb-1 tracking-tight group-hover:text-primary-red transition-colors">
                                            @report.ReportType
                                        </h6>
                                        <p class="text-sm text-muted-foreground opacity-70 mb-2 truncate">@report.Description</p>
                                        <div class="d-flex align-items-center gap-4 text-[10px] fw-black text-muted-foreground opacity-60 uppercase tracking-widest">
                                            <span>@report.StartDate.ToString("MMM dd") - @report.EndDate.ToString("MMM dd, yyyy")</span>
                                            <span>â€¢</span>
                                            <span>@report.CreatedAt.ToString("HH:mm")</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="d-flex align-items-center gap-4">
                                    @{
                                        var statusConfig = report.Status.ToLower() switch
                                        {
                                            "generated" => new { Class = "bg-success bg-opacity-10 text-success border-success border-opacity-20", Icon = "check-circle", Text = "COMPLETED" },
                                            "generating" => new { Class = "bg-warning bg-opacity-10 text-warning border-warning border-opacity-20", Icon = "loader-2", Text = "PROCESSING" },
                                            "failed" => new { Class = "bg-danger bg-opacity-10 text-danger border-danger border-opacity-20", Icon = "x-circle", Text = "FAILED" },
                                            "scheduled" => new { Class = "bg-info bg-opacity-10 text-info border-info border-opacity-20", Icon = "clock", Text = "SCHEDULED" },
                                            _ => new { Class = "bg-muted-subtle text-muted-foreground border-border border-opacity-40", Icon = "help-circle", Text = "UNKNOWN" }
                                        };
                                    }
                                    <span class="badge rounded-pill @statusConfig.Class border text-[9px] fw-black px-3 py-1.5 uppercase tracking-widest d-flex align-items-center gap-2">
                                        <i data-lucide="@statusConfig.Icon" class="w-3.5 h-3.5 @(statusConfig.Icon == "loader-2" ? "animate-spin" : "")"></i>
                                        @statusConfig.Text
                                    </span>
                                    
                                    <div class="d-flex gap-2">
                                        <a href="@Url.Action("Details", "Reports", new { id = report.Id })" 
                                           class="btn btn-muted-subtle btn-sm p-2 rounded-3 text-muted-foreground hover-text-primary-red transition-all shadow-none d-flex align-items-center justify-content-center" style="width: 36px; height: 36px;">
                                            <i data-lucide="eye" class="w-4 h-4"></i>
                                        </a>
                                        @if (report.Status.ToLower() == "generated")
                                        {
                                            <a href="@Url.Action("Download", "Reports", new { id = report.Id })" 
                                               class="btn btn-muted-subtle btn-sm p-2 rounded-3 text-muted-foreground hover-text-primary-red transition-all shadow-none d-flex align-items-center justify-content-center" style="width: 36px; height: 36px;">
                                                <i data-lucide="download" class="w-4 h-4"></i>
                                            </a>
                                        }
                                        <form asp-action="Delete" asp-route-id="@report.Id" method="post" class="delete-report-form d-inline-block">
                                            @Html.AntiForgeryToken()
                                            <button type="button" 
                                                    class="btn btn-muted-subtle btn-sm p-2 rounded-3 text-muted-foreground hover-text-danger transition-all shadow-none d-flex align-items-center justify-content-center" style="width: 36px; height: 36px;"
                                                    data-action="confirm-delete-report">
                                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>

                <!-- Pagination -->
                @if (currentPage > 1 || Model.Count() >= pageSize)
                {
                    <div class="mt-5 pt-4 border-t border-border border-opacity-20 d-flex align-items-center justify-content-between">
                        <div class="text-[10px] fw-black text-muted-foreground opacity-40 uppercase tracking-widest">
                            @string.Format(Localizer["ShowingPageOfReports"].Value, currentPage)
                        </div>
                        <div class="d-flex gap-2">
                            @if (currentPage > 1)
                            {
                                <a href="@Url.Action("Index", new { page = currentPage - 1, pageSize })" 
                                   class="btn btn-muted-subtle btn-sm px-4 rounded-3 text-[10px] fw-black text-uppercase tracking-widest hover-text-primary-red d-flex align-items-center gap-2">
                                    <i data-lucide="chevron-left" class="w-3.5 h-3.5"></i>
                                    @Localizer["Previous"]
                                </a>
                            }
                            <a href="@Url.Action("Index", new { page = currentPage + 1, pageSize })" 
                               class="btn btn-muted-subtle btn-sm px-4 rounded-3 text-[10px] fw-black text-uppercase tracking-widest hover-text-primary-red d-flex align-items-center gap-2">
                                @Localizer["Next"]
                                <i data-lucide="chevron-right" class="w-3.5 h-3.5"></i>
                            </a>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="text-center py-12 opacity-40">
                    <div class="w-20 h-20 bg-muted bg-opacity-40 rounded-circle d-flex align-items-center justify-content-center mx-auto mb-4 border border-border border-opacity-20 shadow-inner">
                        <i data-lucide="file-text" class="w-10 h-10 text-muted-foreground"></i>
                    </div>
                    <h3 class="h5 fw-black text-foreground mb-2 mt-4 tracking-tight">@Localizer["NoReportsFound"]</h3>
                    <p class="text-sm fw-bold text-muted-foreground max-w-sm mx-auto mb-5">@Localizer["NoReportsFoundDesc"]</p>
                    <a href="@Url.Action("Generate", "Reports")" 
                       class="btn btn-primary-red px-5 py-3 rounded-4 text-[10px] fw-black text-uppercase tracking-widest shadow-xl shadow-primary-red shadow-opacity-30">
                        <i data-lucide="plus" class="w-4 h-4 me-2"></i>
                        @Localizer["GenerateYourFirstReport"]
                    </a>
                </div>
            }
            </div>
        </div>

        <!-- Footer Strip -->
        <div class="card-footer border-0 bg-transparent p-4 p-md-5 pt-0 mt-n4">
            <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-4">
                <div class="d-flex align-items-center gap-4">
                    <button class="btn btn-muted-subtle px-3 py-2 rounded-3 text-[9px] fw-black text-uppercase tracking-widest text-muted-foreground hover-text-primary-red d-flex align-items-center gap-2">
                        <i data-lucide="refresh-cw" class="w-3.5 h-3.5"></i>
                        @Localizer["RefreshReports"]
                    </button>
                    <button class="btn btn-muted-subtle px-3 py-2 rounded-3 text-[9px] fw-black text-uppercase tracking-widest text-muted-foreground hover-text-info d-flex align-items-center gap-2">
                        <i data-lucide="filter" class="w-3.5 h-3.5"></i>
                        @Localizer["FilterReports"]
                    </button>
                </div>

                <div class="d-flex gap-2">
                    <button class="btn btn-muted-subtle p-2 rounded-3 text-muted-foreground hover-text-primary-red transition-all" style="width: 36px; height: 36px;">
                        <i data-lucide="download" class="w-4 h-4"></i>
                    </button>
                    <button class="btn btn-muted-subtle p-2 rounded-3 text-muted-foreground hover-text-primary-red transition-all" style="width: 36px; height: 36px;">
                        <i data-lucide="settings" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- System Metadata -->
    <div class="card card-premium shadow-lg border-border border-opacity-30 overflow-hidden">
        <div class="card-body p-4 bg-muted-subtle bg-opacity-20">
            <div class="row g-4 text-center text-md-start">
                <div class="col-12 col-md-3 border-md-end border-border border-opacity-20 px-4">
                    <span class="text-[10px] fw-black text-muted-foreground opacity-40 uppercase tracking-widest mb-1 d-block">@Localizer["SystemID"]</span>
                    <code class="text-xs fw-black text-primary-red">REPORTS-@DateTime.Now.ToString("yyyyMMdd")</code>
                </div>
                <div class="col-12 col-md-3 border-md-end border-border border-opacity-20 px-4">
                    <span class="text-[10px] fw-black text-muted-foreground opacity-40 uppercase tracking-widest mb-1 d-block">@Localizer["DataFormat"]</span>
                    <span class="text-xs fw-black text-foreground">JSON/CSV</span>
                </div>
                <div class="col-12 col-md-3 border-md-end border-border border-opacity-20 px-4">
                    <span class="text-[10px] fw-black text-muted-foreground opacity-40 uppercase tracking-widest mb-1 d-block">@Localizer["Generator"]</span>
                    <span class="text-xs fw-black text-foreground uppercase">DASHBOARD-ANALYTICS</span>
                </div>
                <div class="col-12 col-md-3 px-4 text-md-end">
                    <span class="text-[10px] fw-black text-muted-foreground opacity-40 uppercase tracking-widest mb-1 d-block">@Localizer["Status"]</span>
                    <span class="d-flex align-items-center justify-content-center justify-content-md-end gap-2 text-xs fw-black text-success uppercase">
                        <span class="w-1.5 h-1.5 rounded-circle bg-success animate-pulse"></span>
                        @Localizer["SystemOnline"]
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/modules/dashboard/reports-controller.js" asp-append-version="true"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (CC.Modules.Dashboard.Reports) {
                CC.Modules.Dashboard.Reports.init();
            }
        });
    </script>
}
