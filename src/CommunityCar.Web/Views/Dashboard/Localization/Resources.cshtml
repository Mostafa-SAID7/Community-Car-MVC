@inject IViewLocalizer Localizer
@model CommunityCar.Application.Features.Dashboard.Localization.ViewModels.ResourcesVM
@{
    ViewData["Title"] = Localizer["DictionaryExplorerTitle"];
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
    ViewData["UseModernTheme"] = true;
}

<div class="animate-slide-up">
    <!-- Top Header Section -->
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h1 class="page-title mb-2">@Localizer["DictionaryExplorer"]</h1>
            <p class="text-muted fw-medium">@string.Format(Localizer["ActiveEntriesDesc"].Value, Model.Pagination.TotalItems)</p>
        </div>
        <a href="@Url.Action("AddResource", "Localization")" class="btn-modern-primary">
            <i data-lucide="plus" class="w-5 h-5"></i>
            @Localizer["NewEntry"]
        </a>
    </div>

    <!-- Filter Console -->
    <div class="card-modern p-4 mb-4" style="border-radius: 1.5rem;">
        <form method="get" class="row g-3 align-items-end">
            <div class="col-12 col-md-3">
                <label class="modern-label">@Localizer["NamespaceCulture"]</label>
                <select name="culture" class="modern-select">
                    <option value="">@Localizer["GlobalDictionary"]</option>
                    @foreach (var c in Model.Cultures)
                    {
                        <option value="@c" selected="@(Model.SelectedCulture == c)">@c</option>
                    }
                </select>
            </div>
            <div class="col-12 col-md-3">
                <label class="modern-label">@Localizer["TargetFileGroup"]</label>
                <select name="group" class="modern-select">
                    <option value="">@Localizer["AllResourceFiles"]</option>
                    @foreach (var g in Model.ResourceGroups)
                    {
                        <option value="@g" selected="@(Model.SelectedGroup == g)">@g</option>
                    }
                </select>
            </div>
            <div class="col-12 col-md-4">
                <label class="modern-label">@Localizer["SearchKeywords"]</label>
                <div class="position-relative">
                    <i data-lucide="search" class="position-absolute translate-middle-y text-muted" style="left: 1rem; top: 50%; width: 1rem; height: 1rem;"></i>
                    <input type="text" name="search" class="modern-input" style="padding-left: 2.75rem;" value="@Model.SearchTerm" placeholder="@Localizer["SearchKeywords"]...">
                </div>
            </div>
            <div class="col-12 col-md-2">
                <div class="d-flex gap-2">
                    <button type="submit" class="btn-modern-primary w-100 justify-content-center">@Localizer["Search"]</button>
                    <a href="@Url.Action("Resources")" class="btn-icon-modern" style="height: 48px; width: 48px; border-radius: 1rem;"><i data-lucide="rotate-ccw" class="w-4 h-4"></i></a>
                </div>
            </div>
        </form>
    </div>

    <!-- Data Table -->
    <div class="card-modern p-0 overflow-hidden">
        <div class="modern-table-container border-0">
            <table class="modern-table">
                <thead>
                    <tr>
                        <th>@Localizer["ResourceKey"]</th>
                        <th class="text-center">@Localizer["CultureID"]</th>
                        <th class="text-center">@Localizer["Group"]</th>
                        <th>@Localizer["MappedValue"]</th>
                        <th class="text-end">@Localizer["Actions"]</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var resource in Model.Resources)
                    {
                        <tr>
                            <td>
                                <code class="badge bg-light text-primary font-monospace px-2 py-1 border">@resource.Key</code>
                            </td>
                            <td class="text-center">
                                <span class="modern-badge modern-badge-info">@resource.Culture</span>
                            </td>
                            <td class="text-center">
                                <span class="modern-badge modern-badge-outline">@resource.ResourceGroup</span>
                            </td>
                            <td>
                                <div class="text-truncate" style="max-width: 400px;" title="@resource.Value">@resource.Value</div>
                            </td>
                            <td class="text-end">
                                <div class="d-flex justify-content-end gap-2">
                                    <a href="@Url.Action("EditResource", "Localization", new { id = resource.Id })" class="btn-icon-modern">
                                        <i data-lucide="edit-3" class="w-4 h-4"></i>
                                    </a>
                                    <form asp-action="DeleteResource" asp-route-id="@resource.Id" method="post" class="inline delete-resource-form">
                                        @Html.AntiForgeryToken()
                                        <button type="button" data-action="confirm-delete-resource" class="btn-icon-modern danger">
                                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    }
                    @if (!Model.Resources.Any())
                    {
                        <tr>
                            <td colspan="5" class="text-center py-5">
                                <div class="py-5">
                                    <i data-lucide="search-x" class="w-10 h-10 text-muted mb-3"></i>
                                    <h5 class="fw-black text-muted">@Localizer["NoResourcesFound"]</h5>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        @if (Model.Pagination.TotalPages > 1)
        {
            <div class="p-4 border-top d-flex justify-content-between align-items-center bg-light bg-opacity-50">
                <span class="modern-page-info">
                    @string.Format(Localizer["ShowingEntries"].Value, Model.Pagination.StartItem, Model.Pagination.EndItem, Model.Pagination.TotalItems)
                </span>
                
                <div class="modern-pagination">
                    <a href="@(Model.Pagination.HasPreviousPage ? Url.Action("Resources", new { culture = Model.SelectedCulture, group = Model.SelectedGroup, search = Model.SearchTerm, page = Model.Pagination.CurrentPage - 1 }) : "#")" 
                       class="modern-page-item @(!Model.Pagination.HasPreviousPage ? "disabled" : "")">
                        <i data-lucide="chevron-left" class="w-4 h-4"></i>
                    </a>

                    <div class="modern-page-info px-2">
                        @string.Format(Localizer["PageOf"].Value, Model.Pagination.CurrentPage, Model.Pagination.TotalPages)
                    </div>

                    <a href="@(Model.Pagination.HasNextPage ? Url.Action("Resources", new { culture = Model.SelectedCulture, group = Model.SelectedGroup, search = Model.SearchTerm, page = Model.Pagination.CurrentPage + 1 }) : "#")" 
                       class="modern-page-item @(!Model.Pagination.HasNextPage ? "disabled" : "")">
                        <i data-lucide="chevron-right" class="w-4 h-4"></i>
                    </a>
                </div>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script src="~/js/dashboard-localization.js" asp-append-version="true"></script>
}
