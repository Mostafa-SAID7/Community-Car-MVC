@model IEnumerable<CommunityCar.Application.Features.Dashboard.ViewModels.UserManagementVM>
@inject IViewLocalizer Localizer
@{
    ViewData["Title"] = Localizer["AdminControl"];
    Layout = "_DashboardLayout";
}

<div class="d-flex flex-column gap-5 animate-in fade-in duration-700">
    <!-- Header -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-4">
        <div>
            <h1 class="h2 fw-black text-gradient-red mb-1">@Localizer["AdminControl"]</h1>
            <p class="small fw-bold text-muted opacity-70">@Localizer["ReviewManageLogs"]</p>
        </div>
        <div class="d-flex align-items-center gap-3">
            <button class="btn btn-primary-red px-4 py-2 rounded-3 xx-small fw-black text-uppercase tracking-widest shadow-lg active-scale-95 transition-all">
                <i data-lucide="file-output" class="w-16px h-16px me-2"></i> @Localizer["ExportLogs"]
            </button>
        </div>
    </div>

    <!-- Management Table -->
    <div class="card card-premium shadow-xl overflow-hidden mb-4">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead>
                    <tr class="bg-muted bg-opacity-5 border-bottom border-border border-opacity-50">
                        <th class="px-4 py-3 xx-small fw-black text-uppercase tracking-widest text-muted border-0">@Localizer["User"]</th>
                        <th class="px-4 py-3 xx-small fw-black text-uppercase tracking-widest text-muted border-0">@Localizer["Action"]</th>
                        <th class="px-4 py-3 xx-small fw-black text-uppercase tracking-widest text-muted border-0">@Localizer["Reason"]</th>
                        <th class="px-4 py-3 xx-small fw-black text-uppercase tracking-widest text-muted border-0">@Localizer["Date"]</th>
                        <th class="px-4 py-3 xx-small fw-black text-uppercase tracking-widest text-muted border-0">@Localizer["PerformedBy"]</th>
                        <th class="px-4 py-3 xx-small fw-black text-uppercase tracking-widest text-muted border-0 text-end">@Localizer["Actions"]</th>
                    </tr>
                </thead>
                <tbody class="border-border border-opacity-10" id="management-list-container">
                    <tr id="management-skeleton" class="d-none">
                        <td colspan="6" class="p-4">
                            <div class="d-flex flex-column gap-2">
                                <div class="h-12px bg-muted bg-opacity-10 animate-pulse rounded w-100"></div>
                                <div class="h-12px bg-muted bg-opacity-10 animate-pulse rounded w-100"></div>
                                <div class="h-12px bg-muted bg-opacity-10 animate-pulse rounded w-100"></div>
                            </div>
                        </td>
                    </tr>
                    @foreach (var item in Model)
                    {
                        <tr class="transition-all group">
                            <td class="px-4 py-3 border-border border-opacity-10">
                                <div class="d-flex flex-column">
                                    <span class="small fw-black text-foreground italic text-decoration-underline text-decoration-opacity-30 group-hover:text-decoration-opacity-100 transition-all">@item.UserName</span>
                                    <span class="xx-small fw-bold text-muted opacity-60">@item.Email</span>
                                </div>
                            </td>
                            <td class="px-4 py-3 border-border border-opacity-10">
                                <span class="badge rounded-pill bg-primary bg-opacity-10 text-primary border border-primary border-opacity-20 xx-small fw-black text-uppercase tracking-tighter px-2 py-1">
                                    @item.Action
                                </span>
                            </td>
                            <td class="px-4 py-3 border-border border-opacity-10">
                                <span class="x-small fw-bold text-foreground opacity-80 text-truncate d-inline-block" style="max-width: 200px;">@item.Reason</span>
                            </td>
                            <td class="px-4 py-3 border-border border-opacity-10 xx-small fw-black text-muted tabular-nums opacity-80">
                                @item.ActionDate.ToString("MMM dd, yyyy HH:mm")
                            </td>
                            <td class="px-4 py-3 border-border border-opacity-10 x-small fw-bold text-foreground opacity-70">
                                @item.PerformedByName
                            </td>
                            <td class="px-4 py-3 border-border border-opacity-10 text-end">
                                <div class="d-flex justify-content-end gap-2">
                                    @if (item.IsReversible)
                                    {
                                        <form asp-action="ReverseAction" asp-route-actionId="@item.Id" method="post" class="d-inline">
                                            @Html.AntiForgeryToken()
                                            <button type="submit" class="btn btn-muted bg-opacity-5 btn-sm p-2 rounded-3 text-danger hover-bg-danger hover-bg-opacity-10 transition-all" title="@Localizer["ReverseAction"]">
                                                <i data-lucide="undo-2" class="w-16px h-16px"></i>
                                            </button>
                                        </form>
                                    }
                                    <a href="@Url.Action("UserHistory", new { userId = item.UserId })" class="btn btn-muted bg-opacity-5 btn-sm p-2 rounded-3 text-primary hover-bg-primary hover-bg-opacity-10 transition-all" title="@Localizer["ViewUserHistory"]">
                                        <i data-lucide="history" class="w-16px h-16px"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    <!-- Pagination -->
    <div class="d-flex align-items-center justify-content-between pb-5">
        <p class="xx-small fw-black text-uppercase tracking-widest text-muted opacity-50 mb-0">
            @Localizer["ShowingRecords"] @ViewBag.CurrentPage
        </p>
        <div class="d-flex gap-2">
            <a href="?page=@(ViewBag.CurrentPage - 1)&pageSize=@ViewBag.PageSize" class="btn btn-muted bg-opacity-5 border border-border px-4 py-2 rounded-3 xx-small fw-black text-uppercase tracking-widest transition-all @(ViewBag.CurrentPage <= 1 ? "disabled opacity-30" : "hover-bg-muted hover-bg-opacity-10")">
                @Localizer["Previous"]
            </a>
            <a href="?page=@(ViewBag.CurrentPage + 1)&pageSize=@ViewBag.PageSize" class="btn btn-muted bg-opacity-5 border border-border px-4 py-2 rounded-3 xx-small fw-black text-uppercase tracking-widest hover-bg-muted hover-bg-opacity-10 transition-all">
                @Localizer["Next"]
            </a>
        </div>
    </div>
</div>
