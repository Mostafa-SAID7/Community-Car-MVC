@inject IViewLocalizer Localizer
@{
    ViewData["Title"] = Localizer["ErrorReportsTitle"];
    Layout = "_DashboardLayout";
}

<div class="space-y-8">
    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-6">
        <div>
            <h1 class="text-2xl font-black text-foreground tracking-tight flex items-center gap-3">
                <i data-lucide="flag" class="w-6 h-6 text-primary"></i>
                @Localizer["ErrorReports"]
            </h1>
            <p class="text-sm text-muted-foreground mt-1">@Localizer["ErrorReportsDesc"]</p>
        </div>
        
        <div class="flex items-center gap-4">
            <select id="statusFilter" class="px-4 py-2 border border-border rounded-lg bg-background text-foreground">
                <option value="">@Localizer["AllStatus"]</option>
                <option value="new">@Localizer["StatusNew"]</option>
                <option value="in-progress">@Localizer["StatusInProgress"]</option>
                <option value="resolved">@Localizer["StatusResolved"]</option>
                <option value="closed">@Localizer["StatusClosed"]</option>
            </select>
            <select id="priorityFilter" class="px-4 py-2 border border-border rounded-lg bg-background text-foreground">
                <option value="">@Localizer["AllPriority"]</option>
                <option value="Critical">@Localizer["PriorityCritical"]</option>
                <option value="High">@Localizer["PriorityHigh"]</option>
                <option value="Medium">@Localizer["PriorityMedium"]</option>
                <option value="Low">@Localizer["PriorityLow"]</option>
            </select>
        </div>
    </div>

    <!-- Stats Cards -->
    <div id="stats-skeleton" class="hidden grid grid-cols-1 md:grid-cols-4 gap-6">
        <skeleton type="Card" class="h-24" />
        <skeleton type="Card" class="h-24" />
        <skeleton type="Card" class="h-24" />
        <skeleton type="Card" class="h-24" />
    </div>

    <div class="grid grid-cols-1 md:grid-cols-4 gap-6" id="stats-content">
        <div class="bg-gradient-to-br from-red-500/10 to-red-600/10 border border-red-500/20 rounded-2xl p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-red-600 font-bold text-sm">@Localizer["CriticalIssues"]</p>
                    <p class="text-2xl font-black text-foreground" id="criticalCount">0</p>
                </div>
                <i data-lucide="alert-triangle" class="w-8 h-8 text-red-500"></i>
            </div>
        </div>
        <div class="bg-gradient-to-br from-orange-500/10 to-orange-600/10 border border-orange-500/20 rounded-2xl p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-orange-600 font-bold text-sm">@Localizer["HighPriority"]</p>
                    <p class="text-2xl font-black text-foreground" id="highCount">0</p>
                </div>
                <i data-lucide="alert-circle" class="w-8 h-8 text-orange-500"></i>
            </div>
        </div>
        <div class="bg-gradient-to-br from-blue-500/10 to-blue-600/10 border border-blue-500/20 rounded-2xl p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-blue-600 font-bold text-sm">@Localizer["InProgress"]</p>
                    <p class="text-2xl font-black text-foreground" id="inProgressCount">0</p>
                </div>
                <i data-lucide="clock" class="w-8 h-8 text-blue-500"></i>
            </div>
        </div>
        <div class="bg-gradient-to-br from-green-500/10 to-green-600/10 border border-green-500/20 rounded-2xl p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-green-600 font-bold text-sm">@Localizer["Resolved"]</p>
                    <p class="text-2xl font-black text-foreground" id="resolvedCount">0</p>
                </div>
                <i data-lucide="check-circle" class="w-8 h-8 text-green-500"></i>
            </div>
        </div>
    </div>

    <!-- Error Reports Table -->
    <div class="bg-background border border-border rounded-2xl overflow-hidden">
        <div class="p-6 border-b border-border">
            <h3 class="text-lg font-bold text-foreground flex items-center gap-2">
                <i data-lucide="list" class="w-5 h-5 text-primary"></i>
                @Localizer["RecentErrorReports"]
            </h3>
        </div>
        
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-muted/20">
                    <tr>
                        <th class="text-left p-4 font-bold text-foreground">@Localizer["TicketID"]</th>
                        <th class="text-left p-4 font-bold text-foreground">@Localizer["User"]</th>
                        <th class="text-left p-4 font-bold text-foreground">@Localizer["Priority"]</th>
                        <th class="text-left p-4 font-bold text-foreground">@Localizer["Status"]</th>
                        <th class="text-left p-4 font-bold text-foreground">@Localizer["Description"]</th>
                        <th class="text-left p-4 font-bold text-foreground">@Localizer["Date"]</th>
                        <th class="text-left p-4 font-bold text-foreground">@Localizer["Actions"]</th>
                    </tr>
                </thead>
                <tbody id="reportsTableBody">
                    <tr id="table-skeleton" class="hidden">
                         <td colspan="7" class="p-4">
                             <div class="space-y-4">
                                 <skeleton type="Line" />
                                 <skeleton type="Line" />
                                 <skeleton type="Line" />
                             </div>
                         </td>
                    </tr>
                    <!-- Sample data - will be populated by JavaScript -->
                    <tr class="border-b border-border hover:bg-muted/10">
                        <td class="p-4">
                            <span class="font-mono text-sm bg-muted/30 px-2 py-1 rounded">ERR-20260125-ABC123</span>
                        </td>
                        <td class="p-4">
                            <div>
                                <div class="font-medium text-foreground">John Doe</div>
                                <div class="text-sm text-muted-foreground">john@example.com</div>
                            </div>
                        </td>
                        <td class="p-4">
                            <span class="inline-flex px-2 py-1 rounded-full text-xs font-medium priority-high">High</span>
                        </td>
                        <td class="p-4">
                            <span class="inline-flex px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400">New</span>
                        </td>
                        <td class="p-4">
                            <div class="max-w-xs truncate text-foreground">Profile page not loading correctly after login</div>
                        </td>
                        <td class="p-4 text-muted-foreground text-sm">2 hours ago</td>
                        <td class="p-4">
                            <div class="flex items-center gap-2">
                                <button class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300" title="@Localizer["ViewDetails"]">
                                    <i data-lucide="eye" class="w-4 h-4"></i>
                                </button>
                                <button class="text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300" title="@Localizer["MarkResolved"]">
                                    <i data-lucide="check" class="w-4 h-4"></i>
                                </button>
                                <button class="text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300" title="@Localizer["Delete"]">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr class="border-b border-border hover:bg-muted/10">
                        <td class="p-4">
                            <span class="font-mono text-sm bg-muted/30 px-2 py-1 rounded">ERR-20260125-DEF456</span>
                        </td>
                        <td class="p-4">
                            <div>
                                <div class="font-medium text-foreground">Jane Smith</div>
                                <div class="text-sm text-muted-foreground">jane@example.com</div>
                            </div>
                        </td>
                        <td class="p-4">
                            <span class="inline-flex px-2 py-1 rounded-full text-xs font-medium priority-critical">Critical</span>
                        </td>
                        <td class="p-4">
                            <span class="inline-flex px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400">In Progress</span>
                        </td>
                        <td class="p-4">
                            <div class="max-w-xs truncate text-foreground">Unable to upload images to gallery</div>
                        </td>
                        <td class="p-4 text-muted-foreground text-sm">5 hours ago</td>
                        <td class="p-4">
                            <div class="flex items-center gap-2">
                                <button class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300" title="@Localizer["ViewDetails"]">
                                    <i data-lucide="eye" class="w-4 h-4"></i>
                                </button>
                                <button class="text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300" title="@Localizer["MarkResolved"]">
                                    <i data-lucide="check" class="w-4 h-4"></i>
                                </button>
                                <button class="text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300" title="@Localizer["Delete"]">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Empty State -->
        <div id="emptyState" class="hidden p-12 text-center">
            <i data-lucide="inbox" class="w-12 h-12 text-muted-foreground mx-auto mb-4 opacity-30"></i>
            <h3 class="text-lg font-bold text-foreground mb-2">@Localizer["NoErrorReports"]</h3>
            <p class="text-sm text-muted-foreground">@Localizer["NoErrorReportsDesc"]</p>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Lucide icons
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            
            Skeleton.initPageLoad('stats-skeleton', 'stats-content');

            // Load error reports data
            loadErrorReports();
            
            // Set up filters
            document.getElementById('statusFilter').addEventListener('change', filterReports);
            document.getElementById('priorityFilter').addEventListener('change', filterReports);
        });

        function loadErrorReports() {
            // Mock data for demonstration
            updateStats({
                critical: 1,
                high: 1,
                inProgress: 1,
                resolved: 0
            });
        }

        function updateStats(stats) {
            document.getElementById('criticalCount').textContent = stats.critical;
            document.getElementById('highCount').textContent = stats.high;
            document.getElementById('inProgressCount').textContent = stats.inProgress;
            document.getElementById('resolvedCount').textContent = stats.resolved;
        }

        function filterReports() {
            const statusFilter = document.getElementById('statusFilter').value;
            const priorityFilter = document.getElementById('priorityFilter').value;
            
            // In a real app, this would filter the table rows
            console.log('Filtering by status:', statusFilter, 'priority:', priorityFilter);
        }
    </script>
}