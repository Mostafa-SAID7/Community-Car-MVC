@inject IViewLocalizer Localizer
@using CommunityCar.Application.Features.Dashboard.ViewModels
@model IEnumerable<CommunityCar.Application.Features.Dashboard.ErrorReporting.ViewModels.ErrorStatsVM>
@{
    ViewData["Title"] = Localizer["ErrorStatistics"];
}

<div class="space-y-8 animate-in fade-in duration-700">
    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-6">
        <div>
            <h1 class="text-3xl font-black text-foreground tracking-tight">@Localizer["ErrorStatistics"]</h1>
            <p class="text-sm text-muted-foreground font-medium opacity-70 mt-1">@Localizer["ErrorStatisticsDesc"]</p>
        </div>
        <div class="flex items-center gap-4">
            <a href="@Url.Action("Index")" class="inline-flex items-center gap-2.5 px-6 py-2.5 bg-background border border-border hover:border-primary hover:text-primary rounded-xl text-xs font-black uppercase tracking-widest transition-all shadow-lg shadow-black/5 active:scale-95 group">
                <i data-lucide="arrow-left" class="w-4 h-4 group-hover:scale-125 transition-transform"></i>
                @Localizer["BackToErrors"]
            </a>
        </div>
    </div>

    <!-- Date Range Filter -->
    <div class="bg-card/40 backdrop-blur-md border border-border rounded-2xl p-6 shadow-xl">
        <form method="get" class="flex flex-col lg:flex-row gap-4 items-center">
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 flex-1">
                <div class="space-y-2">
                    <label class="text-[10px] font-black uppercase tracking-widest text-muted-foreground opacity-60">@Localizer["StartDate"]</label>
                    <input type="date" name="startDate" value="@ViewBag.StartDate?.ToString("yyyy-MM-dd")" 
                           class="w-full bg-background border border-border px-4 py-2.5 rounded-xl text-xs font-bold outline-none">
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-black uppercase tracking-widest text-muted-foreground opacity-60">@Localizer["EndDate"]</label>
                    <input type="date" name="endDate" value="@ViewBag.EndDate?.ToString("yyyy-MM-dd")" 
                           class="w-full bg-background border border-border px-4 py-2.5 rounded-xl text-xs font-bold outline-none">
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-black uppercase tracking-widest text-muted-foreground opacity-60">@Localizer["Category"]</label>
                    <select name="category" class="w-full bg-background border border-border px-4 py-2.5 rounded-xl text-xs font-bold outline-none">
                        <option value="">@Localizer["AllCategories"]</option>
                        <option value="General" selected="@(ViewBag.Category == "General")">@Localizer["CatGeneral"]</option>
                        <option value="Database" selected="@(ViewBag.Category == "Database")">@Localizer["CatDatabase"]</option>
                        <option value="Network" selected="@(ViewBag.Category == "Network")">@Localizer["CatNetwork"]</option>
                        <option value="Validation" selected="@(ViewBag.Category == "Validation")">@Localizer["CatValidation"]</option>
                        <option value="Business" selected="@(ViewBag.Category == "Business")">@Localizer["CatBusiness"]</option>
                        <option value="Security" selected="@(ViewBag.Category == "Security")">@Localizer["CatSecurity"]</option>
                    </select>
                </div>
            </div>
            <button type="submit" class="h-[42px] px-6 py-2 rounded-xl bg-primary text-primary-foreground hover:bg-primary/90 text-[10px] font-black uppercase tracking-widest shadow-lg transition-all flex items-center justify-center gap-2 active:scale-95">
                <i data-lucide="filter" class="w-4 h-4"></i>
                @Localizer["Filter"]
            </button>
        </form>
    </div>

    <!-- Statistics -->
    <div class="bg-card/40 backdrop-blur-md border border-border rounded-2xl shadow-xl overflow-hidden">
        <div class="p-6 border-b border-border">
            <h2 class="text-xl font-black text-foreground">@Localizer["StatisticsOverview"]</h2>
        </div>
        
        @if (Model.Any())
        {
            <div class="divide-y divide-border">
                @foreach (var stat in Model)
                {
                    <div class="p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-bold text-foreground">@stat.Date.ToString("MMM dd, yyyy")</h3>
                            <span class="text-sm text-muted-foreground">@stat.TotalErrors total errors</span>
                        </div>
                        
                        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                            <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-4">
                                <div class="text-2xl font-black text-red-600 mb-1">@stat.CriticalErrors</div>
                                <div class="text-xs font-bold text-red-600/70">Critical</div>
                            </div>
                            <div class="bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-xl p-4">
                                <div class="text-2xl font-black text-orange-600 mb-1">@(stat.TotalErrors - stat.CriticalErrors - stat.WarningErrors - stat.InfoErrors)</div>
                                <div class="text-xs font-bold text-orange-600/70">Errors</div>
                            </div>
                            <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-xl p-4">
                                <div class="text-2xl font-black text-yellow-600 mb-1">@stat.WarningErrors</div>
                                <div class="text-xs font-bold text-yellow-600/70">Warnings</div>
                            </div>
                            <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-xl p-4">
                                <div class="text-2xl font-black text-green-600 mb-1">@stat.ResolvedErrors</div>
                                <div class="text-xs font-bold text-green-600/70">Resolved</div>
                            </div>
                        </div>
                        
                        @if (!string.IsNullOrEmpty(stat.MostCommonError))
                        {
                            <div class="mt-4 p-4 bg-muted/20 rounded-xl">
                                <div class="text-sm font-bold text-foreground mb-1">Most Common Error:</div>
                                <div class="text-sm text-muted-foreground">@stat.MostCommonError (@stat.MostCommonErrorCount occurrences)</div>
                            </div>
                        }
                    </div>
                }
            </div>
        }
        else
        {
            <div class="p-12 text-center">
                <div class="bg-muted/20 border border-border/50 rounded-2xl p-8 max-w-md mx-auto">
                    <i data-lucide="bar-chart-3" class="w-16 h-16 text-muted-foreground mx-auto mb-4"></i>
                    <h3 class="text-xl font-black text-foreground mb-2">@Localizer["NoStatsFound"]</h3>
                    <p class="text-muted-foreground">@Localizer["NoStatsFoundDesc"]</p>
                </div>
            </div>
        }
    </div>
</div>