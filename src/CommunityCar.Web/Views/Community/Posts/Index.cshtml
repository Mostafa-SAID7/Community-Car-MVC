@model IEnumerable<CommunityCar.Domain.Entities.Community.Posts.Post>
@{
    ViewData["Title"] = "Community Posts";
}

<div class="container mx-auto px-4 py-6 max-w-7xl">
    <div class="flex justify-between items-center mb-6">
        <div>
            <h1 class="text-3xl font-bold mb-1">Community Posts</h1>
            <p class="text-muted-foreground mb-0">Join the conversation</p>
        </div>
        <a href="#" class="btn btn-primary gap-2">
            <i data-lucide="plus-circle" class="w-5 h-5"></i>Create Post
        </a>
    </div>

    <div class="card card-glass p-4 mb-6">
        <!-- Search and Toolbar -->
        <div class="flex flex-col md:flex-row gap-3 items-center">
            <div class="relative flex-1 w-full">
                <span class="absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground">
                    <i data-lucide="search" class="w-4 h-4"></i>
                </span>
                <input type="text" class="form-control pl-10 w-full rounded-full bg-muted/50 border-transparent focus:bg-background focus:border-primary transition-colors" placeholder="Search posts..." id="postsSearchInput">
            </div>
            
            <div class="flex gap-2">
                <button class="btn btn-ghost btn-icon border border-border bg-background/50" id="togglePostViewBtn" title="Toggle View">
                    <i data-lucide="layout-grid" class="w-5 h-5"></i>
                </button>
                
                <button class="btn btn-ghost btn-icon border border-border bg-background/50" id="sortPostsBtn" title="Sort Posts">
                    <i data-lucide="arrow-down-a-z" class="w-5 h-5"></i>
                </button>
            </div>
        </div>

        @if (!Model.Any())
        {
            <div class="text-center py-12">
                <div class="w-16 h-16 bg-muted/30 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="pen-tool" class="w-8 h-8 text-muted-foreground"></i>
                </div>
                <h3 class="text-lg font-semibold mb-2">No posts yet</h3>
                <p class="text-muted-foreground mb-4">Start the conversation by creating the first post!</p>
                <a href="#" class="btn btn-primary">Create First Post</a>
            </div>
        }
        else
        {
            <div class="flex flex-col gap-6" id="postsList">
                @foreach (var post in Model)
                {
                    <a href="@Url.Action("Details", "Posts", new { id = post.Id })" class="card card-glass card-hover text-inherit no-underline">
                        <div class="card-body">
                            <!-- Post Header -->
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-full bg-muted flex items-center justify-center overflow-hidden">
                                        <i data-lucide="user" class="w-5 h-5 text-muted-foreground"></i>
                                    </div>
                                    <div class="flex flex-col">
                                        <span class="font-semibold text-sm">@(post.AuthorId == Guid.Empty ? "Anonymous" : "User")</span>
                                        <span class="text-xs text-muted-foreground">@post.CreatedAt.ToString("MMM dd, yyyy â€¢ HH:mm")</span>
                                    </div>
                                </div>
                                <span class="px-2 py-1 rounded-full text-xs font-medium bg-muted text-muted-foreground">
                                    @post.Type.ToString()
                                </span>
                            </div>

                            <!-- Post Content -->
                            <h3 class="text-xl font-bold mb-2">@post.Title</h3>
                            <p class="text-muted-foreground line-clamp-3 mb-4">@post.Content</p>

                            <!-- Post Actions -->
                            <div class="flex gap-4 pt-4 border-t border-border mt-auto">
                                <button class="btn btn-ghost btn-sm gap-2 text-muted-foreground hover:text-red-500" onclick="event.preventDefault();">
                                    <i data-lucide="heart" class="w-4 h-4"></i>
                                    <span>0</span>
                                </button>
                                <button class="btn btn-ghost btn-sm gap-2 text-muted-foreground hover:text-blue-500" onclick="event.preventDefault();">
                                    <i data-lucide="message-circle" class="w-4 h-4"></i>
                                    <span>0</span>
                                </button>
                                <button class="btn btn-ghost btn-sm gap-2 text-muted-foreground hover:text-green-500" onclick="event.preventDefault();">
                                    <i data-lucide="share-2" class="w-4 h-4"></i>
                                    <span>Share</span>
                                </button>
                            </div>
                        </div>
                    </a>
                }
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const toggleViewBtn = document.getElementById('togglePostViewBtn');
            const postsList = document.getElementById('postsList');
            const viewIcon = toggleViewBtn?.querySelector('i');

            // Toggle Grid/List View
            toggleViewBtn?.addEventListener('click', () => {
                const isGrid = postsList.classList.toggle('grid');
                
                if (isGrid) {
                    // Switch to Grid
                    postsList.classList.remove('flex', 'flex-col');
                    postsList.classList.add('grid-cols-1', 'md:grid-cols-2', 'lg:grid-cols-3');
                    viewIcon.setAttribute('data-lucide', 'list');
                } else {
                    // Switch to List
                    postsList.classList.add('flex', 'flex-col');
                    postsList.classList.remove('grid', 'grid-cols-1', 'md:grid-cols-2', 'lg:grid-cols-3');
                    viewIcon.setAttribute('data-lucide', 'layout-grid');
                }
                
                toggleViewBtn.classList.toggle('bg-primary/10');
                toggleViewBtn.classList.toggle('text-primary');
                toggleViewBtn.classList.toggle('border-primary');
                
                lucide.createIcons();
            });
        });
    </script>
}
