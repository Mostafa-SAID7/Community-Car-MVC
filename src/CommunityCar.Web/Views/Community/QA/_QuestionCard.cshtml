@inject IViewLocalizer Localizer
@model CommunityCar.Application.Features.Community.QA.ViewModels.QuestionVM
@{
    var currentCulture = System.Globalization.CultureInfo.CurrentCulture.Name;
    var isArabic = currentCulture.StartsWith("ar");
    var displayTitle = isArabic && !string.IsNullOrEmpty(Model.TitleAr) ? Model.TitleAr : Model.Title;
}

<a href="@Url.Action("Details", "QA", new { culture = currentCulture, slug = Model.Slug })" class="card card-premium p-0 border-0 shadow-sm mb-3 hover-translate-y-1 transition-all text-decoration-none overflow-hidden @(Model.IsPinned ? "border-start border-4 border-primary-red" : "")" data-difficulty="@Model.Difficulty" data-status="@(Model.IsSolved ? "solved" : "open")" data-car-make="@Model.CarMake">
    
    <div class="card-body p-4">
        <!-- Header with Author and Status -->
        <div class="d-flex justify-content-between align-items-start mb-3">
            <div class="d-flex align-items-center gap-3">
                <div class="user-avatar-container shadow-sm border p-0 m-0" style="width: 44px; height: 44px;">
                    @if (!string.IsNullOrEmpty(Model.AuthorProfilePicture))
                    {
                        <img src="@Model.AuthorProfilePicture" alt="@Model.AuthorName" class="rounded-circle object-fit-cover w-100 h-100" />
                    }
                    else
                    {
                        <div class="w-100 h-100 rounded-circle bg-light d-flex align-items-center justify-content-center text-muted">
                            <i data-lucide="user" style="width: 20px;"></i>
                        </div>
                    }
                </div>
                <div>
                    <span class="d-block small fw-black text-dark tracking-tight">@Model.AuthorName</span>
                    <span class="d-block x-small fw-black text-uppercase tracking-widest text-muted opacity-50">@(Model.LastActivityAt != Model.CreatedAt ? Localizer["Active"] : Localizer["Asked"]) @(Model.LastActivityAt != Model.CreatedAt ? Model.LastActivityTimeAgo : Model.TimeAgo)</span>
                </div>
            </div>
            <div class="d-flex align-items-center gap-2">
                @if (Model.IsSolved)
                {
                    <span class="badge bg-success-subtle text-success rounded-pill px-2 py-1 border border-success-subtle x-small fw-black tracking-widest">
                        <i data-lucide="check-circle" class="me-1" style="width: 10px;"></i> @Localizer["Solved"]
                    </span>
                }
                else
                {
                    <span class="badge bg-warning-subtle text-warning rounded-pill px-2 py-1 border border-warning-subtle x-small fw-black tracking-widest">
                        <i data-lucide="help-circle" class="me-1" style="width: 10px;"></i> @Localizer["Open"]
                    </span>
                }
                <span class="badge bg-primary-red-subtle text-primary-red rounded-pill px-2 py-1 border border-primary-red-subtle x-small fw-black tracking-widest">
                    @Model.DifficultyDisplay
                </span>
            </div>
        </div>

        <!-- Question Title -->
        <h5 class="fw-black text-dark mb-3 tracking-tighter line-clamp-2">@displayTitle</h5>
        
        <!-- Car Context -->
        @if (!string.IsNullOrEmpty(Model.CarDisplayName))
        {
            <div class="d-flex align-items-center gap-2 mb-3 bg-light rounded-3 p-2 px-3 border-start border-3 border-primary-red">
                <i data-lucide="car-front" class="text-primary-red" style="width: 16px;"></i>
                <div>
                    <span class="d-block x-small fw-black text-dark">@Model.CarDisplayName</span>
                    <span class="d-block x-small fw-black text-uppercase tracking-widest text-primary-red opacity-60" style="font-size: 0.6rem;">@Localizer["VehicleContext"]</span>
                </div>
            </div>
        }
        
        <!-- Tags -->
        @if (Model.Tags.Any())
        {
            <div class="d-flex flex-wrap gap-2 mb-3">
                @foreach (var tag in Model.Tags.Take(4))
                {
                    <span class="x-small fw-bold text-muted bg-light px-2 py-1 rounded-pill border">#@tag</span>
                }
            </div>
        }

        <!-- Stats Footer -->
        <div class="d-flex align-items-center justify-content-between pt-3 border-top mt-auto">
            <div class="d-flex align-items-center gap-3">
                <div class="d-flex align-items-center gap-1 opacity-75">
                    <i data-lucide="arrow-up" class="text-success" style="width: 14px;"></i>
                    <span class="x-small fw-black tabular-nums">@Model.VoteScore</span>
                </div>
                <div class="d-flex align-items-center gap-1 opacity-75">
                    <i data-lucide="message-circle" class="text-primary-red" style="width: 14px;"></i>
                    <span class="x-small fw-black tabular-nums">@Model.AnswerCount</span>
                </div>
                <div class="d-flex align-items-center gap-1 opacity-75">
                    <i data-lucide="eye" class="text-muted" style="width: 14px;"></i>
                    <span class="x-small fw-black tabular-nums">@Model.ViewCount</span>
                </div>
            </div>
            <div class="x-small fw-black text-uppercase tracking-widest text-muted opacity-30">
                #@Model.Id.ToString().Substring(0, 8)
            </div>
        </div>
    </div>
</a>