@model CommunityCar.Application.Features.Maps.ViewModels.MapsStatsVM
@{
    ViewData["Title"] = "Maps";
}

<div class="container-fluid">
    <!-- Maps Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h3 mb-1">Interactive Maps</h1>
                    <p class="text-muted mb-0">Discover automotive locations, routes, and community spots</p>
                </div>
                <div class="d-flex gap-2">
                    <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addPOIModal">
                        <i data-lucide="map-pin" size="16"></i>
                        Add Location
                    </button>
                    <button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#addRouteModal">
                        <i data-lucide="route" size="16"></i>
                        Add Route
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card card-glass">
                <div class="card-body text-center">
                    <i data-lucide="map-pin" size="32" class="text-primary mb-2"></i>
                    <h4 class="mb-1">@Model.TotalPointsOfInterest</h4>
                    <small class="text-muted">Locations</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card card-glass">
                <div class="card-body text-center">
                    <i data-lucide="route" size="32" class="text-success mb-2"></i>
                    <h4 class="mb-1">@Model.TotalRoutes</h4>
                    <small class="text-muted">Routes</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card card-glass">
                <div class="card-body text-center">
                    <i data-lucide="check-circle" size="32" class="text-info mb-2"></i>
                    <h4 class="mb-1">@Model.TotalCheckIns</h4>
                    <small class="text-muted">Check-ins</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card card-glass">
                <div class="card-body text-center">
                    <i data-lucide="shield-check" size="32" class="text-warning mb-2"></i>
                    <h4 class="mb-1">@Model.VerifiedPOIs</h4>
                    <small class="text-muted">Verified</small>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Map and Search -->
        <div class="col-lg-8">
            <!-- Search and Filters -->
            <div class="card card-glass mb-3">
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <input type="text" class="form-control" id="searchTerm" placeholder="Search locations...">
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" id="poiType">
                                <option value="">All Types</option>
                                <option value="1">Auto Repair</option>
                                <option value="2">Dealership</option>
                                <option value="3">Gas Station</option>
                                <option value="4">Charging Station</option>
                                <option value="5">Car Wash</option>
                                <option value="10">Meetup Point</option>
                                <option value="11">Car Show</option>
                                <option value="12">Race Track</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" id="poiCategory">
                                <option value="">All Categories</option>
                                <option value="1">Automotive</option>
                                <option value="2">Community</option>
                                <option value="3">Event</option>
                                <option value="4">Emergency</option>
                                <option value="5">Recreation</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <input type="number" class="form-control" id="radiusKm" placeholder="Radius (km)" value="10" min="1" max="100">
                        </div>
                        <div class="col-md-2">
                            <button type="button" class="btn btn-primary w-100" onclick="searchLocations()">
                                <i data-lucide="search" size="16"></i>
                                Search
                            </button>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-12">
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="verifiedOnly">
                                <label class="form-check-label" for="verifiedOnly">Verified only</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="open24Hours">
                                <label class="form-check-label" for="open24Hours">24/7 Open</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="showRoutes">
                                <label class="form-check-label" for="showRoutes">Show Routes</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Interactive Map -->
            <div class="card card-glass" style="height: 600px;">
                <div class="card-body p-0">
                    <div id="mapContainer" class="w-100 h-100 rounded">
                        <div class="d-flex flex-column align-items-center justify-content-center h-100 text-muted">
                            <i data-lucide="map" size="64" class="opacity-20 mb-3"></i>
                            <h4>Interactive Map</h4>
                            <p>Map integration will be implemented here</p>
                            <small class="text-muted">Click "Get My Location" to start exploring nearby locations</small>
                            <button type="button" class="btn btn-outline-primary mt-3" onclick="getCurrentLocation()">
                                <i data-lucide="navigation" size="16"></i>
                                Get My Location
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Location Details -->
            <div class="card card-glass mb-3" id="locationDetails" style="display: none;">
                <div class="card-header">
                    <h6 class="mb-0">Location Details</h6>
                </div>
                <div class="card-body" id="locationDetailsContent">
                    <!-- Location details will be populated here -->
                </div>
            </div>

            <!-- Popular Locations -->
            <div class="card card-glass mb-3">
                <div class="card-header">
                    <h6 class="mb-0">Popular Locations</h6>
                </div>
                <div class="card-body">
                    @if (Model.PopularPOIs.Any())
                    {
                        @foreach (var poi in Model.PopularPOIs)
                        {
                            <div class="d-flex align-items-center mb-3">
                                <div class="flex-shrink-0">
                                    <div class="avatar-sm bg-primary-subtle rounded d-flex align-items-center justify-content-center">
                                        <i data-lucide="map-pin" size="16" class="text-primary"></i>
                                    </div>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <h6 class="mb-1">@poi.Name</h6>
                                    <small class="text-muted">@poi.ViewCount views • @poi.CheckInCount check-ins</small>
                                    @if (poi.AverageRating > 0)
                                    {
                                        <div class="mt-1">
                                            @for (int i = 1; i <= 5; i++)
                                            {
                                                <i data-lucide="star" size="12" class="@(i <= poi.AverageRating ? "text-warning" : "text-muted")"></i>
                                            }
                                            <small class="text-muted ms-1">(@poi.ReviewCount)</small>
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <p class="text-muted mb-0">No popular locations yet</p>
                    }
                </div>
            </div>

            <!-- Popular Routes -->
            <div class="card card-glass">
                <div class="card-header">
                    <h6 class="mb-0">Popular Routes</h6>
                </div>
                <div class="card-body">
                    @if (Model.PopularRoutes.Any())
                    {
                        @foreach (var route in Model.PopularRoutes)
                        {
                            <div class="d-flex align-items-center mb-3">
                                <div class="flex-shrink-0">
                                    <div class="avatar-sm bg-success-subtle rounded d-flex align-items-center justify-content-center">
                                        <i data-lucide="route" size="16" class="text-success"></i>
                                    </div>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <h6 class="mb-1">@route.Name</h6>
                                    <small class="text-muted">@route.DistanceKm km • @route.TimesCompleted completions</small>
                                    @if (route.AverageRating > 0)
                                    {
                                        <div class="mt-1">
                                            @for (int i = 1; i <= 5; i++)
                                            {
                                                <i data-lucide="star" size="12" class="@(i <= route.AverageRating ? "text-warning" : "text-muted")"></i>
                                            }
                                            <small class="text-muted ms-1">(@route.ReviewCount)</small>
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <p class="text-muted mb-0">No popular routes yet</p>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add POI Modal -->
<div class="modal fade" id="addPOIModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New Location</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addPOIForm">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Name *</label>
                            <input type="text" class="form-control" name="name" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Type *</label>
                            <select class="form-select" name="type" required>
                                <option value="">Select Type</option>
                                <option value="1">Auto Repair Shop</option>
                                <option value="2">Car Dealership</option>
                                <option value="3">Gas Station</option>
                                <option value="4">Charging Station</option>
                                <option value="5">Car Wash</option>
                                <option value="10">Meetup Point</option>
                                <option value="11">Car Show</option>
                                <option value="12">Race Track</option>
                            </select>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Description *</label>
                            <textarea class="form-control" name="description" rows="3" required></textarea>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Latitude *</label>
                            <input type="number" class="form-control" name="latitude" step="any" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Longitude *</label>
                            <input type="number" class="form-control" name="longitude" step="any" required>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Address</label>
                            <input type="text" class="form-control" name="address">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Phone</label>
                            <input type="tel" class="form-control" name="phoneNumber">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Website</label>
                            <input type="url" class="form-control" name="website">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="submitPOI()">Add Location</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Route Modal -->
<div class="modal fade" id="addRouteModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New Route</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addRouteForm">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Name *</label>
                            <input type="text" class="form-control" name="name" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Type *</label>
                            <select class="form-select" name="type" required>
                                <option value="">Select Type</option>
                                <option value="1">Scenic</option>
                                <option value="2">Performance</option>
                                <option value="3">Off Road</option>
                                <option value="4">Touring</option>
                                <option value="5">Commute</option>
                                <option value="6">Track</option>
                                <option value="7">Rally</option>
                                <option value="8">Cruise</option>
                            </select>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Description *</label>
                            <textarea class="form-control" name="description" rows="3" required></textarea>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Distance (km)</label>
                            <input type="number" class="form-control" name="distanceKm" step="0.1" min="0">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Duration (minutes)</label>
                            <input type="number" class="form-control" name="estimatedDurationMinutes" min="0">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Difficulty</label>
                            <select class="form-select" name="difficulty">
                                <option value="1">Beginner</option>
                                <option value="2">Intermediate</option>
                                <option value="3">Advanced</option>
                                <option value="4">Expert</option>
                            </select>
                        </div>
                        <div class="col-12">
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" name="isScenic">
                                <label class="form-check-label">Scenic Route</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" name="hasTolls">
                                <label class="form-check-label">Has Tolls</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" name="isOffRoad">
                                <label class="form-check-label">Off Road</label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="submitRoute()">Add Route</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/maps.js"></script>
}
