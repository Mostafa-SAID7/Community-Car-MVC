@inject IViewLocalizer Localizer
@{
    ViewData["Title"] = Localizer["CheckInsTitle"];
    var poiName = ViewBag.POIName as string ?? "Location";
    var poiId = ViewBag.POIId as string ?? "";
}

<div class="space-y-8 animate-in fade-in duration-700">
    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-6">
        <div>
            <div class="flex items-center gap-3 mb-4">
                <a href="/maps" class="inline-flex items-center gap-2 text-sm font-medium text-muted-foreground hover:text-primary transition-colors">
                    <i data-lucide="arrow-left" class="w-4 h-4"></i>
                    @Localizer["BackToMaps"]
                </a>
                @if (!string.IsNullOrEmpty(poiId))
                {
                    <span class="text-muted-foreground">â€¢</span>
                    <a href="/maps/poi/@poiId" class="inline-flex items-center gap-2 text-sm font-medium text-muted-foreground hover:text-primary transition-colors">
                        <i data-lucide="map-pin" class="w-4 h-4"></i>
                        @poiName
                    </a>
                }
            </div>
            
            <h1 class="text-3xl font-black text-foreground tracking-tight">@Localizer["CheckInsTitle"]</h1>
            <p class="text-sm text-muted-foreground font-medium opacity-70 mt-1">@string.Format(Localizer["RecentCheckInsAt"].Value, poiName)</p>
        </div>
        
        @if (!string.IsNullOrEmpty(poiId))
        {
            <div class="flex items-center gap-3">
                <button type="button" class="inline-flex items-center gap-2.5 px-6 py-2.5 bg-primary text-primary-foreground hover:bg-primary/90 rounded-xl text-xs font-black uppercase tracking-widest transition-all shadow-lg shadow-primary/20 active:scale-95" onclick="checkInToLocation('@poiId')">
                    <i data-lucide="check-circle" class="w-4 h-4"></i>
                    @Localizer["CheckInHere"]
                </button>
            </div>
        }
    </div>

    <!-- Check-ins List -->
    <div class="bg-card/40 backdrop-blur-md border border-border rounded-2xl shadow-xl overflow-hidden">
        @if (Model.Any())
        {
            <div class="p-6 border-b border-border/50 bg-muted/20">
                <h3 class="text-lg font-black text-foreground tracking-tight">
                    @string.Format(Localizer["RecentCheckInsCount"].Value, Model.Count())
                </h3>
            </div>
            
            <div class="divide-y divide-border/30">
                @foreach (var checkIn in Model)
                {
                    <div class="p-6 hover:bg-muted/10 transition-all">
                        <div class="flex items-start gap-4">
                            <div class="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold shrink-0">
                                @(checkIn.UserName?.FirstOrDefault() ?? 'U')
                            </div>
                            
                            <div class="flex-1 min-w-0">
                                <div class="flex items-start justify-between gap-4 mb-2">
                                    <div class="flex-1">
                                        <h4 class="font-bold text-foreground">@(checkIn.UserName ?? Localizer["AnonymousUser"].Value)</h4>
                                        <p class="text-sm text-muted-foreground">
                                            @string.Format(Localizer["CheckedInAtFormat"].Value, checkIn.CheckInTime.ToString("MMM dd, yyyy 'at' h:mm tt"))
                                        </p>
                                    </div>
                                    
                                    @if (checkIn.Rating.HasValue)
                                    {
                                        <div class="flex items-center gap-1 shrink-0">
                                            @for (int i = 1; i <= 5; i++)
                                            {
                                                <i data-lucide="star" class="w-4 h-4 @(i <= checkIn.Rating.Value ? "text-amber-500 fill-current" : "text-muted-foreground/30")"></i>
                                            }
                                            <span class="text-sm font-medium text-foreground ml-1">@checkIn.Rating.Value.ToString("F1")</span>
                                        </div>
                                    }
                                </div>
                                
                                @if (!string.IsNullOrEmpty(checkIn.Comment))
                                {
                                    <div class="bg-muted/20 rounded-xl p-4 mb-3 border border-border/40">
                                        <p class="text-sm text-foreground">@checkIn.Comment</p>
                                    </div>
                                }
                                
                                <div class="flex items-center gap-4 text-xs text-muted-foreground">
                                    @if (checkIn.DistanceFromPOI.HasValue)
                                    {
                                        <div class="flex items-center gap-1">
                                            <i data-lucide="map-pin" class="w-3 h-3"></i>
                                            <span>@string.Format(Localizer["KmFromLocation"].Value, checkIn.DistanceFromPOI.Value.ToString("F1"))</span>
                                        </div>
                                    }
                                    
                                    @if (checkIn.IsPrivate)
                                    {
                                        <div class="flex items-center gap-1">
                                            <i data-lucide="lock" class="w-3 h-3"></i>
                                            <span>@Localizer["PrivateCheckIn"]</span>
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="flex items-center gap-1">
                                            <i data-lucide="globe" class="w-3 h-3"></i>
                                            <span>@Localizer["PublicCheckIn"]</span>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="p-12 text-center">
                <div class="w-16 h-16 rounded-full bg-muted/20 flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="check-circle" class="w-8 h-8 text-muted-foreground/50"></i>
                </div>
                <h3 class="text-lg font-bold text-foreground mb-2">@Localizer["NoCheckInsYet"]</h3>
                <p class="text-muted-foreground mb-6">@Localizer["BeTheFirstToCheckIn"]</p>
                @if (!string.IsNullOrEmpty(poiId))
                {
                    <button type="button" class="inline-flex items-center gap-2 px-6 py-3 bg-primary text-primary-foreground hover:bg-primary/90 rounded-xl text-sm font-bold transition-all" onclick="checkInToLocation('@poiId')">
                        <i data-lucide="check-circle" class="w-4 h-4"></i>
                        @Localizer["CheckInNow"]
                    </button>
                }
            </div>
        }
    </div>
</div>

@section Scripts {
    <script src="~/js/maps.js"></script>
    <script>
        // Initialize Lucide icons
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        }
    </script>
}
      