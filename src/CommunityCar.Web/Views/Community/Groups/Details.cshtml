@using Microsoft.Extensions.Localization
@model CommunityCar.Application.Features.Community.Groups.ViewModels.GroupVM
@inject IViewLocalizer Localizer
@{
    var currentCulture = System.Globalization.CultureInfo.CurrentCulture.Name;
    var isArabic = currentCulture.StartsWith("ar");
    var displayName = isArabic && !string.IsNullOrEmpty(Model.NameAr) ? Model.NameAr : Model.Name;
    var displayCategory = isArabic && !string.IsNullOrEmpty(Model.CategoryAr) ? Model.CategoryAr : Model.Category;
    var displayDescription = isArabic && !string.IsNullOrEmpty(Model.DescriptionAr) ? Model.DescriptionAr : Model.Description;
    var displayRules = isArabic && !string.IsNullOrEmpty(Model.RulesAr) ? Model.RulesAr : Model.Rules;
    ViewData["Title"] = $"{displayName} - {Localizer["CommunityHub"]}";
}

<div class="container-fluid community-detail-container mx-auto py-4 animate-in fade-in">
    <div id="loading-skeleton" class="d-none vstack gap-4">
        <div class="skeleton-line" style="width: 200px;"></div>
        <div class="skeleton-card" style="height: 300px;"></div>
        <div class="skeleton-card" style="height: 400px;"></div>
    </div>

    <div id="main-content">
        <!-- Hub Navigation Strategy -->
        <div class="d-flex flex-column flex-md-row align-items-md-end justify-content-between gap-4 px-2 mb-5">
            <div class="vstack gap-4">
                <nav class="d-flex align-items-center gap-3 text-primary mb-3 nav-breadcrumb">
                    <i data-lucide="users" class="icon-sm"></i> @Localizer["CommunityPayload"]
                </nav>
                <h1 class="display-4 fw-black text-dark lh-1">@displayName</h1>
                <p class="small fw-medium text-muted opacity-75 mt-4 border-start border-4 border-primary border-opacity-25 ps-4 py-1 transmission-log">@Localizer["HubTransmissionDescription"]</p>
            </div>
            
            <a asp-controller="Groups" asp-action="Index" asp-route-culture="@currentCulture" class="btn btn-outline-secondary d-inline-flex align-items-center justify-content-center gap-2 px-4 py-2 rounded-4 back-btn">
                <i data-lucide="arrow-left" class="icon-md back-arrow"></i>
                @Localizer["ReturnToDirectory"]
            </a>
        </div>

        <div class="position-relative mb-5">
            <div class="position-relative community-content-card border border-secondary border-opacity-25 rounded-5 shadow-lg overflow-hidden p-4 p-md-5">
                
                <div class="row g-4">
                    <div class="col-lg-8">
                        <div class="vstack gap-4">
                            <div class="d-flex align-items-start gap-4">
                                <div class="bg-primary rounded-4 d-flex align-items-center justify-content-center fw-black text-white shadow-lg" style="width: 96px; height: 96px; font-size: 2.5rem;">
                                    @displayName.Substring(0, 1).ToUpper()
                                </div>
                                <div class="flex-fill">
                                    <div class="d-flex align-items-center gap-3 mb-3">
                                        <h2 class="h2 fw-black text-dark mb-0">@displayName</h2>
                                        @if (Model.IsOfficial)
                                        {
                                            <span class="badge bg-danger bg-opacity-10 text-danger border border-danger border-opacity-25 xx-small fw-black text-uppercase d-flex align-items-center gap-1">
                                                <i data-lucide="award" class="icon-xs"></i> OFFICIAL
                                            </span>
                                        }
                                    </div>
                                    
                                    <div class="d-flex align-items-center flex-wrap gap-3 mb-4">
                                        <span class="badge bg-primary bg-opacity-10 text-primary border border-primary border-opacity-25 xx-small fw-black text-uppercase">@displayCategory</span>
                                        <span class="badge bg-light text-muted border border-secondary border-opacity-25 xx-small fw-black text-uppercase d-flex align-items-center gap-1">
                                            <i data-lucide="@(Model.Privacy.ToString() == "Public" ? "globe" : "lock")" class="icon-xs"></i>
                                            @Model.Privacy.ToString()
                                        </span>
                                    </div>
                                    
                                    <p class="text-dark fw-medium lh-lg">@displayDescription</p>
                                </div>
                            </div>

                            @if (Model.Tags.Any())
                            {
                                <div class="d-flex flex-wrap gap-2 mb-4">
                                    @foreach (var tag in Model.Tags)
                                    {
                                        <span class="badge bg-primary bg-opacity-5 text-primary border border-primary border-opacity-10 small fw-bold">#@tag</span>
                                    }
                                </div>
                            }

                            @if (!string.IsNullOrEmpty(displayRules))
                            {
                                <div class="bg-light bg-opacity-50 border border-secondary border-opacity-25 rounded-4 p-4">
                                    <h3 class="small fw-black text-dark mb-2 d-flex align-items-center gap-2">
                                        <i data-lucide="scroll-text" class="icon-sm"></i>
                                        @Localizer["CommunityGuidelines"]
                                    </h3>
                                    <p class="small text-muted fw-medium mb-0">@displayRules</p>
                                </div>
                            }
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <div class="vstack gap-4">
                            <!-- Join Action Strategy -->
                            <form method="post" asp-controller="Groups" asp-action="Join" asp-route-id="@Model.Id" asp-route-culture="@currentCulture">
                                @Html.AntiForgeryToken()
                                <button type="submit" class="btn btn-primary w-100 d-flex align-items-center justify-content-center gap-3 py-3 fw-black text-uppercase rounded-4 shadow-lg">
                                    <i data-lucide="user-plus" class="icon-md"></i>
                                    @Localizer["InitializeConnection"]
                                </button>
                            </form>

                            <!-- Stats Architecture -->
                            <div class="bg-light bg-opacity-50 border border-secondary border-opacity-25 rounded-4 p-4">
                                <div class="row g-4">
                                    <div class="col-6">
                                        <div class="text-center">
                                            <div class="h2 fw-black text-dark mb-1">@(Model.MemberCount >= 1000 ? $"{Model.MemberCount / 1000.0:F1}k" : Model.MemberCount.ToString())</div>
                                            <div class="xx-small fw-black text-uppercase text-muted opacity-50">@Localizer["Nodes"]</div>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="text-center">
                                            <div class="h2 fw-black text-dark mb-1">@(Model.PostCount >= 1000 ? $"{Model.PostCount / 1000.0:F1}k" : Model.PostCount.ToString())</div>
                                            <div class="xx-small fw-black text-uppercase text-muted opacity-50">@Localizer["Logs"]</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Rapid Access Controls -->
                            <div class="vstack gap-3">
                                <a href="#" class="btn btn-outline-secondary w-100 d-flex align-items-center justify-content-start gap-3 px-4 py-3 fw-bold text-uppercase rounded-4 community-interaction-btn">
                                    <i data-lucide="message-square" class="icon-sm text-primary"></i>
                                    @Localizer["AccessPosts"]
                                </a>
                                <a href="#" class="btn btn-outline-primary w-100 d-flex align-items-center justify-content-start gap-3 px-4 py-3 fw-bold text-uppercase rounded-4 community-interaction-btn">
                                    <i data-lucide="share-2" class="icon-sm"></i>
                                    @Localizer["BroadcastHub"]
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="community-content-card border border-secondary border-opacity-25 rounded-4 shadow-lg p-4 p-md-5">
            <h2 class="h4 fw-black text-dark mb-4 d-flex align-items-center gap-3">
                <i data-lucide="activity" class="icon-md"></i>
                @Localizer["RecentActivity"]
            </h2>
            <div class="text-center py-5">
                <div class="bg-light rounded-circle d-flex align-items-center justify-content-center mx-auto mb-4" style="width: 64px; height: 64px;">
                    <i data-lucide="message-square" class="icon-xl text-muted opacity-25"></i>
                </div>
                <p class="text-muted fw-medium mb-1">@Localizer["NoActivityToDisplay"]</p>
                <p class="small text-muted opacity-75">@Localizer["StartConversation"]</p>
            </div>
        </div>
    </div> <!-- End Main Content -->
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            Skeleton.initPageLoad('loading-skeleton', 'main-content');
        });
    </script>
}