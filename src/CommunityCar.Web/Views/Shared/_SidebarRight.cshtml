@{
    var feedData = ViewData["FeedSidebarData"] as FeedResponse;
}

<!-- Right Sidebar -->
<aside
    class="fixed right-4 top-28 bottom-8 w-80 bg-card/40 backdrop-blur-xl border border-border rounded-xl shadow-2xl hidden xl:block z-40 overflow-y-auto custom-scrollbar">
    @if (feedData != null)
    {
        <!-- Trending Topics -->
        <div class="p-4 border-b border-border">
            <h3 class="flex items-center gap-2 text-sm font-semibold mb-3">
                <i data-lucide="trending-up" class="w-4 h-4 text-primary"></i>
                Trending Topics
            </h3>
            <div class="space-y-3">
                @if (feedData.TrendingTopics?.Any() == true)
                {
                    @foreach (var topic in feedData.TrendingTopics.Take(5))
                    {
                        <div class="p-3 rounded-md hover:bg-accent transition-colors cursor-pointer">
                            <div class="text-sm font-medium text-primary">#@topic.Topic</div>
                            <div class="text-xs text-muted-foreground mt-1">@topic.PostCount posts â€¢ @topic.TimeAgo</div>
                            <div class="inline-block px-2 py-0.5 mt-2 rounded-full bg-primary/10 text-primary text-xs font-medium">
                                @topic.TrendingReason</div>
                        </div>
                    }
                    <a href="/trending"
                        class="block text-sm text-primary hover:text-primary/80 transition-colors mt-3 font-medium">View All
                        Trending</a>
                }
                else
                {
                    <div class="flex flex-col items-center justify-center py-8 text-center">
                        <i data-lucide="hash" class="w-8 h-8 text-muted-foreground mb-2"></i>
                        <p class="text-xs text-muted-foreground">No trending topics right now</p>
                    </div>
                }
            </div>
        </div>

        <!-- People You May Know -->
        @if (feedData.SuggestedFriends?.Any() == true)
        {
            <div class="p-4 border-b border-border">
                <h3 class="flex items-center gap-2 text-sm font-semibold mb-3">
                    <i data-lucide="users" class="w-4 h-4 text-primary"></i>
                    People You May Know
                </h3>
                <div class="space-y-3">
                    @foreach (var friend in feedData.SuggestedFriends.Take(3))
                    {
                        <div class="flex items-start gap-3 p-2 rounded-md hover:bg-accent transition-colors">
                            <div class="shrink-0 w-10 h-10 rounded-full overflow-hidden bg-muted">
                                <img src="@(friend.Avatar ?? "/images/default-avatar.png")" alt="@friend.Name"
                                    class="w-full h-full object-cover" />
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="text-sm font-medium truncate">@friend.Name</div>
                                <div class="text-xs text-muted-foreground truncate">@friend.SuggestionReason</div>
                                @if (friend.MutualFriendsCount > 0)
                                {
                                    <div class="text-xs text-muted-foreground mt-1">@friend.MutualFriendsCount mutual friends</div>
                                }
                            </div>
                            <button
                                class="inline-flex items-center justify-center h-8 w-8 rounded-md hover:bg-primary hover:text-primary-foreground transition-colors shrink-0"
                                onclick="sendFriendRequest('@friend.UserId')" title="Add Friend">
                                <i data-lucide="user-plus" class="w-[14px] h-[14px]"></i>
                            </button>
                        </div>
                    }
                    <a href="/friends/suggestions"
                        class="block text-sm text-primary hover:text-primary/80 transition-colors mt-3 font-medium">See All
                        Suggestions</a>
                </div>
            </div>
        }

        <!-- Community Stats -->
        <div class="p-4">
            <h3 class="flex items-center gap-2 text-sm font-semibold mb-3">
                <i data-lucide="bar-chart-2" class="w-4 h-4 text-primary"></i>
                Community Stats
            </h3>
            <div class="space-y-3">
                @if (feedData.Stats != null)
                {
                    <div class="grid grid-cols-2 gap-3">
                        <div class="p-3 rounded-md bg-accent/50">
                            <div class="text-xs text-muted-foreground mb-1">Total Posts</div>
                            <div class="text-lg font-bold text-foreground">@feedData.Stats.TotalItems.ToString("N0")</div>
                        </div>
                        <div class="p-3 rounded-md bg-accent/50">
                            <div class="text-xs text-muted-foreground mb-1">Active Stories</div>
                            <div class="text-lg font-bold text-foreground">@feedData.Stats.ActiveStoriesCount</div>
                        </div>
                        <div class="p-3 rounded-md bg-accent/50">
                            <div class="text-xs text-muted-foreground mb-1">Total Engagement</div>
                            <div class="text-lg font-bold text-foreground">@((feedData.Stats.TotalLikes +
                                                        feedData.Stats.TotalComments).ToString("N0"))</div>
                        </div>
                        <div class="p-3 rounded-md bg-accent/50">
                            <div class="text-xs text-muted-foreground mb-1">Last Updated</div>
                            <div class="text-sm font-semibold text-foreground">@feedData.Stats.LastRefreshAgo</div>
                        </div>
                    </div>
                }
                else
                {
                    <div class="text-xs text-center text-muted-foreground py-4">Stats unavailable</div>
                }
            </div>
        </div>
    }
    else
    {
        <!-- Default Activity Section for non-feed pages -->
        <div class="p-4">
            <h3 class="flex items-center gap-2 text-sm font-semibold mb-3">
                <i data-lucide="activity" class="w-4 h-4 text-primary"></i>
                Activity
            </h3>
            <div class="space-y-3">
                <div class="flex gap-3 items-center p-2 rounded-md hover:bg-accent transition-colors">
                    <div class="shrink-0 flex items-center justify-center w-8 h-8 rounded-md bg-accent">
                        <i data-lucide="user-plus" class="w-4 h-4 text-accent-foreground"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-xs font-medium text-foreground">New member joined</p>
                        <p class="text-xs text-muted-foreground">2 mins ago</p>
                    </div>
                </div>
                <div class="flex gap-3 items-center p-2 rounded-md hover:bg-accent transition-colors">
                    <div class="shrink-0 flex items-center justify-center w-8 h-8 rounded-md bg-accent">
                        <i data-lucide="message-circle" class="w-4 h-4 text-accent-foreground"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-xs font-medium text-foreground">Expert answered</p>
                        <p class="text-xs text-muted-foreground">15 mins ago</p>
                    </div>
                </div>
            </div>
        </div>
    }
</aside>