@{
    var feedData = ViewData["FeedSidebarData"] as FeedResponse;
}

<!-- Right Sidebar -->
<!-- Right Sidebar -->
<aside class="sidebar sidebar-right hidden xl:block">
    @if (feedData != null)
    {
        <!-- Trending Topics -->
        <div class="sidebar-section mb-4">
            <h3 class="sidebar-heading">
                <i data-lucide="trending-up" class="w-4 h-4"></i>
                Trending Topics
            </h3>
            <div class="sidebar-content">
                @if (feedData.TrendingTopics?.Any() == true)
                {
                    @foreach (var topic in feedData.TrendingTopics.Take(5))
                    {
                        <div class="trending-item">
                            <div class="trending-topic">#@topic.Topic</div>
                            <div class="trending-meta">@topic.PostCount posts â€¢ @topic.TimeAgo</div>
                            <div class="trending-badge">@topic.TrendingReason</div>
                        </div>
                    }
                    <a href="/trending" class="sidebar-link">View All Trending</a>
                }
                else
                {
                    <div class="empty-state text-center py-4">
                        <i data-lucide="hash" class="text-muted mb-2 w-4 h-4 mx-auto block"></i>
                        <p class="text-xs text-muted m-0">No trending topics right now</p>
                    </div>
                }
            </div>
        </div>

        <!-- People You May Know -->
        @if (feedData.SuggestedFriends?.Any() == true)
        {
            <div class="sidebar-section mb-4">
                <h3 class="sidebar-heading">
                    <i data-lucide="users" class="w-4 h-4"></i>
                    People You May Know
                </h3>
                <div class="sidebar-content">
                    @foreach (var friend in feedData.SuggestedFriends.Take(3))
                    {
                        <div class="suggested-friend-item">
                            <div class="friend-avatar">
                                <img src="@(friend.Avatar ?? "/images/default-avatar.png")" alt="@friend.Name" />
                            </div>
                            <div class="friend-info">
                                <div class="friend-name">@friend.Name</div>
                                <div class="friend-reason">@friend.SuggestionReason</div>
                                @if (friend.MutualFriendsCount > 0)
                                {
                                    <div class="friend-mutual">@friend.MutualFriendsCount mutual friends</div>
                                }
                            </div>
                            <button class="btn-add-friend" onclick="sendFriendRequest('@friend.UserId')" title="Add Friend">
                                <i data-lucide="user-plus" class="w-[14px] h-[14px]"></i>
                            </button>
                        </div>
                    }
                    <a href="/friends/suggestions" class="sidebar-link">See All Suggestions</a>
                </div>
            </div>
        }

        <!-- Community Stats -->
        <div class="sidebar-section">
            <h3 class="sidebar-heading">
                <i data-lucide="bar-chart-2" class="w-4 h-4"></i>
                Community Stats
            </h3>
            <div class="sidebar-content">
                @if (feedData.Stats != null)
                {
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">Total Posts</div>
                            <div class="stat-value">@feedData.Stats.TotalItems.ToString("N0")</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Active Stories</div>
                            <div class="stat-value">@feedData.Stats.ActiveStoriesCount</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Total Engagement</div>
                            <div class="stat-value">@((feedData.Stats.TotalLikes + feedData.Stats.TotalComments).ToString("N0"))</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Last Updated</div>
                            <div class="stat-value">@feedData.Stats.LastRefreshAgo</div>
                        </div>
                    </div>
                }
                else
                {
                    <div class="empty-state text-xs text-center text-muted">Stats unavailable</div>
                }
            </div>
        </div>
    }
    else
    {
        <!-- Default Activity Section for non-feed pages -->
        <h3 class="sidebar-heading">
            <i data-lucide="activity" class="w-4 h-4"></i> Activity
        </h3>
        <div class="sidebar-content">
            <div class="flex gap-3 mb-3 items-center">
                <div class="shrink-0 flex items-center justify-center w-8 h-8 rounded-md bg-accent">
                    <i data-lucide="user-plus" class="w-4 h-4"></i>
                </div>
                <div>
                    <p class="text-xs font-medium m-0 text-foreground">New member joined</p>
                    <p class="text-xs m-0 text-muted">2 mins ago</p>
                </div>
            </div>
            <div class="flex gap-3 items-center">
                <div class="shrink-0 flex items-center justify-center w-8 h-8 rounded-md bg-accent">
                    <i data-lucide="message-circle" class="w-4 h-4"></i>
                </div>
                <div>
                    <p class="text-xs font-medium m-0 text-foreground">Expert answered</p>
                    <p class="text-xs m-0 text-muted">15 mins ago</p>
                </div>
            </div>
        </div>
    }
</aside>
