@model CommunityCar.Application.Features.Shared.Interactions.ViewModels.InteractionSummaryVM

<div class="card card-premium p-4 border shadow-sm mb-4 interaction-panel" data-entity-id="@ViewBag.EntityId" data-entity-type="@ViewBag.EntityType">

    <!-- Reactions Section -->
    <div class="mb-4">
        <div class="d-flex flex-wrap align-items-center gap-2 mb-3">
            @if (Model.Reactions.TotalReactions > 0)
            {
                <div class="d-flex align-items-center">
                    @foreach (var reaction in Model.Reactions.AvailableReactions.Where(r => r.Count > 0).OrderByDescending(r => r.Count).Take(3))
                    {
                        <div class="rounded-circle border border-white d-flex align-items-center justify-content-center bg-white shadow-sm @(reaction.Type == ReactionType.Like ? "text-primary-red" : "text-danger")" style="width: 28px; height: 28px; margin-left: -5px; z-index: 1;">
                            <i data-lucide="@reaction.Icon" style="width: 14px; height: 14px;"></i>
                        </div>
                    }
                </div>
                <span class="small fw-black text-uppercase tracking-widest text-muted opacity-50 ms-2">@Model.Reactions.TotalReactions reactions</span>
            }
        </div>
        
        <div class="d-flex align-items-center gap-2">
            @if (Model.CanReact)
            {
                <div class="dropdown">
                    <button class="btn @(Model.Reactions.HasUserReacted ? "btn-primary-red" : "btn-light border") rounded-pill px-4 py-2 small fw-black text-uppercase tracking-widest d-flex align-items-center gap-2" 
                            type="button"
                            data-action="toggle-reaction" 
                            data-current-reaction="@Model.Reactions.UserReaction">
                        @if (Model.Reactions.HasUserReacted)
                        {
                            var userReactionInfo = Model.Reactions.AvailableReactions.FirstOrDefault(r => r.Type == Model.Reactions.UserReaction);
                            <i data-lucide="@userReactionInfo?.Icon" style="width: 16px; height: 16px;"></i>
                            <span>@userReactionInfo?.Display</span>
                        }
                        else
                        {
                            <i data-lucide="thumbs-up" style="width: 16px; height: 16px;"></i>
                            <span>Like</span>
                        }
                    </button>
                    
                    <!-- Reaction Options (custom implementation usually handled via JS but keeping structure consistent) -->
                    <div class="dropdown-menu p-2 rounded-4 shadow-lg border-0 animate-in slide-in-from-bottom-2">
                        <div class="d-flex gap-2">
                            @foreach (var reaction in Model.Reactions.AvailableReactions)
                            {
                                <button class="btn btn-ghost rounded-circle p-2 hover-bg-primary-red-subtle @(reaction.Type == ReactionType.Like ? "text-primary-red" : "text-danger")" 
                                        data-reaction-type="@reaction.Type" 
                                        title="@reaction.Display">
                                    <i data-lucide="@reaction.Icon" style="width: 18px; height: 18px;"></i>
                                </button>
                            }
                        </div>
                    </div>
                </div>
            }

            <button class="btn btn-light border rounded-pill px-4 py-2 small fw-black text-uppercase tracking-widest d-flex align-items-center gap-2" data-action="toggle-comments">
                <i data-lucide="message-square" style="width: 16px; height: 16px;"></i>
                <span>Comment (@Model.CommentCount)</span>
            </button>

            <div class="ms-auto">
                 <button class="btn btn-ghost rounded-circle p-2" data-action="toggle-share" title="Share">
                    <i data-lucide="share-2" style="width: 18px; height: 18px;"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Comment Form -->
    @if (Model.CanComment)
    {
        <div class="comment-form bg-light p-3 rounded-4 border d-none animate-in slide-in-from-top-2">
            <textarea class="form-control border-0 bg-transparent mb-2 small fw-medium" placeholder="Share your car knowledge..." rows="2" style="box-shadow: none;"></textarea>
            <div class="d-flex justify-content-between align-items-center">
                <span class="x-small fw-black text-muted text-uppercase tracking-widest opacity-40">Posting as @User.Identity?.Name</span>
                <div class="d-flex gap-2">
                    <button class="btn btn-ghost btn-sm small fw-black text-uppercase tracking-widest" data-action="cancel-comment">Cancel</button>
                    <button class="btn btn-primary-red btn-sm small fw-black text-uppercase tracking-widest px-4 shadow-sm" data-action="submit-comment">Post</button>
                </div>
            </div>
        </div>
    }
</div>
