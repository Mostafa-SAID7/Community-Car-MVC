@model CommunityCar.Application.Features.Shared.Interactions.ViewModels.InteractionSummaryVM

@{
    var entityId = ViewBag.EntityId as Guid? ?? Guid.Empty;
    var entityType = ViewBag.EntityType as int? ?? 0;
}

<div class="interaction-bar flex flex-wrap items-center gap-3 py-4 border-t border-border mt-4" data-entity-id="@entityId" data-entity-type="@entityType">
    <!-- Reactions Section -->
    <div class="reactions-container flex items-center gap-1" id="reactions-@entityId">
        @if (Model?.Reactions?.AvailableReactions != null)
        {
            @foreach (var reaction in Model.Reactions.AvailableReactions.Take(6))
            {
                <button class="group inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-black transition-all border @(Model.Reactions.UserReaction == reaction.Type ? "bg-primary/10 text-primary border-primary/30 shadow-inner ring-1 ring-primary/20" : "bg-muted/5 text-muted-foreground border-border/50 hover:bg-muted hover:border-primary/20 hover:text-foreground")" 
                        data-entity-id="@entityId" 
                        data-entity-type="@entityType" 
                        data-reaction-type="@((int)reaction.Type)"
                        title="@reaction.Display">
                    <i data-lucide="@GetReactionIcon(reaction.Type)" class="w-3.5 h-3.5 group-hover:scale-125 transition-transform"></i>
                    <span class="reaction-count tabular-nums">@reaction.Count</span>
                </button>
            }
        }
        else
        {
            <!-- Default reaction buttons -->
            <button class="group inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-black border bg-muted/5 text-muted-foreground border-border/50 hover:bg-muted hover:border-primary/20 hover:text-foreground" data-entity-id="@entityId" data-entity-type="@entityType" data-reaction-type="0" title="Like">
                <i data-lucide="thumbs-up" class="w-3.5 h-3.5 group-hover:scale-125 transition-transform"></i>
                <span class="reaction-count">0</span>
            </button>
            <button class="group inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-black border bg-muted/5 text-muted-foreground border-border/50 hover:bg-muted hover:border-primary/20 hover:text-foreground" data-entity-id="@entityId" data-entity-type="@entityType" data-reaction-type="1" title="Love">
                <i data-lucide="heart" class="w-3.5 h-3.5 group-hover:scale-125 transition-transform"></i>
                <span class="reaction-count">0</span>
            </button>
            <button class="group inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-black border bg-muted/5 text-muted-foreground border-border/50 hover:bg-muted hover:border-primary/20 hover:text-foreground" data-entity-id="@entityId" data-entity-type="@entityType" data-reaction-type="2" title="Haha">
                <i data-lucide="smile" class="w-3.5 h-3.5 group-hover:scale-125 transition-transform"></i>
                <span class="reaction-count">0</span>
            </button>
        }
        
        @if (Model?.Reactions?.TotalReactions > 0)
        {
            <span class="total-reactions text-[9px] font-black uppercase text-muted-foreground ml-2 opacity-50 tracking-widest hidden sm:inline-block">@Model.Reactions.TotalReactions reactions</span>
        }
    </div>

    <!-- Toolbar Spacer -->
    <div class="flex-1 min-w-[20px]"></div>

    <!-- Action Buttons -->
    <div class="flex items-center gap-1">
        <!-- Comment Button -->
        <button class="comment-btn inline-flex items-center gap-2 px-4 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest text-muted-foreground hover:text-foreground hover:bg-muted transition-all border border-transparent hover:border-border group" data-entity-id="@entityId" data-entity-type="@entityType">
            <i data-lucide="message-square" class="w-4 h-4 group-hover:scale-110 transition-transform"></i>
            <span class="hidden xs:inline">@(Model?.CommentCount ?? 0) <span class="opacity-60">Comments</span></span>
            <span class="xs:hidden">@(Model?.CommentCount ?? 0)</span>
        </button>

        <!-- Share Button -->
        <button class="share-btn inline-flex items-center gap-2 px-4 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest text-muted-foreground hover:text-foreground hover:bg-muted transition-all border border-transparent hover:border-border group" data-entity-id="@entityId" data-entity-type="@entityType">
            <i data-lucide="share-2" class="w-4 h-4 group-hover:scale-110 transition-transform"></i>
            <span class="hidden xs:inline">@(Model?.Shares?.TotalShares ?? 0) <span class="opacity-60">Shares</span></span>
            <span class="xs:hidden">@(Model?.Shares?.TotalShares ?? 0)</span>
        </button>
    </div>
</div>

<!-- Comments Section -->
<div class="comments-section mt-6 space-y-4 animate-in slide-in-from-top-2 duration-500 overflow-hidden hidden" id="comments-@entityId">
    <div class="comments-header flex items-center justify-between px-2">
        <h4 class="comments-count text-xs font-black uppercase tracking-widest text-foreground flex items-center gap-2 opacity-70">
            <i data-lucide="message-square" class="w-3.5 h-3.5"></i>
            Comments (@(Model?.CommentCount ?? 0))
        </h4>
        <div class="h-px flex-1 mx-4 bg-border/40"></div>
    </div>

    @if (Model?.CanComment == true)
    {
        <div class="comment-form flex flex-col gap-3 p-4 bg-muted/20 backdrop-blur-sm rounded-2xl border border-border/50 shadow-inner group/form focus-within:ring-4 focus-within:ring-primary/5 transition-all" data-entity-id="@entityId" data-entity-type="@entityType">
            <textarea class="comment-input w-full bg-background border border-border rounded-xl p-4 text-sm font-medium focus:ring-4 focus:ring-primary/10 transition-all min-h-[100px] outline-none shadow-sm placeholder:text-muted-foreground opacity-90 focus:opacity-100" placeholder="Write a thoughtful comment..." rows="3"></textarea>
            <div class="flex items-center justify-between">
                <span class="text-[10px] text-muted-foreground opacity-60 italic">Markdown supported</span>
                <button class="submit-comment-btn px-8 py-2.5 bg-primary text-primary-foreground rounded-xl text-[10px] font-black uppercase tracking-widest hover:opacity-90 active:scale-95 transition-all shadow-lg shadow-primary/20">
                    Post Comment
                </button>
            </div>
        </div>
    }

    <div class="comments-list space-y-4 px-2" id="comments-list-@entityId">
        <!-- Comments will be loaded dynamically via AJAX -->
        <div class="flex items-center justify-center py-8 opacity-40">
            <div class="w-2 h-2 rounded-full bg-primary animate-bounce"></div>
            <div class="w-2 h-2 rounded-full bg-primary animate-bounce [animation-delay:0.2s] mx-1"></div>
            <div class="w-2 h-2 rounded-full bg-primary animate-bounce [animation-delay:0.4s]"></div>
        </div>
    </div>
</div>

@functions {
    private string GetReactionIcon(ReactionType reactionType)
    {
        return reactionType switch
        {
            ReactionType.Like => "thumbs-up",
            ReactionType.Love => "heart",
            ReactionType.Haha => "smile",
            ReactionType.Wow => "zap",
            ReactionType.Sad => "frown",
            ReactionType.Angry => "frown",
            _ => "thumbs-up"
        };
    }
}
